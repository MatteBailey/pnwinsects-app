if(typeof jQuery.fn.autocompletehtml!="function"){(function(a){a.fn.autocompletehtml=function(){var d=a(this),c=true;this.data("autocomplete")._renderItem=function b(e,f){if(c){if(e.css("max-width")=="none"){e.css("max-width",d.outerWidth())}c=false}return a("<li></li>").data("item.autocomplete",f).append("<a>"+f.match+"</a>").appendTo(e)};return this};a.fn.autocompleteselect=function(b){return this.each(function(){var i=this.id;var f=a(this);var e=a("#"+i+"_text");var g=a("#"+i+"_on_deck");function c(j,k){if(f.val()){d()}f.val(k.item.pk);e.val("");h(k.item.repr);g.trigger("added");return false}function h(j,k){killer_id="kill_"+k+i;killButton='<span class="ui-icon ui-icon-trash" id="'+killer_id+'">X</span> ';if(j){g.empty();g.append("<div>"+killButton+j+"</div>")}else{a("#"+i+"_on_deck > div").prepend(killButton)}a("#"+killer_id).click(function(){d();g.trigger("killed")})}function d(){f.val("");g.children().fadeOut(1).remove()}b.select=c;e.autocomplete(b);e.autocompletehtml();if(b.initial){its=b.initial;h(its[0],its[1])}f.bind("didAddPopup",function(l,k,j){ui={item:{pk:k,repr:j}};c(null,ui)})})};a.fn.autocompleteselectmultiple=function(b){return this.each(function(){var i=this.id;var f=a(this);var e=a("#"+i+"_text");var g=a("#"+i+"_on_deck");function c(j,k){pk=k.item.pk;prev=f.val();if(prev.indexOf("|"+pk+"|")==-1){f.val((prev?prev:"|")+pk+"|");h(k.item.repr,pk);e.val("");g.trigger("added")}return false}function h(j,k){killer_id="kill_"+k+i;killButton='<span class="ui-icon ui-icon-trash" id="'+killer_id+'">X</span> ';g.append('<div id="'+i+"_on_deck_"+k+'">'+killButton+j+" </div>");a("#"+killer_id).click(function(){d(k);g.trigger("killed")})}function d(j){f.val(f.val().replace("|"+j+"|","|"));a("#"+i+"_on_deck_"+j).fadeOut().remove()}b.select=c;e.autocomplete(b);e.autocompletehtml();if(b.initial){a.each(b.initial,function(k,j){h(j[0],j[1])})}f.bind("didAddPopup",function(l,k,j){ui={item:{pk:k,repr:j}};c(null,ui)})})};window.addAutoComplete=function(e,d){var b=0;var c=e;if(c.indexOf("__prefix__")!=-1){while(a("#"+c).length){c=e.replace(/__prefix__/,b++)}c=e.replace(/__prefix__/,b-2);if(a("#"+c+", #"+c+"_text").hasClass("ui-autocomplete-input")){return}}d(c)};window.didAddPopup=function(d,c,e){var b=windowname_to_id(d.name);a("#"+b).trigger("didAddPopup",[html_unescape(c),html_unescape(e)]);d.close()}})(jQuery)};