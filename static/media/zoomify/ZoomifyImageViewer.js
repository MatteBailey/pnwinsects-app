(function(){var e=function(){return this}.call();e.Z={}})(),Z.showImage=function(e,t,n){Z.Utils.addCrossBrowserPrototypes(),Z.Utils.addCrossBrowserMethods(),Z.Utils.addCrossBrowserEvents(),Z.Utils.declareGlobals(),Z.pageContainerID=e,Z.imagePath=Z.Utils.removeTrailingSlashCharacters(t),Z.parameters=Z.Utils.parseParameters(n),Z.Utils.addEventListener(document,"DOMContentLoaded",Z.initialize),Z.Utils.addEventListener(window,"load",Z.initialize)},Z.initialize=function(){arguments.callee.done||(arguments.callee.done=!0,Z.Utils.detectBrowserInfo(),Z.Utils.setParameters(Z.parameters),Z.Viewer=new Z.ZoomifyImageViewer,Z.Utils.isStrVal(Z.copyrightPath)?Z.Utils.enforceCopyright():Z.Viewer.configureViewer(),Z.debug!=0&&Z.Utils.trace(Z.Utils.getResource("DEFAULT_TRACEDISPLAYDEBUGINFOTEXT")))},Z.ZoomifyImageViewer=function(){Z.ViewerDisplay=Z.Utils.createContainerElement("div","ViewerDisplay","inline-block","relative","hidden","100%","100%","0px","0px","none","0px","transparent none","0px","0px","normal","pointer"),Z.pageContainer=document.getElementById(Z.pageContainerID);var e=Z.Utils.getElementStyle(Z.pageContainer);Z.viewerW=parseFloat(e.width),Z.viewerH=parseFloat(e.height),isNaN(Z.viewerW)&&(Z.viewerW=Z.ViewerDisplay.clientWidth),isNaN(Z.viewerH)&&(Z.viewerH=Z.ViewerDisplay.clientHeight),Z.pageContainer.innerHTML="",Z.pageContainer.appendChild(Z.ViewerDisplay),this.configureViewer=function(){Z.Viewport=new Z.ZoomifyViewport},this.configureComponents=function(){Z.toolbarVisible>0&&(Z.Toolbar=new Z.ZoomifyToolbar(Z.Viewport)),Z.navigatorVisible>0&&(Z.Navigator=new Z.ZoomifyNavigator(Z.Viewport)),Z.Navigator&&Z.Navigator.validateNavigatorGlobals()},this.setSizeAndPosition=function(e,t,n,r,i){Z.viewerW=e,Z.viewerH=t,Z.ViewerDisplay.style.width=e+"px",Z.ViewerDisplay.style.height=t+"px",Z.Viewport&&Z.Viewport.getInitialized()&&Z.Viewport.setSizeAndPosition(e,t,n,r);var s=Z.toolbarPosition==1?t-Z.toolbarH:0;Z.ToolbarDisplay&&Z.Toolbar.getInitialized()&&(Z.Toolbar.setSizeAndPosition(e,null,null,s),Z.toolbarVisible>1&&Z.Toolbar.show(!0)),Z.NavigatorDisplay&&Z.Navigator.getInitialized()&&(Z.Navigator.setSizeAndPosition(null,null,n,r,Z.navigatorFit),Z.navigatorVisible>1&&Z.Navigator.setVisibility(!0)),i&&Z.Viewport.updateView(!0)},this.setImagePath=function(e,t){if(Z.Viewport&&Z.Viewport.getInitialized()){Z.Viewport.zoomAndPanAllStop(!0),Z.imagePath=Z.Utils.removeTrailingSlashCharacters(e);if(t==null){var n=new Z.NetConnector;Z.Viewport.loadImageProperties(n)}else{var r=Z.Utils.convertXMLTextToXMLDoc(t);Z.Viewport.parseImageXML(r)}}},this.setHotspotPath=function(e){Z.Viewport&&Z.Viewport.getInitialized()&&Z.Viewport.setHotspotPath(e)}},Z.ZoomifyViewport=function(){function wr(t,s,u,f,l,c,h){Z.imageW=t,Z.imageH=s,n=l,r=c,i=h,o=f,a=u,Mr(),Pr(),et=ti(K,Z.initialZ),G=ti(J,Z.initialZ),Y=G,Z.useCanvas&&x.scale(G,G),A&&ki(),_&&Di(),Hr(),As(Z.initialX,Z.initialY,Z.initialZ),Z.fullPageInitial&&e.toggleFullPageView(!0),Is(),Tr(!0),Z.Viewer.configureComponents()}function Er(e,t,s,u,f,l,c){Tr(!1),Sr(),Z.imageW=e,Z.imageH=t,n=f,r=l,i=c,o=u,a=s,Mr(),Pr(),et=ti(K,Z.initialZ),G=ti(J,Z.initialZ),Y=G,Z.useCanvas&&(x.restore(),x.scale(G,G)),g&&Xr(g),E&&Xr(E),N&&Xr(N),A&&Xr(A),_&&Xr(_),q&&Xr(q),W&&Xr(W),A&&ki(),_&&Di(),Hr(),Cr(Ct,kt,Lt,At),As(Z.initialX,Z.initialY,Z.initialZ),Tr(!0),Z.navigatorVisible>0&&Z.Navigator.setImagePath(Z.imagePath)}function Sr(){$=1,J=0,K=0,tt=[],nt=[],rt=[],it=[],st=[],ot=[],ut=[],at=[],ft=[],lt=[],ct=[],ht=[],pt=[],dt=[],vt=[],mt=[],gt=[],yt=0,A&&(Nn=[],Cn=[]),_&&(kn=[],Ln=[],Jn!=null?Zn=[]:(ar=[],cr=[],hr=[],fr=[],lr=[]))}function xr(){return t}function Tr(e){t=e}function Nr(){p=Z.Utils.createContainerElement("div","viewportContainer","inline-block","absolute","visible","1px","1px","0px","0px","none","0px","transparent none","0px","0px","normal"),Z.ViewerDisplay.appendChild(p),d=p,v=d.style,m=Z.Utils.createContainerElement(Z.useCanvas?"canvas":"div","viewportBackfillDisplay","inline-block","absolute","visible","1px","1px","0px","0px","none","0px","transparent none","0px","0px","normal"),p.appendChild(m),g=m,y=g.style,w=Z.Utils.createContainerElement(Z.useCanvas?"canvas":"div","viewportDisplay","inline-block","absolute","visible","1px","1px","0px","0px","none","0px","transparent none","0px","0px","normal"),p.appendChild(w),E=w,S=E.style,Z.useCanvas&&(T=Z.Utils.createContainerElement("canvas","transitionDisplay","inline-block","absolute","visible","1px","1px","0px","0px","none","0px","transparent none","0px","0px","normal"),p.appendChild(T),N=T,C=N.style),Z.Utils.isStrVal(Z.watermarkPath)&&(L=Z.Utils.createContainerElement("div","watermarkDisplay","inline-block","absolute","visible","1px","1px","0px","0px","none","0px","transparent none","0px","0px","normal"),p.appendChild(L),A=L,O=A.style);if(Z.Utils.isStrVal(Z.hotspotPath)||Z.Utils.isStrVal(Z.annotationPath))Z.Utils.isStrVal(Z.annotationPath)&&Z.useCanvas&&(I=Z.Utils.createContainerElement("canvas","drawingDisplay","inline-block","absolute","visible","1px","1px","0px","0px","none","0px","transparent none","0px","0px","normal"),p.appendChild(I),q=I,R=q.style,Z.editMode&&(z=Z.Utils.createContainerElement("canvas","editingDisplay","inline-block","absolute","visible","1px","1px","0px","0px","none","0px","transparent none","0px","0px","normal"),p.appendChild(z),W=z,X=W.style)),M=Z.Utils.createContainerElement("div","hotspotDisplay","inline-block","absolute","visible","1px","1px","0px","0px","none","0px","transparent none","0px","0px","normal"),p.appendChild(M),_=M,D=_.style;Z.useCanvas?(b=g.getContext("2d"),x=E.getContext("2d"),k=N.getContext("2d")):(g.innerHTML="",E.innerHTML=""),A&&(A.innerHTML=""),_&&(_.innerHTML=""),q&&(U=q.getContext("2d")),W&&(V=W.getContext("2d"))}function Cr(e,t,n,r){if(typeof n=="undefined"||n===null)n=0;if(typeof r=="undefined"||r===null)r=0;Ct=e,kt=t,Ot=Ct*Nt,Mt=kt*Nt,_t=Ot/2,Dt=Mt/2,Pt=-((Ot-Ct)/2)+n,Ht=(Ot-Ct)/2+n,Bt=-((Mt-kt)/2)+r,jt=(Mt-kt)/2+r,d.width=Ot,d.height=Mt,v.width=Ot+"px",v.height=Mt+"px",v.left=Pt+"px",v.top=Bt+"px",E.width=Ot,E.height=Mt,A&&(A.width=Ot,A.height=Mt,O.width=Ot+"px",O.height=Mt+"px");if(_){_.width=Ot,_.height=Mt,D.width=Ot+"px",D.height=Mt+"px";if(P){var i=parseInt(Z.Utils.getResource("DEFAULT_HOTSPOTLISTWIDTH"),10),s=Gi(Kn,i,Ct,kt);H.left=s.x+"px",H.top=s.y+"px"}}q&&(q.width=Ot,q.height=Mt,R.width=Ot+"px",R.height=Mt+"px"),W&&(W.width=Ot,W.height=Mt,X.width=Ot+"px",X.height=Mt+"px");if(B){var o=parseInt(Z.Utils.getResource("DEFAULT_ANNOTATIONPANELWIDTH"),10),u=parseInt(Z.Utils.getResource("DEFAULT_ANNOTATIONPANELHEIGHT"),10),a=is(tr,o,u,Ct,kt);F.left=a.x+"px",F.top=a.y+"px"}Z.useCanvas&&(x.translate(_t,Dt),x.save(),q&&(U.translate(_t,Dt),U.save()),W&&(V.translate(_t,Dt),V.save()))}function kr(e){if(Z.tileSource=="ZoomifyImageFolder"){var t=Z.Utils.cacheProofPath(Z.imagePath+"/"+"ImageProperties.xml");e.loadXML(t)}else Z.tileSource=="ZoomifyImageFile"?Ar(e):Z.tileSource=="OtherTileSource"&&Or(e)}function Lr(t){if(typeof e.getInitialized=="undefined")var n=window.setTimeout(function(){Lr(t)},100);else{var r,i,s,o,u,a,f,l;Z.tileSource=="ZoomifyImageFolder"?(r=parseInt(t.documentElement.getAttribute("WIDTH"),10),i=parseInt(t.documentElement.getAttribute("HEIGHT"),10),o=parseInt(t.documentElement.getAttribute("NUMTILES"),10),u=parseInt(t.documentElement.getAttribute("NUMIMAGES"),10),a=parseInt(t.documentElement.getAttribute("VERSION"),10),s=parseInt(t.documentElement.getAttribute("TILESIZE"),10)):Z.tileSource=="ZoomifyImageFile"&&(r=parseInt(t.documentElement.getAttribute("WIDTH"),10),i=parseInt(t.documentElement.getAttribute("HEIGHT"),10),s=parseInt(t.documentElement.getAttribute("TILESIZE"),10),o=parseInt(t.documentElement.getAttribute("NUMTILES"),10),u=parseInt(t.documentElement.getAttribute("NUMIMAGES"),10),a=parseInt(t.documentElement.getAttribute("VERSION"),10),f=parseInt(t.documentElement.getAttribute("HEADERSIZE"),10),l=1060+f),!isNaN(r)&&r>0&&!isNaN(i)&&i>0&&!isNaN(s)&&s>0?e.getInitialized()?Er(r,i,s,o,a,f,l):wr(r,i,s,o,a,f,l):Z.Utils.showMessage(Z.Utils.getResource("ERROR_IMAGEXMLINVALID"))}}function Ar(e){var t=1,n=0,r=1060,i=Z.imagePath.replace(".","%2E"),s=Z.tileHandlerPathFull+"?file="+i+"&requestType="+t+"&begin="+n+"&end="+r;e.loadXML(s)}function Or(e){}function Mr(){var e=_r();e!=o&&(e=Dr(),e!=o&&Z.Utils.showMessage(Z.Utils.getResource("ERROR_IMAGETILECOUNTINVALID")))}function _r(){var e=Z.imageW,t=Z.imageH;while(e>a||t>a)e/=2,t/=2,$++;e=Z.imageW,t=Z.imageH;var n=0;for(var r=$-1;r>=0;r--)rt[r]=e,it[r]=t,st[r]=Math.ceil(rt[r]/a),ot[r]=Math.ceil(it[r]/a),ut[r]=st[r]*ot[r],e/=2,t/=2,n+=ut[r];return n}function Dr(){rt=[],it=[],st=[],ot=[],$=0;var e="DIV2",t=Z.imageW,n=Z.imageH;$=1;var r=2;while(t>a||n>a)e=="Div2"?(t=Math.floor(t/2),n=Math.floor(n/2)):e=="Plus1Div2"?(t=Math.floor((t+1)/2),n=Math.floor((n+1)/2)):(t=Math.floor(Z.imageW/r),n=Math.floor(Z.imageH/r),r*=2,t%2&&t++,n%2&&n++),$++;t=Z.imageW,n=Z.imageH,r=2,tileCounter=0;for(var i=$-1;i>=0;i--)st[i]=Math.floor(t/a),t%a&&st[i]++,ot[i]=Math.floor(n/a),n%a&&ot[i]++,ut[i]=st[i]*ot[i],tileCounter+=ut[i],rt[i]=t,it[i]=n,e=="Div2"?(t=Math.floor(t/2),n=Math.floor(n/2)):e=="Plus1Div2"?(t=Math.floor((t+1)/2),n=Math.floor((n+1)/2)):(t=Math.floor(Z.imageW/r),n=Math.floor(Z.imageH/r),r*=2,t%2&&t++,n%2&&n++);return tileCounter}function Pr(){var e=parseFloat(Z.Utils.getResource("DEFAULT_INITIALX")),t=parseFloat(Z.Utils.getResource("DEFAULT_INITIALY")),n=parseFloat(Z.Utils.getResource("DEFAULT_INITIALZOOM")),r=parseFloat(Z.Utils.getResource("DEFAULT_MINZOOM")),i=parseFloat(Z.Utils.getResource("DEFAULT_MAXZOOM"));niX=isNaN(e)?null:e,niY=isNaN(t)?null:t,niZ=isNaN(n)?null:n,nmnZ=isNaN(r)?null:r,nmxZ=isNaN(i)?null:i;if(!Z.parameters)Z.initialX=niX,Z.initialY=niY,Z.initialZ=niZ,Z.minZ=nmnZ,Z.maxZ=nmxZ;else{var s=Z.parameters.toString();s.indexOf("zInitialX")==-1&&(Z.initialX=niX),s.indexOf("zInitialY")==-1&&(Z.initialY=niY),s.indexOf("zInitialZoom")==-1&&(Z.initialZ=niZ),s.indexOf("zMinZ")==-1&&(Z.minZ=nmnZ),s.indexOf("zMaxZ")==-1&&(Z.maxZ=nmxZ)}Z.initialX==null&&(Z.initialX=Z.imageW/2),Z.initialY==null&&(Z.initialY=Z.imageH/2),Z.fitZ=Si(),Z.initialZ==null&&(Z.initialZ=Z.fitZ),Z.minZ==null&&(Z.minZ=Z.fitZ),Z.maxZ==null&&(Z.maxZ=Z.fitZ),Z.initialZ<Z.minZ&&(Z.initialZ=Z.minZ),Z.initialZ>Z.maxZ&&(Z.initialZ=Z.maxZ)}function Hr(){Br(Tt),$>Et&&(Br(xt),$>wt&&Br(St)),nt.sort(),nt=Z.Utils.removeDups(nt),Wr(nt,ci,0,"backfill")}function Br(e){var t=st[e]-1,n=ot[e]-1;for(var r=0;r<=n;r++)for(var i=0;i<=t;i++)nt.push(e+"-"+i+"-"+r)}function jr(e,t){}function Fr(t){var n=!1;if(t||parseFloat(S.width)!=E.width)Z.useCanvas&&(S.width=E.width+"px",S.height=E.height+"px",S.left="0px",S.top="0px",x.restore(),x.save(),x.scale(G,G),q&&(R.width=q.width+"px",R.height=q.height+"px",R.left="0px",R.top="0px"),W&&(X.width=W.width+"px",X.height=W.height+"px",X.left="0px",X.top="0px")),n=!0;if(t||parseFloat(v.left)!=Pt||parseFloat(v.top)!=Bt){var r=parseFloat(v.left)-Pt,i=parseFloat(v.top)-Bt;v.left=Pt+"px",v.top=Bt+"px",qt=parseFloat(y.left)+r,Rt=parseFloat(y.top)+i,y.left=qt+"px",y.top=Rt+"px";var s=e.getZoom();Z.imageX=Z.imageX-r/s,Z.imageY=Z.imageY-i/s,n=!0}n&&Ur(E,J,lt,"centerOut",!1,"1. Updating view: resetting display positions")}function Ir(){G!=Y&&(Z.imageZ=nn),Z.imageZ<Z.minZ&&(Z.imageZ=Z.minZ);var e=f,t=$;while(e/2>=Z.imageZ)t--,e/=2;t=t-1<0?0:t-1;var n=ti(t,Z.imageZ);if(t!=J||n!=G)Z.useCanvas&&(x.restore(),x.save(),x.scale(n,n)),J!=t&&(Q=!0),J=t,G=n;Y=G}function qr(){K=J>wt?St:J>Et?xt:Tt,et=ti(K,Z.imageZ),tierBackfillW=rt[K],tierBackfillH=it[K],g.width=tierBackfillW,g.height=tierBackfillH;var e=tierBackfillW*et,t=tierBackfillH*et,n=Z.imageX*Z.imageZ,r=Z.imageY*Z.imageZ;Ft=e,It=t,qt=_t-n,Rt=Dt-r,Z.useCanvas&&(y.width=Ft+"px",y.height=It+"px"),y.left=qt+"px",y.top=Rt+"px"}function Rr(){var e=Kr();for(var t=e.top,n=e.bottom;t<=n;t++)for(var r=e.left,i=e.right;r<=i;r++)ft.push(J+"-"+r+"-"+t);ct.sort(),ft.sort(),ct=Z.Utils.removeDups(ct),ft=Z.Utils.removeDups(ft),Z.debug==2&&Z.Utils.trace("Tiles required: "+ft.join(", "));var s=Z.Utils.intersect(ft,ct);ft=Z.Utils.subtract(ft,ct),yt=tilesLoadingNamesLength=ft.length,Z.ToolbarDisplay&&Z.Toolbar.getInitialized()&&Z.Toolbar.updateProgress(yt,tilesLoadingNamesLength),ct=Z.Utils.subtract(ct,s),ct=ct.concat(s);if(tilesLoadingNamesLength!=0){for(var o=0,u=at.length;o<u;o++){var a=at[o];a.alpha=1}at=[]}}function Ur(e,t,n,r,i,s){if(n.length>0){var o=Kr();i||Xr(e);if(r=="canvasCopy")Xr(E),x.restore(),x.save(),x.scale(1,1),x.drawImage(N,-_t,-Dt),x.restore(),x.save(),x.scale(G,G);else if(r=="centerOut"){var u=Math.floor(n.length/2);for(var a=u,f=n.length;a<f;a++){var l=n[a];l&&l.t==t&&(t==K||l.c>=o.left&&l.c<=o.right&&l.r>=o.top&&l.r<=o.bottom)&&di(e,t,l);if(n.length-a-1!=a){var l=n[n.length-a-1];l&&l.t==t&&(t==K||l.c>=o.left&&l.c<=o.right&&l.r>=o.top&&l.r<=o.bottom)&&di(e,t,l)}}}else for(var a=0,f=n.length;a<f;a++){var l=n[a];l&&l.t==t&&(t==K||l.c>=o.left&&l.c<=o.right&&l.r>=o.top&&l.r<=o.bottom)&&di(e,t,l)}if(Z.debug==2&&e.id=="viewportDisplay"){var c=[];for(var a=0,f=n.length;a<f;a++)l&&n[a].t==t&&(t==K||n[a].c>=o.left&&n[a].c<=o.right&&n[a].r>=o.top&&n[a].r<=o.bottom)&&c.push(n[a].name);c.length>0&&(c.sort(),c=Z.Utils.removeDups(c));var h=c.length>0?c.join(", "):"No cached tiles to redisplay";Z.Utils.trace("Tiles redisplaying - "+s+": "+h)}}}function zr(e,t){var n=Kr();N.width=E.width,N.height=E.height,C.width=S.width,C.height=S.height,C.left=S.left,C.top=S.top,k.restore(),k.save(),k.translate(_t,Dt),k.scale(G,G);for(var r=0,i=t.length;r<i;r++){var s=t[r];s&&s.t==e&&(e==K||s.c>=n.left&&s.c<=n.right&&s.r>=n.top&&s.r<=n.bottom)&&di(N,e,s)}}function Wr(e,t,n,r){if(e.length>0){var i=(new Date).getTime();if(n){var s=Math.floor(e.length/2);for(var o=s,u=e.length;o<u;o++){var a=e[o];if(a){var f=new si(a,r);fi(f,i,t)}if(e.length-o-1!=o){var a=e[e.length-o-1];if(a){var f=new si(a,r);fi(f,i,t)}}}}else for(var o=0,u=e.length;o<u;o++){var a=e[o];if(a){var f=new si(a,r);fi(f,i,t)}}var l=typeof r!="undefined"&&r!==null?" - "+r+": ":": ";Z.debug==2&&l!=" - backfill: "&&Z.Utils.trace("Tiles to be requested"+l+e.join(", "))}else Z.debug==2&&Z.Utils.trace("No new tiles requested.")}function Xr(e){if(e)if(Z.useCanvas&&e.tagName=="CANVAS"){var t=e.getContext("2d");t.save(),t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.restore()}else while(e.hasChildNodes())e.removeChild(e.lastChild)}function Vr(){if(Z.ToolbarDisplay&&Z.Toolbar.getInitialized()){var t=e.getZoom();Z.Toolbar.syncSliderToViewport(t)}}function $r(){Z.Navigator&&Z.Navigator.getInitialized()&&Z.Navigator.syncToViewport()}function Jr(){return new Yr(Qr(),J)}function Kr(){return new Yr(Gr(),J)}function Qr(){var t=parseFloat(v.left)-Pt,n=parseFloat(v.top)-Bt;if(Z.useCanvas){var r=parseFloat(v.width)/d.width;t/=r,n/=r}var i=e.getZoom();t!=0&&(t/=i),n!=0&&(n/=i);var s=Z.imageX-t,o=Z.imageY-n,u=-(Ct/2),a=Ct/2,f=-(kt/2),l=kt/2;return new Zr(s,o,u,a,f,l,i)}function Gr(){var t=parseFloat(v.left)-Pt,n=parseFloat(v.top)-Bt;if(Z.useCanvas){var r=parseFloat(v.width)/d.width;t/=r,n/=r}var i=e.getZoom();t!=0&&(t/=i),n!=0&&(n/=i);var s=Z.imageX-t,o=Z.imageY-n,u=-(Ot/2),a=Ot/2,f=-(Mt/2),l=Mt/2;return new Zr(s,o,u,a,f,l,i)}function Yr(e,t){var n=ei(t,1),r=Math.floor(e.left*n/a),i=Math.floor(e.right*n/a),s=Math.floor(e.top*n/a),o=Math.floor(e.bottom*n/a);r<0&&(r=0),i>st[J]-1&&(i=st[J]-1),s<0&&(s=0),o>ot[J]-1&&(o=ot[J]-1),this.left=r,this.right=i,this.top=s,this.bottom=o}function Zr(e,t,n,r,i,s,o){this.left=e+n/o,this.right=e+r/o,this.top=t+i/o,this.bottom=t+s/o}function ei(e,t){var n=t*(rt[e]/Z.imageW);return n}function ti(e,t){var n=t/(rt[e]/Z.imageW);return n}function ni(e,t){var n=e-Z.Utils.getElementPosition(Z.ViewerDisplay).x,r=t-Z.Utils.getElementPosition(Z.ViewerDisplay).y;return new Z.Utils.Point(n,r)}function ri(e,t){var n=parseFloat(v.left)+_t,r=parseFloat(v.top)+Dt,i=e-n,s=t-r,o=i/Z.imageZ,u=s/Z.imageZ,a=Z.imageX+o,f=Z.imageY+u;return new Z.Utils.Point(a,f)}function ii(e,t,n){var r=Z.imageX-e,i=Z.imageY-t,s=r*n,o=i*n,u=Pt+s,a=Bt+o;return new Z.Utils.Point(u,a)}function si(t,n){this.name=t,this.t=parseInt(t.substring(0,t.indexOf("-")),10),this.c=parseInt(t.substring(t.indexOf("-")+1,t.lastIndexOf("-")),10),this.r=parseInt(t.substring(t.lastIndexOf("-")+1),10),this.x=Math.floor(this.c*a),this.y=Math.floor(this.r*a),this.image=null,this.alpha=0,this.url=e.formatTilePath(this.t,this.c,this.r,n),this.loadTime=null,this.elmt=null,this.style=null}function oi(e,t,n){var r=0;for(var i=$-1;i>=e;i--)r+=ut[i];r+=n*st[e]+t;var o=Math.floor(r/s);return o}function ui(e,t,n){dt[e]=n;var r=2,i=Z.imagePath.replace(".","%2E"),s=Z.tileHandlerPathFull+"?file="+i+"&requestType="+r+"&begin="+e+"&end="+t,o=new Z.NetConnector;o.loadXML(s)}function ai(e){for(var t=0,n=vt.length;t<n;t++){var r=vt[t].split(",");r[0]==e&&(r[4]!=undefined&&r[4]!="backfill"?mt.push(r[1]+"-"+r[2]+"-"+r[3]):gt.push(r[1]+"-"+r[2]+"-"+r[3]),vt.splice(t,1),t--,n--)}mt.length>0&&(Wr(mt,pi,0),Z.debug==2&&Z.Utils.trace("Tiles being requested - offset chunk now loaded: "+mt.join(", "))),gt.length>0&&Wr(gt,ci,0,"backfill")}function fi(e,t,n){e.url.substr(0,8)=="skipTile"?li(e):e.url!="offsetLoading"&&(e.loadTime=t,e.loading=bt.loadImage(e.url,Z.Utils.createCallback(null,n,e),"tile"),Z.debug==2&&Z.Utils.trace("Tile actually requested: "+e.name)),Z.debug==2&&Z.Utils.trace("Tile not yet requested - offset chunk loading in progress: "+e.name)}function li(e){c>0&&(lt.push(e),ct.push(e.name));var t=ft.indexOf(e.name);t!=-1&&ft.splice(t,1),Z.tileSource=="ZoomifyImageFile"&&(t=mt.indexOf(e.name),t!=-1&&mt.splice(t,1)),at.push(e)}function ci(e,t){if(e&&t){e.image=t;var n=e.name;tt.push(e);var r=nt.indexOf(n);r!=-1&&nt.splice(r,1),Z.tileSource=="ZoomifyImageFile"&&(r=gt.indexOf(n),r!=-1&&gt.splice(r,1)),e.alpha=1,e.t==K&&di(g,K,e)}else t==null&&(Z.mobileDevice?console.log(Z.Utils.getResource("ERROR_TILEPATHINVALID")+e.name+".jpg"):Z.Utils.showMessage(Z.Utils.getResource("ERROR_TILEPATHINVALID")+e.name+".jpg"))}function hi(e,t){if(e&&t){e.image=t;var n=e.name;di(E,J,e)}else t==null&&(Z.mobileDevice?console.log(Z.Utils.getResource("ERROR_TILEPATHINVALID")+e.name+".jpg"):Z.Utils.showMessage(Z.Utils.getResource("ERROR_TILEPATHINVALID")+e.name+".jpg"))}function pi(e,t){if(e&&t){e.image=t;var n=e.name;c>0&&(lt.push(e),ct.push(n));var r=ft.indexOf(n);r!=-1&&ft.splice(r,1),Z.tileSource=="ZoomifyImageFile"&&(r=mt.indexOf(n),r!=-1&&mt.splice(r,1)),at.push(e),fn||(fn=window.setInterval(wi,50)),Z.debug==2&&(Z.Utils.trace("Tile received: "+e.name),i==0&&Z.Utils.trace("Tile loading complete: all requested tiles received."));var i=ft.length;if(i==0){if(Z.useCanvas&&c>0)if(!Q)Ur(E,J,lt,"centerOut",!1,"4. Updating view: all new tiles loaded");else{zr(J,lt),Ur(E,J,lt,"canvasCopy",!1,"4. Updating view: all new tiles loaded");var s=window.setTimeout(function(){Xr(N)},200);Q=!1}ct.length>c&&Ei(),yt=0}Z.ToolbarDisplay&&Z.Toolbar.getInitialized()&&Z.Toolbar.updateProgress(yt,i)}else t==null&&(Z.mobileDevice?console.log(Z.Utils.getResource("ERROR_TILEPATHINVALID")+e.name+".jpg"):Z.Utils.showMessage(Z.Utils.getResource("ERROR_TILEPATHINVALID")+e.name+".jpg"))}function di(e,t,n){if(n.url.substr(0,8)!="skipTile"){var r=n.x,i=n.y,s=ei(t,1);if(Z.useCanvas){if(e==E||e==N)r-=Z.imageX*s,i-=Z.imageY*s;vi(e,n,r,i)}else{var o;e==E?(r-=Z.imageX*s-_t/G,i-=Z.imageY*s-Dt/G,o=G):o=et,mi(e,n,r,i,o)}}}function vi(e,t,n,r){var i=e.getContext("2d");Z.alphaSupported&&t.alpha<1&&e.id!="transitionDisplay"?(i.globalAlpha=t.alpha,i.drawImage(t.image,n,r),i.globalAlpha=1):i.drawImage(t.image,n,r),Z.debug==2&&gi(e,t.name,n,r,G)}function mi(e,t,n,r,i){t.elmt||(t.elmt=Z.Utils.createContainerElement("img"),t.elmt.onmousedown=Z.Utils.preventDefault,Z.Utils.addEventListener(t.elmt,"contextmenu",Z.Utils.preventDefault),t.elmt.src=t.url,t.style=t.elmt.style,t.style.position="absolute",Z.Utils.renderQuality(t,Z.renderQuality),Z.cssTransformsSupported&&(t.style[Z.cssTransformProperty+"Origin"]="0px 0px")),t.elmt.parentNode!=e&&e.appendChild(t.elmt);var s=t.style;s.display="none",Z.cssTransformsSupported?s[Z.cssTransformProperty]=["matrix(",(t.image.width/t.elmt.width*i).toFixed(8),",0,0,",(t.image.height/t.elmt.height*i).toFixed(8),",",(n*i).toFixed(8),Z.cssTransformNoUnits?",":"px,",(r*i).toFixed(8),Z.cssTransformNoUnits?")":"px)"].join(""):(s.width=t.image.width*i+"px",s.height=t.image.height*i+"px",s.left=n*i+"px",s.top=r*i+"px"),s.display="inline-block",Z.Utils.setOpacity(t,t.alpha),Z.debug==2&&gi(e,t.name,n,r,i)}function gi(e,t,n,r,i){Z.useCanvas?yi(e,t,n,r,i):bi(e,t,n,r,i)}function yi(e,t,n,r,i){var s=parseInt(Z.Utils.getResource("DEFAULT_HOTSPOTCAPTIONFONTSIZE"),10),o=parseInt(Z.Utils.getResource("DEFAULT_MINHOTSPOTCAPTIONFONTSIZE"),10),u=parseInt(Z.Utils.getResource("DEFAULT_MAXHOTSPOTCAPTIONFONTSIZE"),10),f=Math.round(s*i),l=2*(f<o?o:f>u?u:f),c=e.getContext("2d");c.font=l+"px verdana",c.textAlign="left",c.textBaseline="top";var h=a*i/2;c.fillStyle="#ffffff",c.fillText(t,n+h,r+h),c.fillStyle="#000000",c.fillText(t,n+h+1,r+h+1)}function bi(e,t,n,r,i){var s=parseInt(Z.Utils.getResource("DEFAULT_HOTSPOTCAPTIONFONTSIZE"),10),o=parseInt(Z.Utils.getResource("DEFAULT_MINHOTSPOTCAPTIONFONTSIZE"),10),u=parseInt(Z.Utils.getResource("DEFAULT_MAXHOTSPOTCAPTIONFONTSIZE"),10),f=Math.round(s*i),l=2*(f<o?o:f>u?u:f),c=parseInt(Z.Utils.getResource("DEFAULT_HOTSPOTCAPTIONPADDING"),10)*i,h=Z.Utils.createContainerElement("div","tileNameTextBox","inline-block","absolute","hidden","auto","auto","1px","1px","none","0px","transparent none","0px",c+"px","nowrap"),p=document.createTextNode(t);h.appendChild(p),e.appendChild(h),Z.Utils.setTextStyle(p,"white","verdana",l+"px","none","normal","normal","normal","normal","1em","center","none");var d=Z.Utils.createContainerElement("div","tileNameTextBox2","inline-block","absolute","hidden","auto","auto","1px","1px","none","0px","transparent none","0px",c+"px","nowrap"),v=document.createTextNode(t);d.appendChild(v),e.appendChild(d),Z.Utils.setTextStyle(v,"black","verdana",l+"px","none","normal","normal","normal","normal","1em","center","none");var c=parseFloat(h.style.padding),m=parseFloat(Z.Utils.getElementStyleProperty(h,"width"));if(isNaN(m)){var g=parseFloat(Z.Utils.getResource("DEFAULT_FONTTOPIXELSCONVERSIONFACTOR")),y=parseFloat(h.style.fontSize)/g;m=Math.round(parseFloat(t.length*y))}var b=a*i/2,w=a*i/2;h.style.left=n*i+(b-m/2-c)+"px",h.style.top=r*i+w+"px",d.style.left=1+n*i+(b-m/2-c)+"px",d.style.top=1+r*i+w+"px",Z.Utils.addEventListener(h,"contextmenu",Z.Utils.preventDefault),Z.Utils.disableTextInteraction(p),Z.Utils.addEventListener(d,"contextmenu",Z.Utils.preventDefault),Z.Utils.disableTextInteraction(v)}function wi(e){var t=0;for(var n=0,r=at.length;n<r;n++){var i=at[n];i.t==J&&(i.alpha<1?(an==0?i.alpha=1:i.alpha+=an,i.alpha>1&&(i.alpha=1),di(E,J,i)):(t++,t>=r&&(window.clearInterval(fn),fn=null),Z.debug==2&&Z.Utils.trace("Fading-in tile complete: "+i.name)))}}function Ei(){while(ct.length>c&&lt.length>0)j=ct.indexOf(lt[0].name),j!=-1&&ct.splice(j,1),lt.splice(0,1)}function Si(){return Z.imageW/Z.imageH>Ct/kt?Ct/Z.imageW:kt/Z.imageH}function xi(e,t,n){if(Z.constrainPan){n===null&&(n=Z.imageZ);var r=new Zr(e,t,-(Ct/2),Ct/2,-(kt/2),kt/2,n),i=r.left,s=r.right,o=r.top,u=r.bottom;Z.imageW*n>Ct?i<0?e=Ct/2/n:s>Z.imageW&&(e=Z.imageW-Ct/2/n):e=Z.imageW/2,Z.imageH*n>kt?o<0?t=kt/2/n:u>Z.imageH&&(t=Z.imageH-kt/2/n):t=Z.imageH/2}return new Z.Utils.Point(e,t)}function Ti(t,n){if(Z.constrainPan){var r=e.getZoom(),i=Z.imageX,s=Z.imageY,o=new Zr(i,s,-(Ct/2),Ct/2,-(kt/2),kt/2,r),u=o.left,a=o.right,f=o.top,l=o.bottom;Z.imageW*r>Ct?u<0?t+=u*r:a>Z.imageW&&(t-=(Z.imageW-a)*r):t+=(i-Z.imageW/2)*r,Z.imageH*r>kt?f<0?n+=f*r:l>Z.imageH&&(n-=(Z.imageH-l)*r):n+=(s-Z.imageH/2)*r}return new Z.Utils.Point(t,n)}function Ni(t,n){if(Z.constrainPan){var r=e.getZoom(),i=Z.imageX-(t-Pt)/r,s=Z.imageY-(n-Bt)/r,o=new Zr(i,s,-(Ct/2),Ct/2,-(kt/2),kt/2,r),u=o.left,a=o.right,f=o.top,l=o.bottom;Z.imageW*r>Ct?u<0?t+=u*r:a>Z.imageW&&(t-=(Z.imageW-a)*r):t+=(i-Z.imageW/2)*r,Z.imageH*r>kt?f<0?n+=f*r:l>Z.imageH&&(n-=(Z.imageH-l)*r):n+=(s-Z.imageH/2)*r}return new Z.Utils.Point(t,n)}function Ci(e){return e>Z.maxZ?e=Z.maxZ:e<Z.minZ&&(e=Z.minZ),e}function ki(){xn=new Image,Tn=parseFloat(Z.Utils.getResource("DEFAULT_WATERMARKALPHA")),xn.url=Z.watermarkPath,xn.onload=Li,xn.onerror=_i,xn.src=Z.watermarkPath}function Li(){if(A){var t=parseFloat(Z.Utils.getResource("DEFAULT_WATERMARKMINSCALE")),n=parseFloat(Z.Utils.getResource("DEFAULT_WATERMARKSPANW")),r=parseFloat(Z.Utils.getResource("DEFAULT_WATERMARKSPANH")),i=e.getZoom(),s=(Z.imageW*i-A.width)/2,o=(Z.imageH*i-A.height)/2,u=(Z.imageW/2-Z.imageX)*i,a=(Z.imageH/2-Z.imageY)*i,f=i<t?t:i,l=Math.round(Z.imageW/n),c=Math.round(Z.imageH/r),h=Gr(),p=xn.width*f,d=xn.height*f,v=0,m=0;for(var g=1;g<=l;g++)for(var y=1;y<=c;y++){var b=Math.round(Z.imageW/(l+1)*g),w=Math.round(Z.imageH/(c+1)*y);if(b>h.left&&b<h.right&&w>h.top&&w<h.bottom){var E=Math.round(b*i-p/2-s+u),S=Math.round(w*i-d/2-o+a);if(Z.imageW>4e3){var x=v+100,T=m+100;if(E<x&&S<T)continue;v=E,m=S}Ai(p,d,E,S)}}}}function Ai(e,t,n,r){Oi(e,t,n,r)}function Oi(e,t,n,r){var i=xn.cloneNode(!1);Z.Utils.setOpacity(i,Tn),i.width=e,i.height=t;var s=Z.Utils.createContainerElement("div","wiC","inline-block","absolute","hidden",e+"px",t+"px",n+"px",r+"px","none","0px","transparent none","0px","0px","normal");s.appendChild(i),A.appendChild(s),Z.Utils.addEventListener(i,"contextmenu",Z.Utils.preventDefault),Z.Utils.addEventListener(i,"mousedown",Z.Utils.preventDefault)}function Mi(){A&&(Xr(A),Li())}function _i(){Z.Utils.showMessage(Z.Utils.getResource("ERROR_WATERMARKPATHINVALID")+this.url)}function Di(){var e;Z.Utils.isStrVal(Z.hotspotPath)?e=Z.Utils.cacheProofPath(Z.hotspotPath+"/"+Z.Utils.getResource("DEFAULT_HOTSPOTSXMLFILE")):Z.Utils.isStrVal(Z.annotationPath)&&(e=Z.Utils.cacheProofPath(Z.annotationPath+"/"+Z.Utils.getResource("DEFAULT_ANNOTATIONSXMLFILE")));var t=new Z.NetConnector;t.loadXML(e)}function Pi(e){this.id=e.getAttribute("ID"),this.internalID=parseInt(e.getAttribute("INTERNALID")),this.name=e.getAttribute("NAME"),this.mediaType=e.getAttribute("MEDIATYPE"),this.media=e.getAttribute("MEDIA"),this.image=null,this.iW=null,this.iH=null;var t=parseFloat(e.getAttribute("X"));this.x=isNaN(t)?0:t;var n=parseFloat(e.getAttribute("Y"));this.y=isNaN(n)?0:n;var r=parseFloat(e.getAttribute("ZOOM"));this.zoom=isNaN(r)?-1:r;var i=parseFloat(e.getAttribute("XSCALE"));this.xScale=isNaN(i)?100:i;var s=parseFloat(e.getAttribute("YSCALE"));this.yScale=isNaN(s)?100:s,this.url=e.getAttribute("URL"),this.urlTarget=e.getAttribute("URLTARGET");var o=e.getAttribute("ROLLOVER");this.rollover=o=="1"||o=="true",this.caption=e.getAttribute("CAPTION"),this.tooltip=e.getAttribute("TOOLTIP"),this.textColor="#"+e.getAttribute("TEXTCOLOR"),this.backColor="#"+e.getAttribute("BACKCOLOR"),this.lineColor="#"+e.getAttribute("LINECOLOR"),this.fillColor="#"+e.getAttribute("FILLCOLOR"),this.textVisible=e.getAttribute("TEXTVISIBLE")!="0",this.backVisible=e.getAttribute("BACKVISIBLE")!="0",this.lineVisible=e.getAttribute("LINEVISIBLE")!="0",this.fillVisible=e.getAttribute("FILLVISIBLE")!="0";var u=e.getAttribute("CAPTIONPOSITION");this.captionPosition=Z.Utils.isStrVal(u)?u:"8",this.saved=!0,this.visibility=!0,this.polygonPts=null;if(e.getAttribute("MEDIA")=="polygon"){var a=e.getElementsByTagName("POLYGON"),f=a[0].getElementsByTagName("POINT"),l=[];for(var c=0,h=f.length;c<h;c++)l.push({x:f[c].getAttribute("X"),y:f[c].getAttribute("Y")});this.polygonPts=l}var p=1,d=2,v=e.getAttribute("MEDIATYPE");this.mediaType=v=="symbol"?p:d}function Hi(e){var t=(new Date).getTime();for(var n=0,r=e.length;n<r;n++)Bi(e[n],t)}function Bi(e,t){var n=Hn.loadImage(e,Z.Utils.createCallback(null,ji,e,t),"hotspot")}function ji(e,t,n){if(e&&t&&n){var r=new Xi;for(var i=0,s=kn.length;i<s;i++)if(kn[i].media==e){Ln.push(n.cloneNode(!1)),kn[i].image=n.cloneNode(!1),kn[i].iW=n.width,kn[i].iH=n.height;var o=kn[i].x,u=kn[i].y;o>r.bounds.left&&o<r.bounds.right&&u>r.bounds.top&&u<r.bounds.bottom&&Ri(kn[i],r)}}else Z.Utils.showMessage(Z.Utils.getResource("ERROR_HOTSPOTPATHINVALID"))}function Fi(){_&&(Xr(_),q&&Xr(q),W&&Xr(W),qi())}function Ii(){var e=new Xi;for(var t=0,n=kn.length;t<n;t++)if(kn[t].media==""||kn[t].media=="polygon"){var r=kn[t].x,i=kn[t].y;r>e.bounds.left&&r<e.bounds.right&&i>e.bounds.top&&i<e.bounds.bottom&&Ri(kn[t],e)}}function qi(){var e=new Xi;for(var t=0,n=kn.length;t<n;t++){var r=kn[t].x,i=kn[t].y;r>e.bounds.left&&r<e.bounds.right&&i>e.bounds.top&&i<e.bounds.bottom&&Ri(kn[t],e)}if(_.childNodes.length==0){var s=Z.Utils.createContainerElement("div","hotspotImmortal","inline-block","absolute","visible","1px","1px","0px","0px","none","0px","transparent none","0px","0px","normal");_.appendChild(s)}}function Ri(e,t){e.media=="polygon"&&bs(e,t),Ui(e,t)}function Ui(e,t){if(!Z.Utils.isStrVal(e.media)&&!Z.Utils.isStrVal(e.caption)||(e.iW==null||e.iH==null)&&e.media!="polygon"&&(q||!Z.Utils.isStrVal(e.caption)))return;var n=kn.indexOfObjectValue("internalID",e.internalID);n!=-1&&zi(kn[n]);if(Z.useCanvas&&e.media=="polygon"){var r=e.polygonPts,i=Z.Utils.getDimensionsFromPolygonPoints(e.polygonPts);e.iW=i.x,e.iH=i.y}if((e.iW===null||e.iH==null)&&e.media!="polygon"&&e.media!="")return;var s=e.iW*t.constrainedScale*(e.xScale/100/(e.zoom/100)),o=e.iH*t.constrainedScale*(e.yScale/100/(e.zoom/100)),u;e.image&&(u=e.image,u.align="top",u.width=s,u.height=o);var a=Math.round(e.x*t.currentZ-s/2-t.displayOffsetL+t.imageOffsetL),f=Math.round(e.y*t.currentZ-o/2-t.displayOffsetT+t.imageOffsetT),l;Z.Utils.isStrVal(e.caption)&&(l=Vi(e,t));var c=Z.Utils.createContainerElement("div","hCloak","inline-block","absolute","visible"),h="hot"+e.internalID.toString(),p=Z.Utils.createContainerElement("div",h,"inline-block","absolute","visible",s+"px",o+"px",a+"px",f+"px","none","0px","transparent none","0px","0px","normal");Z.Utils.isStrVal(e.tooltip)&&(p.title=unescape(e.tooltip));if(Z.Utils.isStrVal(e.url)){if(u){var d=document.createElement("a");d.setAttribute("href",e.url),d.setAttribute("target",e.urlTarget),d.setAttribute("outline","none"),d.appendChild(u),u.style.cursor="help",u.style.border="none"}if(l){var v=document.createElement("a");v.setAttribute("href",e.url),v.setAttribute("target",e.urlTarget),v.setAttribute("outline","none"),v.appendChild(l),l.style.cursor="help"}c.style.border="none"}Z.Utils.isStrVal(e.url)?(d&&c.appendChild(d),v&&c.appendChild(v)):(u&&c.appendChild(u),l&&c.appendChild(l)),p.appendChild(c),_.appendChild(p),e.rollover&&(c.rollover=e.rollover),Qi(p,!e.rollover&&e.visibility);if(l){var m=$i(l,e.captionPosition,s,o);l.style.left=m.x+"px",l.style.top=m.y+"px"}e.rollover&&(Z.Utils.addEventListener(p,"mouseover",us),Z.Utils.addEventListener(p,"mouseout",as)),Z.Utils.addEventListener(p,"mousedown",Z.Utils.preventDefault),Z.Utils.addEventListener(p,"contextmenu",Z.Utils.preventDefault)}function zi(e){var t=document.getElementById("hot"+e.internalID);t!==null&&t.parentNode.removeChild(t)}function Wi(e){var t=0,n=[];switch(e){case"poi":for(var r=0,i=ar.length;r<i;r++)n.push(ar[r].value);break;case"note":for(var r=0,i=notesListDP.length;r<i;r++)n.push(notesListDP[r].value);break;case"label":for(var r=0,i=fr.length;r<i;r++)n.push(fr[r].value);break;case"labelExternal":for(var r=0,i=kn.length;r<i;r++)n.push(kn[r].id);break;case"hotspot":for(var r=0,i=kn.length;r<i;r++)n.push(kn[r].internalID)}n.sort();for(var r=0,i=n.length;r<i;r++)n[r]!=t?r=i:t++;return t}function Xi(){this.bounds=Gr(),this.currentZ=e.getZoom(),this.constrainedScale=this.currentZ<Gn?Gn:this.currentZ>Yn?Yn:this.currentZ,this.displayOffsetL=(Z.imageW*this.currentZ-_.width)/2,this.displayOffsetT=(Z.imageH*this.currentZ-_.height)/2,this.imageOffsetL=(Z.imageW/2-Z.imageX)*this.currentZ,this.imageOffsetT=(Z.imageH/2-Z.imageY)*this.currentZ}function Vi(e,t){var n=t.constrainedScale*(e.xScale/100/(e.zoom/100)),r=Math.round(Un*n),i=r<zn?zn:r>Wn?Wn:r,s=Xn*n,o=s<Vn?Vn:s>$n?$n:s,u=Z.Utils.createContainerElement("div","captionTextBox","inline-block","absolute","hidden","auto","auto","1px","1px","solid","1px","white","0px",o+"px","nowrap"),a=document.createTextNode(unescape(e.caption));return u.appendChild(a),Z.Utils.setTextStyle(a,"black","verdana",i+"px","none","normal","normal","normal","normal","1em","center","none"),Z.Utils.addEventListener(u,"contextmenu",Z.Utils.preventDefault),Z.Utils.disableTextInteraction(a),u}function $i(t,n,r,i){var s=parseFloat(t.style.padding),o=parseFloat(Z.Utils.getElementStyleProperty(t,"width"));if(isNaN(o)){var u=parseFloat(Z.Utils.getResource("DEFAULT_FONTTOPIXELSCONVERSIONFACTOR")),a=parseFloat(t.style.fontSize)/u;o=Math.round(parseFloat(t.firstChild.length*a))}var f=e.getZoom(),l=20*f,c,h;switch(n){case"1":c=-o-s,h=-l-s;break;case"2":c=(r-o)/2-s,h=-l-s;break;case"3":c=r+s,h=-l-s;break;case"4":c=-o-s,h=(i-l)/2;break;case"5":c=(r-o)/2-s,h=(i-l)/2;break;case"6":c=r+s,h=(i-l)/2;break;case"7":c=-o-s,h=i+s;break;case"8":c=(r-o)/2-s,h=i+s;break;case"9":c=r+s,h=i+s}return new Z.Utils.Point(c,h)}function Ji(e,t){var n=parseInt(Z.Utils.getResource("DEFAULT_HOTSPOTLISTWIDTH"),10),r=Gi(Kn,n,Ct,kt),i=Kn=="0"?"hidden":"visible",s=document.getElementById("hotspotList");s&&Z.ViewerDisplay.removeChild(s),Jn=new Z.Utils.createSelectElement("hotspotList",e,t,n,r.x,r.y,i,ds),P=Jn,H=P.style,Z.ViewerDisplay.appendChild(Jn)}function Ki(e,t){var n=document.getElementById("hotspotList");n!=null&&(n.options[n.options.length]=new Option(e,t))}function Qi(e,t){var n=e.childNodes[0];if(n&&n.style){n.style.visibility="visible";var r=t?"visible":"hidden",i=t?"":"#ffffff",s=t?1:.01;if(Z.browser!=Z.browsers.IE)n.style.visibility=r;else{n.style.backgroundColor=i,Z.Utils.setOpacity(n,s);var o=e.childNodes[0].childNodes[1];o&&o.style&&(o.style.visibility=r)}var u=kn.indexOfObjectValue("internalID",e.internalID);u!=-1&&(kn[u].visibility=t)}}function Gi(e,t,n,r){var i,s,o=25;switch(e){case"0":i=0,s=0;break;case"1":i=o,s=o;break;case"2":i=n-t-o,s=20;break;case"3":i=n-t-o,toolbar!=null?s=r-o:s=r-o;break;case"4":i=o,toolbar!=null?s=r-o:s=r-o;break;default:i=n-t,s=o}return new Z.Utils.Point(i,s)}function Yi(e){return Z.Utils.isStrVal(e.media)||Z.Utils.isStrVal(e.caption)}function Zi(e){var t="[Hotspot ";return t+="id:"+e.id+", ",t+="internalID:"+e.internalID.toString()+", ",t+="name:"+e.name+", ",t+="mediaType:"+e.mediaType+", ",t+="media:"+e.media+", ",t+="x:"+e.x.toString()+", ",t+="y:"+e.y.toString()+", ",t+="zoom:"+e.zoom.toString()+", ",t+="xScale:"+e.xScale.toString()+", ",t+="yScale:"+e.yScale.toString()+", ",t+="url:"+e.url+", ",t+="urlTarget:"+e.urlTarget+", ",t+="rollover:"+e.rollover+", ",t+="caption:"+e.caption+", ",t+="tooltip:"+e.tooltip,t+="]",t}function es(e){var t,n,r=Z.imageW/2,i=Z.imageH/2,s="<ZAS></ZAS>",o=Z.Utils.convertXMLTextToXMLDoc(s),u=o.getElementsByTagName("ZAS")[0],a=o.createElement("LABELSETUP");a.setAttribute("PANELPOSITION","2"),a.setAttribute("INITIALVISIBILITY","1"),a.setAttribute("NOTEVISIBILITY","1"),a.setAttribute("MINSCALE","1"),a.setAttribute("MAXSCALE","1"),u.appendChild(a);var f=e.getElementsByTagName("LABELSETUP")[0];t=f.getAttribute("PANELPOSITION"),Z.Utils.isStrVal(t)&&a.setAttribute("PANELPOSITION",t);var l=f.getAttribute("INITIALVISIBILITY");if(Z.Utils.isStrVal(l)){var c=Z.Utils.getResource("DEFAULT_HOTSPOTSINITIALVISIBILITY");c?initVis=l!="0"&&l!="hide"?"1":"0":initVis=l!="1"&&l!="show"?"0":"1",a.setAttribute("INITIALVISIBILITY",initVis)}var l=f.getAttribute("NOTEVISIBILITY");if(Z.Utils.isStrVal(l)){var c=Z.Utils.getResource("DEFAULT_ANNOTATIONNOTEVISIBILITY");c?initVis=l!="0"&&l!="hide"?"1":"0":initVis=l!="1"&&l!="show"?"0":"1",a.setAttribute("NOTEVISIBILITY",initVis)}t=f.getAttribute("MINSCALE"),Z.Utils.isStrVal(t)&&!isNaN(parseFloat(t))&&parseFloat(t)>0&&a.setAttribute("MINSCALE",t),t=f.getAttribute("MAXSCALE"),Z.Utils.isStrVal(t)&&!isNaN(parseFloat(t))&&parseFloat(t)>0&&a.setAttribute("MAXSCALE",t);var h=e.getElementsByTagName("POI");for(var p=0,d=h.length;p<d;p++){var v=o.createElement("POI");v.setAttribute("ID","0"),v.setAttribute("NAME",Z.Utils.getResource("CONTENT_POINAME")),v.setAttribute("X","center"),v.setAttribute("Y","center"),v.setAttribute("ZOOM","-1"),v.setAttribute("USER",Z.Utils.getResource("CONTENT_POIUSER")),v.setAttribute("DATE",Z.Utils.getCurrentUTCDateAsString()),u.appendChild(v);var m=e.getElementsByTagName("POI")[p];t=m.getAttribute("ID"),Z.Utils.isStrVal(t)&&v.setAttribute("ID",t),t=m.getAttribute("NAME"),Z.Utils.isStrVal(t)&&v.setAttribute("NAME",t),t=m.getAttribute("X"),Z.Utils.isStrVal(t)&&!isNaN(parseFloat(t))&&v.setAttribute("X",t=="center"?r.toString():t),t=m.getAttribute("Y"),Z.Utils.isStrVal(t)&&!isNaN(parseFloat(t))&&v.setAttribute("Y",t=="center"?i.toString():t),t=m.getAttribute("ZOOM"),Z.Utils.isStrVal(t)&&!isNaN(parseFloat(t))&&v.setAttribute("ZOOM",t),t=m.getAttribute("USER"),Z.Utils.isStrVal(t)&&v.setAttribute("USER",t),t=m.getAttribute("DATE"),Z.Utils.isStrVal(t)&&v.setAttribute("DATE",t),u.appendChild(v),v=u.getElementsByTagName("POI")[p];var g=h[p].getElementsByTagName("NOTES")[0];if(g){var y=o.createElement("NOTES");v.appendChild(y);var b=g.getElementsByTagName("NOTE");for(var w=0,E=b.length;w<E;w++){var S=o.createElement("NOTE");S.setAttribute("ID","0"),S.setAttribute("NAME",Z.Utils.getResource("CONTENT_NOTENAME")),S.setAttribute("TEXT",Z.Utils.getResource("CONTENT_NOTETEXT")),S.setAttribute("USER",Z.Utils.getResource("CONTENT_NOTEUSER")),S.setAttribute("DATE",Z.Utils.getCurrentUTCDateAsString()),y.appendChild(S);var x=g.getElementsByTagName("NOTE")[w];t=x.getAttribute("ID"),Z.Utils.isStrVal(t)&&S.setAttribute("ID",t),t=x.getAttribute("NAME"),Z.Utils.isStrVal(t)&&S.setAttribute("NAME",t),t=x.getAttribute("TEXT"),Z.Utils.isStrVal(t)&&S.setAttribute("TEXT",t),t=x.getAttribute("USER"),Z.Utils.isStrVal(t)&&S.setAttribute("USER",t),t=x.getAttribute("DATE"),Z.Utils.isStrVal(t)&&S.setAttribute("DATE",t),y.appendChild(S)}}var T=h[p].getElementsByTagName("LABELS")[0];if(T){var N=o.createElement("LABELS");v.appendChild(N);var C=T.getElementsByTagName("LABEL");for(var k=0,L=C.length;k<L;k++){var A=o.createElement("LABEL");A.setAttribute("INTERNALID","0"),A.setAttribute("ID","0"),A.setAttribute("NAME",Z.Utils.getResource("CONTENT_LABELNAME")),A.setAttribute("MEDIATYPE","url"),A.setAttribute("MEDIA","circle"),A.setAttribute("X","center"),A.setAttribute("Y","center"),A.setAttribute("ZOOM","100"),A.setAttribute("XSCALE","100"),A.setAttribute("YSCALE","100"),A.setAttribute("URL",""),A.setAttribute("URLTARGET","_blank"),A.setAttribute("ROLLOVER","0"),A.setAttribute("CAPTION",""),A.setAttribute("TOOLTIP",""),A.setAttribute("USER",Z.Utils.getResource("CONTENT_LABELUSER")),A.setAttribute("DATE",Z.Utils.getCurrentUTCDateAsString()),A.setAttribute("TOOLTIP",""),A.setAttribute("TEXTCOLOR",Z.Utils.getResource("CONTENT_ANNOTATIONSCAPTIONTEXTCOLOR")),A.setAttribute("BACKCOLOR",Z.Utils.getResource("CONTENT_ANNOTATIONSCAPTIONBACKCOLOR")),A.setAttribute("BACKVISIBLE",Z.Utils.getResource("CONTENT_ANNOTATIONSCAPTIONBACKVISIBLE")),A.setAttribute("LINECOLOR",Z.Utils.getResource("CONTENT_POLYGONLINECOLOR")),A.setAttribute("FILLCOLOR",Z.Utils.getResource("CONTENT_POLYGONFILLCOLOR")),A.setAttribute("LINEVISIBLE",Z.Utils.getResource("CONTENT_POLYGONLINEVISIBLE")),A.setAttribute("FILLVISIBLE",Z.Utils.getResource("CONTENT_POLYGONFILLVISIBLE")),A.setAttribute("CAPTIONPOSITION",Z.Utils.getResource("CONTENT_ANNOTATIONSCAPTIONPOSITION")),N.appendChild(A);var O=T.getElementsByTagName("LABEL")[k];t=O.getAttribute("ID"),Z.Utils.isStrVal(t)&&A.setAttribute("ID",t),t=O.getAttribute("NAME"),Z.Utils.isStrVal(t)&&A.setAttribute("NAME",t),t=O.getAttribute("MEDIATYPE"),Z.Utils.isStrVal(t)&&A.setAttribute("MEDIATYPE",t),t=O.getAttribute("MEDIA"),Z.Utils.isStrVal(t)&&A.setAttribute("MEDIA",t),t=O.getAttribute("X"),Z.Utils.isStrVal(t)&&!isNaN(parseFloat(t))&&A.setAttribute("X",t=="center"?r.toString():t),t=O.getAttribute("Y"),Z.Utils.isStrVal(t)&&!isNaN(parseFloat(t))&&A.setAttribute("Y",t=="center"?i.toString():t),t=O.getAttribute("ZOOM"),Z.Utils.isStrVal(t)&&!isNaN(parseFloat(t))&&A.setAttribute("ZOOM",t),t=O.getAttribute("XSCALE"),Z.Utils.isStrVal(t)&&!isNaN(parseFloat(t))&&A.setAttribute("XSCALE",t),t=O.getAttribute("YSCALE"),Z.Utils.isStrVal(t)&&!isNaN(parseFloat(t))&&A.setAttribute("YSCALE",t),t=O.getAttribute("URL"),Z.Utils.isStrVal(t)&&A.setAttribute("URL",t),t=O.getAttribute("URLTARGET"),Z.Utils.isStrVal(t)&&A.setAttribute("URLTARGET",t),t=O.getAttribute("ROLLOVER"),Z.Utils.isStrVal(t)&&A.setAttribute("ROLLOVER",t),t=O.getAttribute("CAPTION"),Z.Utils.isStrVal(t)&&A.setAttribute("CAPTION",t),t=O.getAttribute("TOOLTIP"),Z.Utils.isStrVal(t)&&A.setAttribute("TOOLTIP",t),t=O.getAttribute("USER"),Z.Utils.isStrVal(t)&&A.setAttribute("USER",t),t=O.getAttribute("DATE"),Z.Utils.isStrVal(t)&&A.setAttribute("DATE",t),t=O.getAttribute("TEXTCOLOR"),Z.Utils.isStrVal(t)&&A.setAttribute("TEXTCOLOR",t),t=O.getAttribute("BACKCOLOR"),Z.Utils.isStrVal(t)&&A.setAttribute("BACKCOLOR",t),t=O.getAttribute("LINECOLOR"),Z.Utils.isStrVal(t)&&A.setAttribute("LINECOLOR",t),t=O.getAttribute("FILLCOLOR"),Z.Utils.isStrVal(t)&&A.setAttribute("FILLCOLOR",t),t=O.getAttribute("TEXTVISIBLE"),Z.Utils.isStrVal(t)&&A.setAttribute("TEXTVISIBLE",t),t=O.getAttribute("BACKVISIBLE"),Z.Utils.isStrVal(t)&&A.setAttribute("BACKVISIBLE",t),t=O.getAttribute("LINEVISIBLE"),Z.Utils.isStrVal(t)&&A.setAttribute("LINEVISIBLE",t),t=O.getAttribute("FILLVISIBLE"),Z.Utils.isStrVal(t)&&A.setAttribute("FILLVISIBLE",t),t=O.getAttribute("CAPTIONPOSITION"),Z.Utils.isStrVal(t)&&A.setAttribute("CAPTIONPOSITION",t),n=O.getElementsByTagName("CAPTION")[0],n!=undefined&&A.appendChild(n),n=O.getElementsByTagName("TOOLTIP")[0],n!=undefined&&A.appendChild(n),n=O.getElementsByTagName("POLYGON")[0],n!=undefined&&A.appendChild(n),N.appendChild(A)}}}return o}function ts(){fr.sort(ns),lr.sort(ns)}function ns(e,t){var n=e.text.toLowerCase(),r=t.text.toLowerCase(),i=0;return n<r?i=-1:n>r&&(i=1),i}function rs(){var e=9,t=9,n=51,r=12,i=25,s=40,o=20,u=5,a=parseInt(Z.Utils.getResource("DEFAULT_ANNOTATIONPANELWIDTH"),10),f=parseInt(Z.Utils.getResource("DEFAULT_ANNOTATIONPANELHEIGHT"),10);ir||(f-=131);var l=parseInt(Z.Utils.getResource("DEFAULT_ANNOTATIONLISTWIDTH"),10),c=parseInt(Z.Utils.getResource("DEFAULT_ANNOTATIONNOTEWIDTH"),10),h=parseInt(Z.Utils.getResource("DEFAULT_ANNOTATIONNOTEHEIGHT"),10),p=is(tr,a,f,Ct,kt),d=tr=="0"?"hidden":"visible",v=document.getElementById("poiList");v&&Z.AnnotationPanelDisplay.removeChild(v);var m=document.getElementById("labelList");m&&Z.AnnotationPanelDisplay.removeChild(m);var g=document.getElementById("noteList");g&&Z.AnnotationPanelDisplay.removeChild(g),Z.AnnotationPanelDisplay||(Z.AnnotationPanelDisplay=Z.Utils.createContainerElement("div","AnnotationPanelDisplay","inline-block","absolute","hidden",a+"px",f+"px",p.x+"px",p.y+"px","solid","1px","transparent none","0px","0px","normal","default"),B=Z.AnnotationPanelDisplay,F=B.style);var y=parseFloat(Z.Utils.getResource("DEFAULT_ANNOTATIONPANELBACKALPHA")),b=Z.Utils.getResource("DEFAULT_ANNOTATIONPANELBACKCOLOR"),w=Z.Utils.getResource("DEFAULT_ANNOTATIONPANELBACKCOLORNOALPHA"),E=Z.Utils.createContainerElement("div","annotationPanelBackground","inline-block","absolute","hidden",a+"px",f+"px","0px","0px","none","0px",b,"0px","0px","normal");Z.Utils.setOpacity(E,y,w);var S=parseInt(Z.Utils.getResource("DEFAULT_ANNOTATIONPANELLABELFONTSIZE"),10),x=Z.Utils.createContainerElement("div","labelPOITextBox","inline-block","absolute","hidden",s+"px",o+"px",e+"px",r+u+"px","none","0px","transparent none","0px","0px","nowrap"),T=document.createTextNode(Z.Utils.getResource("UI_ANNOTATIONPANELLABELPOI"));x.appendChild(T),Z.Utils.setTextStyle(T,"black","verdana",S+"px","none","normal","normal","normal","normal","1em","left","none");var N=Z.Utils.createContainerElement("div","labelLabelTextBox","inline-block","absolute","hidden",s+"px",o+"px",e+"px",r+i+u+"px","none","0px","transparent none","0px","0px","nowrap"),C=document.createTextNode(Z.Utils.getResource("UI_ANNOTATIONPANELLABELLABEL"));N.appendChild(C),Z.Utils.setTextStyle(C,"black","verdana",S+"px","none","normal","normal","normal","normal","1em","left","none");var k=Z.Utils.createContainerElement("div","labelNoteTextBox","inline-block","absolute","hidden",s+"px",o+"px",e+"px",r+i*2+u+"px","none","0px","transparent none","0px","0px","nowrap"),L=document.createTextNode(Z.Utils.getResource("UI_ANNOTATIONPANELLABELNOTE"));k.appendChild(L),Z.Utils.setTextStyle(L,"black","verdana",S+"px","none","normal","normal","normal","normal","1em","left","none");var A=Z.Utils.getResource("CONTENT_ANNOTATIONPLACEHOLDERLISTTEXT"),O=[{text:A,value:"0"}];nr=new Z.Utils.createSelectElement("poiList","",O,l,n,r,d,vs),sr=new Z.Utils.createSelectElement("labelList","",O,l,n,r+i,d,ms);if(ir){rr=new Z.Utils.createSelectElement("noteList","",O,l,n,r+i*2,d,gs);var M=Z.Utils.getResource("CONTENT_ANNOTATIONPLACEHOLDERNOTETEXT"),_=parseInt(Z.Utils.getResource("DEFAULT_ANNOTATIONNOTEPADDING"),10),D=parseInt(Z.Utils.getResource("DEFAULT_ANNOTATIONNOTEFONTSIZE"),10),P=Z.Utils.createTextElement("noteTextArea",M,c+"px",h+"px",t+"px",r+i*3+3+"px",_+"px","solid","1px","auto",!0,"verdana",D+"px","none")}Z.AnnotationPanelDisplay.appendChild(E),Z.AnnotationPanelDisplay.appendChild(x),Z.AnnotationPanelDisplay.appendChild(N),Z.AnnotationPanelDisplay.appendChild(nr),Z.AnnotationPanelDisplay.appendChild(sr),rr&&(Z.AnnotationPanelDisplay.appendChild(k),Z.AnnotationPanelDisplay.appendChild(rr),Z.AnnotationPanelDisplay.appendChild(P)),Z.ViewerDisplay.appendChild(Z.AnnotationPanelDisplay),Z.Utils.updateSelectElement(nr,ar),vs()}function is(e,t,n,r,i){var s,o,u=15;switch(e){case"0":s=0,o=0;break;case"1":s=u,o=u;break;case"2":s=r-t-u,o=u;break;case"3":s=r-t-u,toolbar!=null?o=i-n-u:o=i-u;break;case"4":s=u,toolbar!=null?o=i-n-u:o=i-u;break;default:s=r-t-u,o=u}return new Z.Utils.Point(s,o)}function ss(e,t,n){fr.push({text:e,value:t,poiID:n}),lr.push({text:e,value:t,poiID:n});var r=document.getElementById("labelList");Z.Utils.updateSelectElement(r,lr),r.selectedIndex=r.length-1}function os(e){var t=document.getElementById("labelList");if(t!=null){var n=fr.indexOfObjectValue("value",e);n!=-1&&fr.splice(n,1);var n=lr.indexOfObjectValue("value",e);if(n!=-1){lr.splice(n,1),Z.Utils.updateSelectElement(t,lr);var r=t.length;r!=0&&(t.selectedIndex=n>r-1?r-1:n)}}}function us(e){var e=Z.Utils.event(e);if(e){var t=Z.Utils.target(e);Z.browser!=Z.browsers.IE&&t&&Z.Utils.isStrVal(t.id)?Qi(t,!0):Z.browser==Z.browsers.IE&&(t.parentNode.parentNode&&t.parentNode.parentNode.id.indexOf("hot")!=-1?Qi(t.parentNode.parentNode,!0):t.parentNode.parentNode.parentNode&&t.parentNode.parentNode.parentNode.id.indexOf("hot")!=-1&&Qi(t.parentNode.parentNode.parentNode,!0))}}function as(e){var e=Z.Utils.event(e);if(e){var t=Z.Utils.target(e),n=Z.Utils.relatedTarget(e);if(Z.browser!=Z.browsers.IE&&n&&Z.Utils.isStrVal(n.id)||Z.browser==Z.browsers.IE&&t.parentNode.parentNode.parentNode&&Z.Utils.isStrVal(t.parentNode.parentNode.parentNode.id))t.parentNode.parentNode&&t.parentNode.parentNode.id.indexOf("hot")!=-1?Qi(t.parentNode.parentNode,!1):t.parentNode.parentNode.parentNode&&t.parentNode.parentNode.parentNode.id.indexOf("hot")!=-1&&Qi(t.parentNode.parentNode.parentNode,!1)}}function fs(e){}function ls(e){}function cs(e){}function hs(e){}function ps(e){}function ds(t){var n="0",t=Z.Utils.event(t);if(t)var r=Z.Utils.target(t),n=r.options[r.selectedIndex].value;if(Z.Utils.isStrVal(n)){var i=kn.indexOfObjectValue("id",n);i!=-1&&e.zoomAndPanToView(kn[i].x,kn[i].y,kn[i].zoom/100)}}function vs(t){var n="0",t=Z.Utils.event(t);if(t){var r=Z.Utils.target(t);n=r.options[r.selectedIndex].value}if(Z.Utils.isStrVal(n)){var i=ar.indexOfObjectValue("value",n);if(i!=-1){var s=Z.imageW/2,o=Z.imageH/2,u;u=ar[i].x;var a=u=="center"?s:parseFloat(u);u=ar[i].y;var f=u=="center"?o:parseFloat(u);u=ar[i].zoom;var l=u=="-1"?Z.fitZ:parseFloat(u);gr?e.zoomAndPanToView(a,f,l/100):(gr=!0,Fi())}}lr=ys(fr,n),Z.Utils.updateSelectElement(sr,lr),rr&&(hr=ys(cr,n),Z.Utils.updateSelectElement(rr,hr),gs()),Z.editMode&&(An=parseInt(sr.options[sr.selectedIndex].value))}function ms(t){var t=Z.Utils.event(t),n=Z.Utils.target(t),r=n.options[n.selectedIndex].value;if(r!==null){An=parseInt(r),_n=!0;var i=kn.indexOfObjectValue("internalID",An);if(i!=-1){var s=Z.imageW/2,o=Z.imageH/2,u;u=kn[i].x;var a=u=="center"?s:parseFloat(u);u=kn[i].y;var f=u=="center"?o:parseFloat(u);u=kn[i].zoom;var l=u=="-1"?Z.fitZ:parseFloat(u);Z.polygonEditing?Fi():e.zoomAndPanToView(a,f,l/100)}}}function gs(e){var t=document.getElementById("noteTextArea");t.value="";var n="0",e=Z.Utils.event(e);if(e){var r=Z.Utils.target(e);n=r.options[r.selectedIndex].value}else hr.length>0&&(n=hr[0].value);if(Z.Utils.isStrVal(n)){var i=hr.indexOfObjectValue("value",n);i!=-1&&(t.value=hr[i].noteText)}}function ys(e,t){var n=[];for(var r=0,i=e.length;r<i;r++)e[r].poiID==t&&n.push(e[r]);return n}function bs(e,t){if(Z.useCanvas){var n=e.internalID;!Z.polygonEditing||n!==An?targetCtx=U:targetCtx=V,targetCtx.save(),targetCtx.translate((e.x-Z.imageX)*Z.imageZ,(e.y-Z.imageY)*Z.imageZ);var r=G/Y,i=t.constrainedScale*(e.xScale/100/(e.zoom/100))/r,s=t.constrainedScale*(e.yScale/100/(e.zoom/100))/r;targetCtx.scale(i,s);var o=e.polygonPts,u=e.x,a=e.y;targetCtx.lineWidth=Bn;if(!e.fillVisible||!_n)targetCtx.lineWidth*=3;targetCtx.strokeStyle=e.lineColor,targetCtx.fillStyle=e.fillColor,targetCtx.beginPath();var f=o[0].x-u,l=o[0].y-a;targetCtx.moveTo(f,l);for(var c=1,h=o.length;c<h;c++){var p=o[c].x-u,d=o[c].y-a;targetCtx.lineTo(p,d)}if(_n||n!=An||Ut&&Dn==0)targetCtx.lineTo(f,l),targetCtx.closePath(),e.fillVisible&&(_n||n!=An)&&(targetCtx.globalAlpha=.5,targetCtx.fill()),targetCtx.globalAlpha=1;targetCtx.stroke();var v=(i+s)/2;if(Z.polygonEditing&&e.internalID==An)for(var c=0,h=o.length;c<h;c++){var p=o[c].x-u,d=o[c].y-a;ws(p,d,!_n&&c==0,v)}targetCtx.restore()}else Mn||(Z.Utils.showMessage(Z.Utils.getResource("ALERT_POLYGONSREQUIRECANVAS")),Mn=!0)}function ws(e,t,n,r){var i=Rn;r!==undefined&&r!==null&&(i/=r),V.lineWidth=jn,V.strokeStyle=Fn,V.fillStyle=n?In:qn,V.beginPath(),V.arc(e,t,i,0,Math.PI*2,!1),V.closePath(),V.globalAlpha=.5,V.fill(),V.globalAlpha=1,V.stroke()}function Es(e,t){Xr(W);var n=new Xi,r=kn.indexOfObjectValue("internalID",An);if(r!=-1){bs(kn[r],n);var i=Z.imageX,s=Z.imageY,o=Z.imageZ,u=kn[r].polygonPts,a=u[u.length-1],f=(a.x-i)*o,l=(a.y-s)*o;_n||(V.lineWidth=jn,V.strokeStyle=Fn,V.moveTo(f,l),V.lineTo(e,t),V.stroke())}}function Ss(e){q&&Xr(q),W&&Xr(W);var t=new Xi;for(var n=0,r=kn.length;n<r;n++)if(kn[n].media=="polygon"){var i=kn[n].x,s=kn[n].y;i>t.bounds.left&&i<t.bounds.right&&s>t.bounds.top&&s<t.bounds.bottom&&(e||!Z.polygonEditing||An===null||An!==n)&&bs(kn[n],t)}}function xs(e,t,n){Pn=!0,Xr(W);var r=new Xi,i=kn.indexOfObjectValue("internalID",e);i!=-1&&(kn[i].polygonPts[t]=n,bs(kn[i],r))}function Ts(e,t){if(An===null)Ns(null,!0,t);else{var n=kn.indexOfObjectValue("internalID",An);n!=-1&&(On=kn[n].polygonPts,On===null?Ns(An,!0,t):(Dn=Cs(e,t),_n?Dn===null&&Ns(null,!0,t):Dn===null?Ns(An,!1,t):Dn==0&&kn[n].polygonPts.length>2&&ks(An)))}}function Ns(e,t,n){var r=!1,i=!1;if(e===null){var s=Wi("label"),o=Wi("labelExternal"),u="<LABEL ID='"+o.toString()+"' INTERNALID='"+s.toString()+"' NAME='Polygon "+s.toString()+"' MEDIATYPE='symbol' MEDIA='polygon' X='"+n.x.toString()+"' Y='"+n.y.toString()+"' ZOOM='"+"100"+"' XSCALE='100' YSCALE='100' URL='' URLTARGET='' ROLLOVER='0' CAPTION='' TOOLTIP='' LINECOLOR='ffffff' FILLCOLOR='999999' FILLVISIBLE='1' CAPTIONPOSITION='8' ><POLYGON><POINT X='"+n.x.toString()+"' Y='"+n.y.toString()+"' ></POINT></POLYGON></LABEL>",a=Z.Utils.convertXMLTextToXMLDoc(u),f=a.getElementsByTagName("LABEL"),l=new Pi(f[0]);poiCurrentID=nr.options[nr.selectedIndex].value,l.poiInternalID=poiCurrentID,l.saved=!1,kn.push(l);var c=nr.options[nr.selectedIndex].value;An=s,ss(l.name,An,c),i=!0,r=!0}else{var h=kn.indexOfObjectValue("internalID",e);if(h!=-1){var p=kn[h].polygonPts;p.push({x:n.x,y:n.y}),kn[h].polygonPts=p,kn[h].saved=!1}}var d=(n.x-Z.imageX)*Z.imageZ,v=(n.y-Z.imageY)*Z.imageZ;ws(d,v,r),_n=!1,i?Fi():t&&Ss()}function Cs(e,t){var n=null,r=(Rn+1)/Z.imageZ;for(var i=0,s=kn.length;i<s;i++)if(kn[i].media=="polygon"&&kn[i].internalID==An){var o=kn[i].polygonPts;for(var u=0,a=o.length;u<a;u++)Z.Utils.calculatePointsDistance(t.x,t.y,o[u].x,o[u].y)<r&&(n=u)}return n}function ks(e){Xr(W),_n=!0;var t=kn.indexOfObjectValue("internalID",e);if(t!=-1){var n=Z.Utils.getCenterOfPolygonPoints(kn[t].polygonPts);kn[t].x=n.x,kn[t].y=n.y,kn[t].caption="Polygon "+e.toString();var r=new Xi;Ri(kn[t],r)}}function Ls(e){var t,n,r=Z.imageW/2,i=Z.imageH/2,s="<ZAS></ZAS>",o=Z.Utils.convertXMLTextToXMLDoc(s),u=o.getElementsByTagName("ZAS")[0],a=o.createElement("LABELSETUP");a.setAttribute("PANELPOSITION","2"),a.setAttribute("INITIALVISIBILITY","1"),a.setAttribute("MINSCALE","1"),a.setAttribute("MAXSCALE","1");var f=e.getElementsByTagName("LABELSETUP")[0];t=f.getAttribute("PANELPOSITION"),Z.Utils.isStrVal(t)&&a.setAttribute("PANELPOSITION",t),t=f.getAttribute("INITIALVISIBILITY"),Z.Utils.isStrVal(t)&&a.setAttribute("INITIALVISIBILITY",t),t=f.getAttribute("MINSCALE"),Z.Utils.isStrVal(t)&&!isNaN(parseFloat(t))&&parseFloat(t)>0&&a.setAttribute("MINSCALE",t),t=f.getAttribute("MAXSCALE"),Z.Utils.isStrVal(t)&&!isNaN(parseFloat(t))&&parseFloat(t)>0&&a.setAttribute("MAXSCALE",t),u.appendChild(a);var l=e.getElementsByTagName("POI");for(var c=0,h=l.length;c<h;c++){var p=o.createElement("POI");p.setAttribute("ID","0"),p.setAttribute("NAME",Z.Utils.getResource("CONTENT_POINAME")),p.setAttribute("X","center"),p.setAttribute("Y","center"),p.setAttribute("ZOOM","-1"),p.setAttribute("USER",Z.Utils.getResource("CONTENT_POIUSER")),p.setAttribute("DATE",Z.Utils.getCurrentUTCDateAsString());var d=l[c];t=d.getAttribute("ID"),Z.Utils.isStrVal(t)&&p.setAttribute("ID",t),t=d.getAttribute("NAME"),Z.Utils.isStrVal(t)&&p.setAttribute("NAME",t),t=d.getAttribute("X"),Z.Utils.isStrVal(t)&&!isNaN(parseFloat(t))&&p.setAttribute("X",t=="center"?r.toString():t),t=d.getAttribute("Y"),Z.Utils.isStrVal(t)&&!isNaN(parseFloat(t))&&p.setAttribute("Y",t=="center"?i.toString():t),t=d.getAttribute("ZOOM"),Z.Utils.isStrVal(t)&&!isNaN(parseFloat(t))&&p.setAttribute("ZOOM",t),t=d.getAttribute("USER"),Z.Utils.isStrVal(t)&&p.setAttribute("USER",t),t=d.getAttribute("DATE"),Z.Utils.isStrVal(t)&&p.setAttribute("DATE",t),u.appendChild(p);var v=l[c].getElementsByTagName("NOTES")[0];if(typeof v!="undefined"){var m=o.createElement("NOTES");p.appendChild(m);var g=v.getElementsByTagName("NOTE");for(var y=0,b=g.length;y<b;y++){var w=o.createElement("NOTE");w.setAttribute("ID","0"),w.setAttribute("NAME",Z.Utils.getResource("CONTENT_NOTENAME")),w.setAttribute("TEXT",Z.Utils.getResource("CONTENT_NOTETEXT")),w.setAttribute("USER",Z.Utils.getResource("CONTENT_NOTEUSER")),w.setAttribute("DATE",Z.Utils.getCurrentUTCDateAsString());var E=g[y];t=E.getAttribute("ID"),Z.Utils.isStrVal(t)&&w.setAttribute("ID",t),t=E.getAttribute("NAME"),Z.Utils.isStrVal(t)&&w.setAttribute("NAME",t),t=E.getAttribute("TEXT"),Z.Utils.isStrVal(t)&&w.setAttribute("TEXT",t),t=E.getAttribute("USER"),Z.Utils.isStrVal(t)&&w.setAttribute("USER",t),t=E.getAttribute("DATE"),Z.Utils.isStrVal(t)&&w.setAttribute("DATE",t),m.appendChild(w)}}if(kn.length>0){var S=o.createElement("LABELS");p.appendChild(S);for(var x=0,T=kn.length;x<T;x++){var N=o.createElement("LABEL");N.setAttribute("ID",kn[x].id),N.setAttribute("NAME",kn[x].name),N.setAttribute("MEDIATYPE",kn[x].mediaType),N.setAttribute("MEDIA",kn[x].media),N.setAttribute("X",kn[x].x),N.setAttribute("Y",kn[x].y),N.setAttribute("ZOOM",kn[x].zoom),N.setAttribute("XSCALE",kn[x].xScale),N.setAttribute("YSCALE",kn[x].yScale),N.setAttribute("URL",kn[x].url),N.setAttribute("URLTARGET",kn[x].urlTarget),N.setAttribute("ROLLOVER",kn[x].rollover),N.setAttribute("CAPTION",kn[x].caption),N.setAttribute("TOOLTIP",kn[x].tooltip),N.setAttribute("CAPTIONPOSITION",kn[x].captionPosition),N.setAttribute("USER",Z.Utils.getResource("CONTENT_LABELUSER")),N.setAttribute("DATE",Z.Utils.getCurrentUTCDateAsString());var C=kn[x].polygonPts;if(C!=null){var k=o.createElement("POLYGON");for(var L=0,A=C.length;L<A;L++){var O=o.createElement("POINT");O.setAttribute("X",C[L].x),O.setAttribute("Y",C[L].y),k.appendChild(O)}N.appendChild(k)}S.appendChild(N)}}}return o}function As(t,n,r){e.zoomAndPanAllStop(),Z.imageZ=Ci(r);var i=xi(t,n);Z.imageX=i.x,Z.imageY=i.y,e.updateView(!0)}function Os(){sn&&(Yt!=0||Zt!=0||en!=0)&&(Ms(Yt,Zt,en),sn=window.setTimeout(Os,rn))}function Ms(e,t,n){var r=!1,i=!1,s=!1;if(n!=0){var o=G*(1+n),u=ei(J,o);constrainedZoom=Ci(u);if(constrainedZoom!=Z.imageZ)var i=s=Hs(constrainedZoom)}if(e!=0||t!=0){var a=parseFloat(v.left)+e,f=parseFloat(v.top)+t,l=Ni(a,f);v.left=l.x+"px",v.top=l.y+"px",r=!0,s=!0}tn%2==0&&(Mi(),Fi(),i&&Vr(),s&&$r())}function _s(t,n,r,i,s){pn++;var o=i/s,u=pn*o,a=Z.Utils.easing(Z.imageX,t,u,i),f=Z.Utils.easing(Z.imageY,n,u,i),l=Z.Utils.easing(Z.imageZ,r,u,i),c=ii(a,f,l),h=c.x,p=c.y;if(h!=parseFloat(v.left)||p!=parseFloat(v.top))syncNav=!0;var d=syncNav=Hs(l);v.left=h+"px",v.top=p+"px",Fi(),pn%2==0&&(d&&Vr(),syncNav&&$r()),pn<s+1?hn=window.setTimeout(function(){_s(t,n,r,i,s)},o):(Ps(),e.updateView(),e.toggleWatermarks(!0))}function Ds(){sn&&(window.clearTimeout(sn),sn=null),Yt=0,Zt=0,en=0,tn=0}function Ps(){hn&&(window.clearTimeout(hn),hn=null)}function Hs(e){var t=!1,n=ti(J,e);if(n!=G){G=n,et=ti(K,e);var r=n/Y,i=Ot*r,s=Mt*r,o=(Ot-i)/2,u=(Mt-s)/2;if(n<Y){var a=Ti(o,u);v.left=Pt+a.x-o+"px",v.top=Bt+a.y-u+"px"}if(Z.useCanvas)S.width=i+"px",S.height=s+"px",S.left=o+"px",S.top=u+"px",q&&(R.width=i+"px",R.height=s+"px",R.left=o+"px",R.top=u+"px"),W&&(X.width=i+"px",X.height=s+"px",X.left=o+"px",X.top=u+"px"),i=Ft*r,s=It*r,o=qt+Z.imageX*(1-r)*Z.imageZ,u=Rt+Z.imageY*(1-r)*Z.imageZ,y.width=i+"px",y.height=s+"px",y.left=o+"px",y.top=u+"px";else{Ur(E,J,lt,"centerOut",!1,"Scaling: non-canvas zoom"),tierBackfillW=rt[K],tierBackfillH=it[K],g.width=tierBackfillW,g.height=tierBackfillH;var f=tierBackfillW*et,l=tierBackfillH*et,c=Z.imageX*e,h=Z.imageY*e;qt=_t-c,Rt=Dt-h,y.left=qt+"px",y.top=Rt+"px",Ur(g,K,tt,"simple",!1,"Scaling: non-canvas zoom - backfill")}t=!0}return t}function Bs(e){e?(En||js(),En.elmt.style.display="inline-block"):En&&(En.elmt.style.display="none")}function js(){var e=Z.Utils.getResource("DEFAULT_FPCANCELBUTTONTEXT"),t=34,n=34,r=20,i=parseFloat(Z.viewerW)-(t+r),s=parseFloat(Z.viewerH)-(n+r),o=Z.Utils.getResource("DEFAULT_FPCANCELBUTTONCOLOR");En=new Z.Utils.Button("buttonFPCancel",e,null,null,null,null,t+"px",n+"px",i+"px",s+"px","mousedown",Fs,"TIP_CANCELFULLPAGE","solid","1px",o,"0px","0px"),Z.ViewerDisplay.appendChild(En.elmt)}function Fs(){e.toggleFullPageView(!1)}function Is(){Z.Utils.addEventListener(document,"keydown",to),Z.Utils.addEventListener(document,"keyup",no),Z.mobileDevice?(Z.Utils.addEventListener(d,"touchstart",Xs),Z.Utils.addEventListener(d,"touchmove",Vs),Z.Utils.addEventListener(d,"touchend",$s),Z.Utils.addEventListener(d,"touchcancel",Js),Z.Utils.addEventListener(d,"gesturestart",Ks),Z.Utils.addEventListener(d,"gesturechange",Qs),Z.Utils.addEventListener(d,"gestureend",Gs),document.getElementsByTagName("body")[0].onorientationchange=eo):(Z.Utils.addEventListener(Z.ViewerDisplay,"mouseover",qs),Z.Utils.addEventListener(Z.ViewerDisplay,"mouseout",Ws),Z.Utils.addEventListener(Z.ViewerDisplay,"mousemove",Z.Utils.preventDefault),Z.Utils.addEventListener(d,"mousedown",Rs),Z.Utils.addEventListener(d,"mousemove",Z.Utils.preventDefault)),Z.Utils.addEventListener(g,"contextmenu",Z.Utils.preventDefault),Z.Utils.addEventListener(E,"contextmenu",Z.Utils.preventDefault),A&&Z.Utils.addEventListener(A,"contextmenu",Z.Utils.preventDefault),_&&Z.Utils.addEventListener(_,"contextmenu",Z.Utils.preventDefault)}function qs(e){var t=Z.Utils.nodeIsInViewer(Z.Utils.target(Z.Utils.event(e))),n=Z.Utils.nodeIsInViewer(Z.Utils.relatedTarget(e));if(!t||!n)Z.ToolbarDisplay&&Z.toolbarVisible>1&&Z.Toolbar.show(!0),Z.NavigatorDisplay&&Z.navigatorVisible>1&&Z.Navigator.setVisibility(!0),zt=null}function Rs(t){var n=window.setTimeout(function(){e.zoomAndPanAllStop()},1);if(Z.Utils.isRightMouseButton(t))return;Ut=!0;var r=Z.Utils.getMousePosition(t);Wt=new Z.Utils.Point(r.x,r.y),d.mouseXPrior=r.x,d.mouseYPrior=r.y;if(Z.polygonEditing&&An!==null){var i=e.getClickZoomCoords3D(t,Wt,J,G);Dn=Cs(t,i)}return Z.Utils.addEventListener(document,"mousemove",Us),Z.Utils.addEventListener(d,"mouseup",zs),Z.Utils.addEventListener(document,"mouseup",zs),!1}function Us(t){var t=Z.Utils.event(t),n=Z.Utils.getMousePosition(t);Xt=new Z.Utils.Point(n.x,n.y);var r=e.getClickZoomCoords3D(t,Xt,J,G);if(Z.polygonEditing&&Dn!==null&&Ut)xs(An,Dn,r);else if(Z.polygonEditing&&!_n&&(!Ut||Ut&&Dn!==null)){var i=(r.x-Z.imageX)*Z.imageZ,s=(r.y-Z.imageY)*Z.imageZ;Es(i,s)}else{if(!Z.mousePan)return;var o=n.x-d.mouseXPrior,u=n.y-d.mouseYPrior;if(!isNaN(o)&&!isNaN(u)){var a=parseFloat(v.left)+o,f=parseFloat(v.top)+u,l=Ni(a,f);v.left=l.x+"px",v.top=l.y+"px",d.mouseXPrior=n.x,d.mouseYPrior=n.y;if(Z.Navigator){var c=e.calculateCurrentCenterCoordinates(l);Z.Navigator.syncNavigatorRectanglePosition(c)}}}return!1}function zs(t){Ut=!1,document.mousemove=null,document.mouseup=null,Z.Utils.removeEventListener(document,"mousemove",Us),Z.Utils.removeEventListener(d,"mouseup",zs),Z.Utils.removeEventListener(document,"mouseup",zs);var t=Z.Utils.event(t),n=Z.Utils.getMousePosition(t),r;zt?r=zt:r=new Z.Utils.Point(n.x,n.y);var i=Z.Utils.calculatePointsDistance(Wt.x,Wt.y,r.x,r.y,2);if(i<4){var s=e.getClickZoomCoords3D(t,r,J,G);if(Z.clickZoom&&!Z.polygonEditing)var o=window.setTimeout(function(){e.zoomAndPanToView(s.x,s.y,s.z)},1);else Z.clickPan&&!Z.polygonEditing?e.zoomAndPanToView(s.x,s.y,Z.imageZ):Z.polygonEditing&&(Ts(t,s),_n||Z.Utils.addEventListener(document,"mousemove",Us))}else{if(Z.polygonEditing&&(Pn||Dn===null&&!_n)){Dn=null,Pn=!1;var u=new Xi,a=kn.indexOfObjectValue("internalID",An);if(a!=-1){var f=Z.Utils.getCenterOfPolygonPoints(kn[a].polygonPts);kn[a].x=f.x,kn[a].y=f.y,Xr(W),Ri(kn[a],u),_n||Z.Utils.addEventListener(document,"mousemove",Us)}}Xt=null,Z.mousePan&&e.updateView()}zt&&(Z.ToolbarDisplay&&Z.toolbarVisible>1&&Z.Toolbar.show(!1),Z.NavigatorDisplay&&Z.navigatorVisible>1&&Z.Navigator.setVisibility(!1))}function Ws(e){var t=Z.Utils.nodeIsInViewer(Z.Utils.target(e)),n=Z.Utils.nodeIsInViewer(Z.Utils.relatedTarget(Z.Utils.event(e)));if(!t||!n)if(!Ut)Z.ToolbarDisplay&&Z.toolbarVisible>1&&Z.Toolbar.show(!1),Z.NavigatorDisplay&&Z.navigatorVisible>1&&Z.Navigator.setVisibility(!1);else{var r=Z.Utils.getMousePosition(e);zt=new Z.Utils.Point(r.x,r.y)}}function Xs(t){e.zoomAndPanAllStop();var t=Z.Utils.event(t),n=Z.Utils.getFirstTouch(t);if(n&&!Vt){Jt=!1;var r=n.target,i=new Z.Utils.Point(n.pageX,n.pageY);Wt=new Z.Utils.Point(i.x,i.y),d.mouseXPrior=i.x,d.mouseYPrior=i.y;if(Z.polygonEditing){Ut=!0;if(An!==null){var s=e.getClickZoomCoords3D(t,Wt,J,G);Dn=Cs(t,s)}}}}function Vs(t){var t=Z.Utils.event(t);t.preventDefault();var n=Z.Utils.getFirstTouch(t),r=new Z.Utils.Point(n.pageX,n.pageY);Xt=new Z.Utils.Point(r.x,r.y);var i=e.getClickZoomCoords3D(t,Xt,J,G);if(Z.polygonEditing&&Dn!==null&&Ut)xs(An,Dn,i);else{if(!Z.mousePan)return;if(n&&!Vt&&!Jt){var s=n.target,o=r.x-d.mouseXPrior,u=r.y-d.mouseYPrior;if(!isNaN(o)&&!isNaN(u)){var a=parseFloat(v.left)+o,f=parseFloat(v.top)+u,l=Ni(a,f);v.left=l.x+"px",v.top=l.y+"px",d.mouseXPrior=r.x,d.mouseYPrior=r.y;if(Z.Navigator){var c=e.calculateCurrentCenterCoordinates(l);Z.Navigator.syncNavigatorRectanglePosition(c)}}}}return!1}function $s(t){var t=Z.Utils.event(t);if(!Vt&&!Jt){Ut=!1,typeof Xt!="undefined"&&Xt!==null?dragPtEnd=Xt:dragPtEnd=Wt;var n=Z.Utils.calculatePointsDistance(Wt.x,Wt.y,dragPtEnd.x,dragPtEnd.y,2);if(n<4){var r=e.getClickZoomCoords3D(t,dragPtEnd,J,G);Z.clickZoom&&!Z.polygonEditing?e.zoomAndPanToView(r.x,r.y,r.z):Z.clickPan&&!Z.polygonEditing?e.zoomAndPanToView(r.x,r.y,Z.imageZ):Z.polygonEditing&&Ts(t,r)}else{if(Z.polygonEditing&&(Pn||Dn===null&&!_n)){Dn=null,Pn=!1;var i=new Xi,s=kn.indexOfObjectValue("internalID",An);if(s!=-1){var o=Z.Utils.getCenterOfPolygonPoints(kn[s].polygonPts);kn[s].x=o.x,kn[s].y=o.y,Xr(W),Ri(kn[s],i),_n||Z.Utils.addEventListener(document,"mousemove",Us)}}Z.mousePan&&e.updateView()}Xt=null}}function Js(t){var t=Z.Utils.event(t);if(!Vt&&!Jt){Ut=!1;var n=!1;typeof Xt!="undefined"&&Xt!==null?dragPtEnd=Xt:dragPtEnd=Wt;var r=Z.Utils.calculatePointsDistance(Wt.x,Wt.y,dragPtEnd.x,dragPtEnd.y,2);if(r<4){var i=e.getClickZoomCoords3D(t,dragPtEnd,J,G);Z.clickZoom&&!Z.polygonEditing?e.zoomAndPanToView(i.x,i.y,i.z):Z.clickPan&&!Z.polygonEditing?e.zoomAndPanToView(i.x,i.y,Z.imageZ):Z.polygonEditing&&Ts(t,i)}else{if(Z.polygonEditing&&(Pn||Dn===null&&!_n)){Dn=null,Pn=!1;var s=new Xi,o=kn.indexOfObjectValue("internalID",An);if(o!=-1){var u=Z.Utils.getCenterOfPolygonPoints(kn[o].polygonPts);kn[o].x=u.x,kn[o].y=u.y,Xr(W),Ri(kn[o],s),_n||Z.Utils.addEventListener(document,"mousemove",Us)}}Z.mousePan&&e.updateView()}Xt=null}}function Ks(t){e.zoomAndPanAllStop();var t=Z.Utils.event(t);Qs(t),Vt||(Vt=window.setInterval(Ys,Kt))}function Qs(e){var e=Z.Utils.event(e);e.preventDefault(),$t=Math.round(e.scale*100)/100}function Gs(t){Vt&&(window.clearInterval(Vt),Jt=!0,Vt=null),Z.mousePan&&e.updateView()}function Ys(e){if(!Z.mousePan)return;var t=Zs(J,Y,$t),n=Ci(t);t!=Z.imageZ&&Hs(n)}function Zs(e,t,n){var r=t*n,i=ei(e,r);return i}function eo(t){Z.fullPage&&(Z.ToolbarDisplay&&Z.toolbarVisible>1&&Z.Toolbar.show(!1),Z.NavigatorDisplay&&Z.navigatorVisible>1&&Z.Navigator.setVisibility(!1),e.toggleFullPageView(!1),e.toggleFullPageView(!0),Z.ToolbarDisplay&&Z.toolbarVisible>1&&Z.Toolbar.show(!0),Z.NavigatorDisplay&&Z.navigatorVisible>1&&Z.Navigator.setVisibility(!0))}function to(t){if(!Z.keys)return;t.altKey||Ps();var t=Z.Utils.event(t);switch(t.keyCode){case 90:e.zoom("out");break;case 17:e.zoom("out");break;case 65:e.zoom("in");break;case 16:e.zoom("in");break;case 37:e.pan("left");break;case 38:e.pan("up");break;case 40:e.pan("down");break;case 39:e.pan("right");break;case 27:Z.fullPage?e.toggleFullPageView(!1):e.reset()}}function no(t){if(!Z.keys)return;var t=Z.Utils.event(t),n=t.keyCode;n==90||n==17||n==65||n==16?e.zoom("stop"):n==37||n==39?e.pan("horizontalStop"):(n==38||n==40)&&e.pan("verticalStop")}var e=this,t=!1,n=-1,r=0,i=0,s=256,o=0,u=256,a,f=parseFloat(Z.Utils.getResource("DEFAULT_TIERSMAXSCALEUP")),l=f/2,c=parseInt(Z.Utils.getResource("DEFAULT_TILESMAXCACHE"),10),h=Z.toolbarVisible==1?Z.toolbarH:0,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,F,I,q,R,U,z,W,X,V;Nr();var $=1,J=0,K=0,Q=!1,G,Y,et,tt=[],nt=[],rt=[],it=[],st=[],ot=[],ut=[],at=[],ft=[],lt=[],ct=[],ht=[],pt=[],dt=[],vt=[],mt=[],gt=[],yt=0,bt=new Z.NetConnector,wt=parseInt(Z.Utils.getResource("DEFAULT_BACKFILLTHRESHOLD2"),10),Et=parseInt(Z.Utils.getResource("DEFAULT_BACKFILLTHRESHOLD1"),10),St=parseInt(Z.Utils.getResource("DEFAULT_BACKFILLCHOICE2"),10),xt=parseInt(Z.Utils.getResource("DEFAULT_BACKFILLCHOICE1"),10),Tt=parseInt(Z.Utils.getResource("DEFAULT_BACKFILLCHOICE0"),10),Nt=parseFloat(Z.Utils.getResource("DEFAULT_PANBUFFER"),10),Ct,kt,Lt,At,Ot,Mt,_t,Dt,Pt,Ht,Bt,jt,Ft,It,qt,Rt;Ct=Z.viewerW,kt=Z.viewerH,Lt=At=0,kt-=h,Z.toolbarPosition==0&&(At+=h);var Ut=!1,zt=null,Wt,Xt,Vt=null,$t=null,Jt=!1,Kt=parseInt(Z.Utils.getResource("DEFAULT_GESTURETESTDURATION"),10),Qt=parseFloat(Z.Utils.getResource("DEFAULT_ZOOMSTEPDISTANCE"))*Z.zoomSpeed;Z.mobileDevice&&(Qt/=2);var Gt=Math.round(parseFloat(Z.Utils.getResource("DEFAULT_PANSTEPDISTANCE"))*Z.panSpeed),Yt=0,Zt=0,en=0,tn=0,nn=0,rn=parseInt(Z.Utils.getResource("DEFAULT_ZAPSTEPDURATION"),10),sn,on,un,an=parseFloat(Z.Utils.getResource("DEFAULT_FADEINSTEP"))*Z.fadeInSpeed,fn,ln=parseFloat(Z.Utils.getResource("DEFAULT_ZAPTVDURATION")),cn=parseFloat(Z.Utils.getResource("DEFAULT_ZAPTVSTEPS"));Z.mobileDevice&&(cn/=2);var hn=null,pn=0,dn,vn,mn,gn,yn,bn,wn,En,Sn;if(Z.Utils.isStrVal(Z.watermarkPath))var xn,Tn,Nn=[],Cn=[];if(Z.Utils.isStrVal(Z.hotspotPath)||Z.Utils.isStrVal(Z.annotationPath)){var kn=[],Ln=[],An=null,On=null,Mn=!1,_n=!0,Dn=null,Pn=!1,Hn=new Z.NetConnector,Bn=Z.Utils.getResource("DEFAULT_POLYGONLINEWIDTH"),jn=Z.Utils.getResource("DEFAULT_CONTROLPOINTLINEWIDTH"),Fn=Z.Utils.getResource("DEFAULT_CONTROLPOINTSTROKECOLOR"),In=Z.Utils.getResource("DEFAULT_FIRSTCONTROLPOINTFILLCOLOR"),qn=Z.Utils.getResource("DEFAULT_STANDARDCONTROLPOINTFILLCOLOR"),Rn=parseInt(Z.Utils.getResource("DEFAULT_CONTROLPOINTRADIUS"),10),Un=parseInt(Z.Utils.getResource("DEFAULT_HOTSPOTCAPTIONFONTSIZE"),10),zn=parseInt(Z.Utils.getResource("DEFAULT_MINHOTSPOTCAPTIONFONTSIZE"),10),Wn=parseInt(Z.Utils.getResource("DEFAULT_MAXHOTSPOTCAPTIONFONTSIZE"),10),Xn=parseInt(Z.Utils.getResource("DEFAULT_HOTSPOTCAPTIONPADDING"),10),Vn=parseInt(Z.Utils.getResource("DEFAULT_MINHOTSPOTCAPTIONPADDING"),10),$n=parseInt(Z.Utils.getResource("DEFAULT_MAXHOTSPOTCAPTIONPADDING"),10);Z.mobileDevice&&(Rn*=2);if(Z.Utils.isStrVal(Z.hotspotPath))var Jn,Kn,Qn,Gn,Yn,Zn=[];else if(Z.Utils.isStrVal(Z.annotationPath))var er,tr,nr,rr,ir,sr,or,ur,ar=[],fr=[],lr=[],cr=[],hr=[],pr=[],dr=[],vr=[],mr=[],gr=!1}Cr(Ct,kt,Lt,At);if(Z.imageProperties==null){var yr=new Z.NetConnector;kr(yr)}else{var br=Z.Utils.convertXMLTextToXMLDoc(Z.imageProperties);Lr(br)}this.getInitialized=function(){return xr()},this.getW=function(){return Ot},this.getH=function(){return Mt},this.getTierCount=function(){return $},this.getTileSize=function(){return a},this.getTierCurrent=function(){return J},this.getTierScale=function(){return G},this.getX=function(){var t=parseFloat(v.left)-Pt,n=e.getZoom(),r=Z.imageX-t/n;return r},this.getY=function(){var t=parseFloat(v.top)-Bt,n=e.getZoom(),r=Z.imageY-t/n;return r},this.getZoom=function(){var e=ei(J,G);return e},this.getTiersMaxScaleUp=function(){return f},this.getTiersMaxScaleDown=function(){return l},this.getTilesMaxCache=function(){return c},this.getTierWs=function(){return rt.join(",")},this.getTierHs=function(){return it.join(", ")},this.getTierTileCounts=function(){return ut.join(", ")},this.getTilesLoadingNames=function(){var e=ft.join(", ")==""?"Current view loading complete":ft.join(", ");return e},this.setSizeAndPosition=function(e,t,n,r){Cr(e,t,n,r)},this.setHotspotPath=function(e){_&&(Z.hotspotPath=Z.Utils.removeTrailingSlashCharacters(e))},this.loadImageProperties=function(e){kr(e)},this.parseImageXML=function(e){Lr(e)},this.updateView=function(n){if(typeof n!="undefined"&&n===!0||G!=Y||Z.imageZ!=nn||parseFloat(v.left)!=Pt||parseFloat(v.top)!=Bt){Fr(n),nn=e.getZoom();var r=!1;n||G!=Y||Z.imageZ!=nn||!t?(Ir(),qr(),Ur(g,K,tt,"simple",!1,"2. Updating view: changing tier - backfill"),!n&&c>0&&(r=!0)):Z.debug==2&&Z.Utils.trace("2. Updating view: no change to tier."),Rr(),Ur(E,J,lt,"centerOut",r,"3. Updating view: prior to loading of any new tiles"),Wr(ft,pi,0),Mi(),Fi(),Vr(),$r()}},this.formatTilePath=function(e,t,a,f){var l;if(Z.tileSource=="ZoomifyImageFolder"){var c=a*st[e]+t;for(var h=0;h<e;h++)c+=ut[h];var p=Math.floor(c/u);l=Z.imagePath+"/"+"TileGroup"+p+"/"+e+"-"+t+"-"+a+".jpg",l=Z.Utils.cacheProofPath(l)}else if(Z.tileSource=="ZoomifyImageFile"){var d=0,v=0,m,g,y,b,w,E,S,x,l="offsetLoading";for(var T=$-1;T>e;T--)d+=ut[T];d+=a*st[e]+t,m=Math.floor(d/s),v=d-1==-1?0:d-1,g=Math.floor(v/s);if(pt[m]==undefined||pt[m]=="offsetLoading"||pt[g]==undefined||pt[g]=="offsetLoading"){var N=oi(e,t,a);vt.push(N+","+e+","+t+","+a+","+f),Z.debug==2&&Z.Utils.trace("Tile recorded for load retry after load chunk: "+N+","+e+","+t+","+a+","+f),pt[m]==undefined&&(pt[m]="offsetLoading",w=i+s*m*8,E=w+s*8,ui(w,E,N)),pt[g]==undefined&&(pt[g]="offsetLoading",S=i+s*g*8,x=S+s*8,ui(S,x,N))}else{var C=Math.floor(pt[m][0]),k=Math.floor(pt[g][0]),L=pt[g][1],A=pt[m][1];b=9*(v%s);var O=Math.floor(parseFloat(L.substring(b,b+9)));y=9*(d%s);var M=Math.floor(parseFloat(A.substring(y,y+9))),_=d==0?i+o*8:k+O,D=C+M;D-_>0?l=Z.tileHandlerPathFull+"?file="+Z.imagePath+"&requestType=0&begin="+_.toString()+"&end="+D.toString()+"&vers="+n.toString()+"&head="+r.toString():l="skipTile:"+e+"-"+t+"-"+a}}return l},this.parseOffsetChunk=function(e){var t=parseInt(e.documentElement.getAttribute("BEGIN"),10),n=e.documentElement.getAttribute("REPLYDATA"),r=dt[t],o=Math.floor((t-i)/8/s);pt[o]=new Array,pt[o]=n.split(",",2),ai(r)},this.parseHotspotsXML=function(e){var t=e.getElementsByTagName("HOTSPOTSETUP")[0],n=t.getAttribute("CHOICELIST");Kn=Z.Utils.isStrVal(n)?n:Z.Utils.getResource("DEFAULT_HOTSPOTLISTPOSITION");var r=t.getAttribute("LISTSOURCE"),i=Z.Utils.isStrVal(r)?r:Z.Utils.getResource("DEFAULT_HOTSPOTLISTSOURCE"),s=t.getAttribute("LISTTITLE"),o=Z.hotspotListTitle!==null?Z.hotspotListTitle:Z.Utils.isStrVal(s)?s:Z.Utils.getResource("DEFAULT_HOTSPOTLISTTITLE"),u=Z.Utils.getResource("DEFAULT_HOTSPOTSINITIALVISIBILITY"),a=t.getAttribute("INITIALVISIBILITY");u?Qn=a!="0"&&a!="hide":Qn=a!="1"&&a!="show";var f=parseFloat(t.getAttribute("MINSCALE")),l=parseFloat(t.getAttribute("MAXSCALE"));Gn=isNaN(f)?1:f,Yn=isNaN(l)?1:l;var c=[];Zn=[],Ln=[];var h=!1,p=-1,d=e.getElementsByTagName("HOTSPOT");for(var v=0,m=d.length;v<m;v++){var g=new Pi(d[v]);p++,g.internalID=p;if(Yi(g)){kn.push(g);if(d[v].getAttribute("MEDIATYPE")!="symbol"){var y=d[v].getAttribute("MEDIA");Z.Utils.isStrVal(y)&&c.push(y)}else d[v].getAttribute("MEDIA")!="polygon"&&(h=!0);var b=unescape(d[v].getAttribute("ID")),w=unescape(d[v].getAttribute("NAME")),E=unescape(d[v].getAttribute("CAPTION")),S=unescape(d[v].getAttribute("TOOLTIP"));switch(i){case"CAPTION":Zn.push({text:E,value:b});break;case"TOOLTIP":Zn.push({text:S,value:b});break;default:Zn.push({text:w,value:b})}}}Z.debug==2&&h&&Z.Utils.trace(Z.Utils.getResource("ERROR_HOTSPOTMEDIAINVALID")),D.visibility=Qn?"visible":"hidden",Ji(o,Zn),Ii(),c.sort(),c=Z.Utils.removeDups(c),Hi(c)},this.createHotspot=function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){var d="<HOTSPOT ID='"+e+"' NAME='"+t+"' MEDIATYPE='"+n+"' MEDIA='"+r+"' X='"+i.toString()+"' Y='"+s.toString()+"' ZOOM='"+o.toString()+"' XSCALE='"+u.toString()+"' YSCALE='"+a.toString()+"' URL='"+f+"' URLTARGET='"+l+"' ROLLOVER='"+c+"' CAPTION='"+h+"' TOOLTIP='"+p+"'></HOTSPOT>",v=Z.Utils.convertXMLTextToXMLDoc(d),m=v.getElementsByTagName("HOTSPOT"),g=new Pi(m[0]);g.internalID=Wi("hotspot");var y=Ln.indexOfObjectValueSubstring("src",g.media),r=Ln[y];if(y!=-1){var b=new Image;b.src=g.media;var w=b.width,E=b.height;b=null,g.image=r.cloneNode(!1),g.iW=w,g.iH=E;var S=new Xi;Ri(g,S)}else{var x=(new Date).getTime();Bi(g.media,x)}kn.push(g),Ki(g.name,g.internalID)},this.modifyHotspot=function(){},this.setHotspotsVisibility=function(e){D.visibility=e?"visible":"hidden"},this.setHotspotsVisibilityByFilter=function(e,t,n){if(kn.length>0)if(_&&_.childNodes.length>0){for(var r=0,i=kn.length;r<i;r++)if(kn[r][e]==t){var s=kn[r].id,o=document.getElementById("hot"+s);o!=null&&Qi(o,n)}}else var u=window.setTimeout(function(){setHotspotsVisibilityByFilter(e,t,n)},100)},this.setHotspotVisibilityByID=function(e,t){if(kn.length>0)if(_&&_.childNodes.length>0){var n=kn.indexOfObjectValue("id",e);if(n!=-1){var r=kn[n].id,i=document.getElementById("hot"+r);i!=null&&Qi(i,t)}}else var s=window.setTimeout(function(){setHotspotVisibilityByID(e,t)},100)},this.parseAnnotationsXML=function(e){er=es(e);var t,n=-1,r=er.getElementsByTagName("LABELSETUP")[0];tr=r.getAttribute("PANELPOSITION"),Qn=r.getAttribute("INITIALVISIBILITY")!="0",ir=r.getAttribute("NOTEVISIBILITY")!="0",Gn=parseFloat(r.getAttribute("MINSCALE")),Yn=parseFloat(r.getAttribute("MAXSCALE")),ar=[],cr=[],hr=[],fr=[],lr=[],Ln=[];var i=[],s=!1,o=er.getElementsByTagName("POI");for(var u=0,a=o.length;u<a;u++){var f=unescape(o[u].getAttribute("ID")),l=unescape(o[u].getAttribute("NAME")),c=unescape(o[u].getAttribute("X")),h=unescape(o[u].getAttribute("Y")),p=unescape(o[u].getAttribute("ZOOM"));ar.push({text:l,value:f,x:c,y:h,zoom:p});var d=o[u].getElementsByTagName("NOTES")[0];if(d){var v=d.getElementsByTagName("NOTE");for(var m=0,g=v.length;m<g;m++){var y=unescape(v[m].getAttribute("ID")),b=unescape(v[m].getAttribute("NAME")),w=unescape(v[m].getAttribute("TEXT"));cr.push({text:b,value:y,noteText:w,poiID:f})}}var E=o[u].getElementsByTagName("LABELS")[0];if(E){var S=E.getElementsByTagName("LABEL");for(var x=0,T=S.length;x<T;x++){var N=unescape(S[x].getAttribute("NAME"));n++,S[x].setAttribute("INTERNALID",n.toString()),fr.push({text:N,value:n,poiID:f});if(S[x].getAttribute("MEDIA")!="polygon"){if(S[x].getAttribute("MEDIATYPE")=="symbol"){var C=S[x].getAttribute("MEDIA"),k;switch(C){case"circle":k=Z.annotationPath+"/"+"circle.png";break;case"square":k=Z.annotationPath+"/"+"square.png";break;case"triangle":k=Z.annotationPath+"/"+"triangle.png";break;case"arrowDown":k=Z.annotationPath+"/"+"arrowDown.png";break;case"arrowDownLeft":k=Z.annotationPath+"/"+"arrowDownLeft.png";break;case"arrowLeft":k=Z.annotationPath+"/"+"arrowLeft.png";break;case"arrowUpLeft":k=Z.annotationPath+"/"+"arrowUpLeft.png";break;case"arrowUp":k=Z.annotationPath+"/"+"arrowUp.png";break;case"arrowUpRight":k=Z.annotationPath+"/"+"arrowUpRight.png";break;case"arrowRight":k=Z.annotationPath+"/"+"arrowRight.png";break;case"arrowRightDown":k=Z.annotationPath+"/"+"arrowRightDown.png";break;case"lineHorizontal":k=Z.annotationPath+"/"+"lineHorizontal.png";break;case"lineVertical":k=Z.annotationPath+"/"+"lineVertical.png";break;default:k=Z.annotationPath+"/"+"noSubstitutePlaceholder.png"}S[x].setAttribute("MEDIA",k),s=!0}i.push(S[x].getAttribute("MEDIA"))}var L=new Pi(S[x]);kn.push(L)}}}ts(),D.visibility=Qn?"visible":"hidden",rs(),i.sort(),i=Z.Utils.removeDups(i),Hi(i)},this.togglePolygonEditing=function(e){An!==null&&(Z.polygonEditing=e?e:!Z.polygonEditing,On=null,Dn=null,Pn=!1,_n=!0,Ss(!0));var t=document.getElementById("buttonEditMode");if(t)var n=t.style;var r=document.getElementById("buttonEditDelete");if(r)var i=r.style;var s=document.getElementById("buttonEditCancel");if(s)var o=s.style;var u=document.getElementById("buttonEditSave");if(u)var a=u.style;n&&o&&i&&a&&(Z.polygonEditing?(Z.Toolbar.buttonGraphicsReset(t,"hidden"),Z.Toolbar.buttonGraphicsReset(r,"visible"),Z.Toolbar.buttonGraphicsReset(s,"visible"),Z.Toolbar.buttonGraphicsReset(u,"visible")):(Z.Toolbar.buttonGraphicsReset(t,"visible"),Z.Toolbar.buttonGraphicsReset(r,"hidden"),Z.Toolbar.buttonGraphicsReset(s,"hidden"),Z.Toolbar.buttonGraphicsReset(u,"hidden"))),Z.mobileDevice&&Z.polygonEditing&&Z.progressVisible?Z.Toolbar.hideProgress():Z.progressVisible&&Z.Toolbar.showProgress(),Z.polygonEditing?(pr=Z.Utils.clone("hotspots",kn,pr),vr=Z.Utils.clone("labels",fr,vr)):(Z.Utils.removeEventListener(document,"mousemove",Us),e!=0&&(Z.Utils.showMessage(Z.Utils.getResource("ALERT_SAVINGUNSAVEDEDITS")),this.saveAnnotations()))},this.deleteCurrentLabel=function(){os(An);var e=kn.indexOfObjectValue("internalID",An);e!=-1&&(kn.splice(e,1),kn.length>0?An=parseInt(sr.options[sr.selectedIndex].value):An=null,On=null,Dn=null,Fi())},this.cancelLabelEdits=function(){Z.Utils.showMessage(Z.Utils.getResource("ALERT_CANCELLINGUNSAVEDEDITS")),kn=Z.Utils.clone("hotspots",pr,kn),fr=Z.Utils.clone("labels",vr,fr);var e=nr.options[nr.selectedIndex].value;lr=ys(fr,e),Z.Utils.updateSelectElement(sr,lr),An=parseInt(sr.options[sr.selectedIndex].value),Fi(),this.togglePolygonEditing(!1)},this.saveAnnotations=function(){er=Ls(er);if(Z.Utils.isStrVal(Z.saveHandlerPath))if(Z.saveHandlerPath.indexOf(Z.Utils.getResource("ALERT_SAVEDISABLEDFORDEMOKEY"))!=-1)Z.Utils.showMessage(Z.Utils.getResource("ALERT_SAVEDISABLEDFORDEMOTEXT"));else{var e=new Z.NetConnector;e.postXML(Z.saveHandlerPath,er)}else Z.Utils.showMessage(Z.Utils.getResource("ERROR_XMLSAVEHANDLERPATHINVALID"));this.togglePolygonEditing(!1)},this.setAllHotspotsSaved=function(){for(var e=0,t=kn.length;e<t;e++)kn[e].saved==1},this.setView=function(e,t,n){if(e==undefined||e==null)e=Z.imageW/2;if(t==undefined||t==null)t=Z.imageH/2;n==undefined||n==null?n=Z.fitZ:n>1&&(n/=100),As(e,t,n)},this.zoom=function(t){switch(t){case"out":en>=0&&(en-=Qt);break;case"in":en<=0&&(en+=Qt);break;case"stop":en=0}Z.zooming=en==0?"stop":en>0?"in":"out",en!=0?sn||((en<0&&Z.imageZ>Z.minZ||en>0&&Z.imageZ<Z.maxZ)&&e.toggleWatermarks(!1),Z.useCanvas||Xr(A),sn=window.setTimeout(Os,rn)):(Ds(),e.updateView(),e.toggleWatermarks(!0))},this.pan=function(t){switch(t){case"left":Yt<=0&&(Yt+=Gt);break;case"up":Zt<=0&&(Zt+=Gt);break;case"down":Zt>=0&&(Zt-=Gt);break;case"right":Yt>=0&&(Yt-=Gt);break;case"horizontalStop":Yt=0;break;case"verticalStop":Zt=0;break;case"stop":Yt=0,Zt=0}Z.panningX=Yt==0?"stop":Yt>0?"left":"right",Z.panningY=Zt==0?"stop":Zt>0?"up":"down",on=Z.imageX*ei(J,1),un=Z.imageY*ei(J,1),Yt!=0||Zt!=0?sn||(e.toggleWatermarks(!1),Z.useCanvas||Xr(A),sn=window.setTimeout(Os,rn)):(Ds(),e.updateView(),e.toggleWatermarks(!0))},this.zoomAndPanToView=function(t,n,r,i,s){e.zoomAndPanAllStop();if(typeof i=="undefined"||i===null)i=ln;if(typeof s=="undefined"||s===null)s=cn;e.toggleWatermarks(!1),Z.useCanvas||Xr(A),t==null&&(t=Z.initialX),n==null&&(n=Z.initialY),r==null?r=Z.initialZ:r>1&&r<2&&r%1!=0?r=1:r>1?r/=100:r>.99&&r<1&&r*100%1!=0&&(r=1);var o=xi(t,n,r);t=o.x,n=o.y,r=Ci(r),pn=0,_s(t,n,r,i,s)},this.zoomAndPanAllStop=function(t){Ds(),Ps(),t||e.updateView()},this.scaleTierToZoom=function(e){var t=Hs(e);t&&(Mi(),Fi(),$r())},this.reset=function(){e.zoomAndPanToView(Z.initialX,Z.initialY,Z.initialZ)},this.toggleFullPageViewExternal=function(){Sn=!0,e.toggleFullPageView()},this.toggleFullPageView=function(t){window.scrollTo(0,0);setTimeout(function(){jQuery("#slideshow-copyright").toggleClass("fullscreen_copyright"),jQuery("#zoomify-factsheet").length?jQuery("#zoomify-factsheet").attr("id","zoomify-factsheet-full"):jQuery("#zoomify-factsheet-full").length&&jQuery("#zoomify-factsheet-full").attr("id","zoomify-factsheet"),jQuery("#ViewerDisplay").length?jQuery("#ViewerDisplay").attr("id","ViewerDisplayFull"):jQuery("#ViewerDisplayFull").length&&jQuery("#ViewerDisplayFull").attr("id","ViewerDisplay"),jQuery("#ToolbarDisplay").length?jQuery("#ToolbarDisplay").attr("id","ToolbarDisplayFull"):jQuery("#ToolbarDisplayFull").length&&jQuery("#ToolbarDisplayFull").attr("id","ToolbarDisplay"),e.zoomAndPanAllStop(),Z.fullPage=t?t:!Z.fullPage;var n=document.body,r=n.style,i=document.documentElement.style,s=Z.ViewerDisplay.style,o=null,u=null;if(Z.fullPage){dn=r.width,vn=r.height,mn=r.overflow,gn=i.overflow,yn=s.backgroundColor,bn=s.position,wn=s.zIndex;var a;Z.mobileDevice?(a=Z.Utils.getWindowSize(),r.width=a.x,r.height=a.y):(r.width="100%",r.height="100%"),r.overflow="hidden",i.overflow="hidden",s.backgroundColor=Z.Utils.getResource("DEFAULT_FULLPAGEBACKCOLOR"),s.position="fixed",s.zIndex="99999999",a=Z.Utils.getWindowSize(),o=a.x,u=a.y}else{r.width=dn,r.height=vn,r.overflow=mn,i.overflow=gn,s.backgroundColor=yn,s.position="relative",s.zIndex=wn;var f=Z.Utils.getElementStyle(Z.pageContainer);o=parseFloat(f.width),u=parseFloat(f.height),isNaN(o)&&(o=Z.ViewerDisplay.clientWidth),isNaN(u)&&(u=Z.ViewerDisplay.clientHeight),Sn=!1}Z.viewerW=o,Z.viewerH=u,Cr(o,u),Bs(Sn);if(Z.ToolbarDisplay&&Z.Toolbar.getInitialized()){Z.toolbarCurrentW=Z.toolbarW==-1?o:Z.toolbarW;var l=Z.toolbarPosition==1?Z.viewerH-Z.toolbarH:0;Z.Toolbar.setSizeAndPosition(Z.toolbarCurrentW,null,null,l)}Z.NavigatorDisplay&&Z.Navigator.getInitialized()&&Z.Navigator.setSizeAndPosition(Z.navigatorW,Z.navigatorH,Z.navigatorL-1,Z.navigatorT-1),Pr(),Z.imageZ=Ci(Z.imageZ);var c=parseFloat(v.left),h=parseFloat(v.top),p=Ni(c,h);v.left=p.x+"px",v.top=p.y+"px",e.updateView(!0)}, 100);},this.toggleBackfill=function(){var e=Z.ViewerDisplay.firstChild.childNodes[0].style;e.display=e.display=="none"?"inline-block":"none"},this.toggleDisplay=function(){var e=Z.ViewerDisplay.firstChild.childNodes[1].style;e.display=e.display=="none"?"inline-block":"none"},this.toggleWatermarks=function(e){if(O){var t=e?e:O.display!="inline-block";O.display=t?"inline-block":"none"}},this.toggleConstrainPan=function(){Z.constrainPan=!Z.constrainPan;if(Z.constrainPan){var t=parseFloat(S.left),n=parseFloat(S.top),r=Ni(t,n);v.left=r.x+"px",v.top=r.y+"px",e.updateView()}},this.getClickZoomCoords3D=function(e,t,n,r){var i=parseFloat(Z.Utils.getResource("DEFAULT_CLICKZOOMTIERSKIPTHRESHOLD")),s=ni(t.x,t.y),o=ri(s.x,s.y),u=ei(n,r);return e.altKey?(r>1+i?u=ei(n,1):n>0&&(u=ei(n-1,1)),u-Z.fitZ<i&&(u=Z.fitZ)):r<1-i?u=ei(n,1):n<$-1&&(u=ei(n+1,1)),new Z.Utils.Point3D(o.x,o.y,u)},this.syncToNavigator=function(e,t){var n=-(e-Z.imageX),r=-(t-Z.imageY),i=n*Z.imageZ,s=r*Z.imageZ,o=i+Pt,u=s+Bt,a=Ni(o,u);v.left=a.x+"px",v.top=a.y+"px"},this.calculateCurrentCenterCoordinates=function(e){if(!e)var e=new Z.Utils.Point(parseFloat(v.left),parseFloat(v.top));var t=e.x-Pt,n=e.y-Bt,r=t/Z.imageZ,i=n/Z.imageZ,s=Z.imageX-r,o=Z.imageY-i;return new Z.Utils.Point(s,o)}},Z.ZoomifyToolbar=function(e){function b(e,t){Z.ToolbarDisplay=Z.Utils.createContainerElement("div","ToolbarDisplay","inline-block","absolute","hidden","1px","1px","0px","1px","none","0px","transparent none","0px","0px","normal","default"),s=Z.ToolbarDisplay.style;var n=new Z.Utils.Graphic("background",Z.skinPath,t[0],"1px","1px","0px","0px");Z.ToolbarDisplay.appendChild(n.elmt),toolbarSkinSizes=e;if(Z.logoVisible){var r;if(!Z.Utils.isStrVal(Z.logoCustomPath))r=new Z.Utils.Graphic("toolbarLogo",Z.skinPath,t[1],"1px","1px","1px","1px");else{var o=Z.Utils.cacheProofPath(Z.logoCustomPath);r=new Z.Utils.Graphic("toolbarLogo",o,null,"1px","1px","1px","1px")}Z.ToolbarDisplay.appendChild(r.elmt);if(Z.toolbarVisible==0||Z.toolbarVisible==1){var u=new Z.Utils.Graphic("logoDivider",Z.skinPath,t[2],"1px","1px","1px","1px");Z.ToolbarDisplay.appendChild(u.elmt)}}var a=Z.Utils.createContainerElement("div","buttonContainer","inline-block","absolute","visible","1px","1px","0px","0px","none","0px","transparent none","0px","0px","normal","default");Z.ToolbarDisplay.appendChild(a),Z.mobileDevice?Z.Utils.addEventListener(a,"touchstart",Z.Utils.preventDefault):(Z.Utils.addEventListener(a,"mousedown",Z.Utils.preventDefault),Z.Utils.addEventListener(a,"mouseover",P));var f=new Z.Utils.Graphic("buttonBackground",Z.skinPath,t[0],"1px","1px","0px","0px");a.appendChild(f.elmt);if(Z.toolbarVisible!=0&&Z.toolbarVisible!=1||Z.mobileDevice){var l=new Z.Utils.Button("buttonMinimize",null,Z.skinPath,t[3],t[4],t[5],"1px","1px","1px","1px","mouseover",H,"TIP_MINIMIZE");Z.ToolbarDisplay.appendChild(l.elmt);var c=new Z.Utils.Button("buttonExpand",null,Z.skinPath,t[6],t[7],t[8],"1px","1px","1px","1px","mouseover",H,"TIP_EXPAND");Z.ToolbarDisplay.appendChild(c.elmt)}var h=new Z.Utils.Button("buttonZoomOut",null,Z.skinPath,t[9],t[10],t[11],"1px","1px","1px","1px","mouseover",H,"TIP_ZOOMOUT");a.appendChild(h.elmt);if(Z.sliderVisible){var p=new Z.Utils.Graphic("trackSlider",Z.skinPath,t[12],"1px","1px","0px","0px");a.appendChild(p.elmt),Z.Utils.addEventListener(p.elmt,"mousedown",H),Z.Utils.addEventListener(p.elmt,"touchstart",H);var d=new Z.Utils.Button("buttonSlider",null,Z.skinPath,t[14],t[15],t[16],"1px","1px","1px","1px","mouseover",H,"TIP_SLIDER");a.appendChild(d.elmt)}var v=new Z.Utils.Button("buttonZoomIn",null,Z.skinPath,t[17],t[18],t[19],"1px","1px","1px","1px","mouseover",H,"TIP_ZOOMIN");a.appendChild(v.elmt);var m=new Z.Utils.Graphic("panDivider",Z.skinPath,t[20],"1px","1px","1px","1px");a.appendChild(m.elmt);var g=new Z.Utils.Button("buttonPanLeft",null,Z.skinPath,t[21],t[22],t[23],"1px","1px","1px","1px","mouseover",H,"TIP_PANLEFT");a.appendChild(g.elmt);var y=new Z.Utils.Button("buttonPanUp",null,Z.skinPath,t[24],t[25],t[26],"1px","1px","1px","1px","mouseover",H,"TIP_PANUP");a.appendChild(y.elmt);var b=new Z.Utils.Button("buttonPanDown",null,Z.skinPath,t[27],t[28],t[29],"1px","1px","1px","1px","mouseover",H,"TIP_PANDOWN");a.appendChild(b.elmt);var w=new Z.Utils.Button("buttonPanRight",null,Z.skinPath,t[30],t[31],t[32],"1px","1px","1px","1px","mouseover",H,"TIP_PANRIGHT");a.appendChild(w.elmt);var E=new Z.Utils.Button("buttonReset",null,Z.skinPath,t[33],t[34],t[35],"1px","1px","1px","1px","mouseover",H,"TIP_RESET");a.appendChild(E.elmt);if(Z.fullPageVisible){var T=new Z.Utils.Graphic("fullPageDivider",Z.skinPath,t[36],"1px","1px","1px","1px");a.appendChild(T.elmt);var C=new Z.Utils.Button("buttonFullPage",null,Z.skinPath,t[37],t[38],t[39],"1px","1px","1px","1px","mouseover",H,"TIP_TOGGLEFULLPAGE");a.appendChild(C.elmt)}if(Z.editMode&&Z.useCanvas){var k=new Z.Utils.Button("buttonEditMode",null,Z.skinPath,t[40],t[41],t[42],"1px","1px","1px","1px","mouseover",H,"TIP_TOGGLEEDITMODE");a.appendChild(k.elmt);var A=new Z.Utils.Button("buttonEditCancel",null,Z.skinPath,t[43],t[44],t[45],"1px","1px","1px","1px","mouseover",H,"TIP_EDITCANCEL");a.appendChild(A.elmt);var O=new Z.Utils.Button("buttonEditDelete",null,Z.skinPath,t[46],t[47],t[48],"1px","1px","1px","1px","mouseover",H,"TIP_EDITDELETE");a.appendChild(O.elmt);var M=new Z.Utils.Button("buttonEditSave",null,Z.skinPath,t[49],t[50],t[51],"1px","1px","1px","1px","mouseover",H,"TIP_EDITSAVE");a.appendChild(M.elmt)}if(Z.progressVisible){var _=Z.Utils.createContainerElement("div","progressTextBox","inline-block","absolute","hidden","1px","1px","1px","1px","none","0px","transparent none","0px","0px","normal"),D=toolbarSkinSizes[16];a.appendChild(_);var B=document.createTextNode(Z.Utils.getResource("DEFAULT_PROGRESSTEXT"));_.appendChild(Z.Utils.createCenteredElement(B)),Z.Utils.setTextStyle(B,"black","verdana",D+"px","none","normal","normal","normal","normal","1em","left","none"),Z.Utils.addEventListener(_,"contextmenu",Z.Utils.preventDefault),Z.Utils.disableTextInteraction(B)}Z.ViewerDisplay.appendChild(Z.ToolbarDisplay),Z.toolbarW=toolbarSkinSizes[0],Z.toolbarCurrentW=Z.toolbarW==-1?Z.viewerW:Z.toolbarW,Z.toolbarH=i=toolbarSkinSizes[1];var j=Z.toolbarPosition==1?Z.viewerH-i:0;x(Z.toolbarCurrentW,Z.toolbarH,0,j);if(Z.Viewport&&Z.Viewport.getInitialized()){var F=Z.Viewport.getZoom();L(F)}N(Z.toolbarVisible==1||Z.toolbarVisible==2||Z.toolbarVisible==4),Z.Utils.addEventListener(Z.ToolbarDisplay,"mouseover",Z.Utils.stopPropagation),S(!0)}function w(){window.clearInterval(v),v=null;var e=document.getElementById("progressTextBox").firstChild.firstChild.firstChild.firstChild;e&&(e.nodeValue="")}function E(){return n}function S(e){n=e}function x(e,t,n,r){typeof e=="undefined"||e===null?e=Z.toolbarVisible>0?Z.toolbarCurrentW:0:Z.toolbarCurrentW=e;if(typeof t=="undefined"||t===null)t=Z.toolbarVisible>0?i:0;if(typeof n=="undefined"||n===null)n=0;if(typeof r=="undefined"||r===null)r=Z.toolbarPosition==1?Z.viewerH-i:0;var s=Z.ToolbarDisplay.style;s.width=e+"px",s.height=t+"px",s.left=n+"px",s.top=r+"px",T(e,t)}function T(e,t){var n=e,r=t,i=toolbarSkinSizes[2],s=toolbarSkinSizes[3],o=toolbarSkinSizes[4],u=toolbarSkinSizes[5],a=toolbarSkinSizes[6],f=toolbarSkinSizes[7],l=toolbarSkinSizes[8],c=toolbarSkinSizes[9],h=toolbarSkinSizes[10],p=toolbarSkinSizes[11],d=toolbarSkinSizes[12],v=toolbarSkinSizes[13],b=toolbarSkinSizes[14],w=toolbarSkinSizes[15],E=0,S=(r-s)/2+1,x=(r-u)/2,T=(r-f)/2,N=T*1.3,C=T+4,k=T+2,L=Z.logoVisible==1?0:l/2,A=Z.logoVisible==1?0:l/2,O=l-(a-o),M=Z.fullPageVisible?8:7,_=20,D=M*l+2*O;Z.sliderVisible&&(D+=v),m=g=y=!1;var P=Z.logoVisible==1?i+2:0,H=Z.toolbarVisible!=0&&Z.toolbarVisible!=1?l:0,B=P+H,j=B+_+D+_+b;j>n&&(m=!0,j-v>n&&(g=!0,j-v-b>n&&(y=!0,B=0),b=0),D-=v);var F=B+(n-b-B-D)/2,I=document.getElementById("background");I.style.width=n+"px",I.firstChild.style.width=n+"px",I.style.height=r+"px",I.firstChild.style.height=r+"px";var q=document.getElementById("buttonContainer");q.style.width=D+_*2+"px",q.style.height=r+"px",q.style.left=F-_+"px";var R=document.getElementById("buttonBackground");R.style.width=n+"px",Z.Utils.graphicSize(R,parseFloat(q.style.width),parseFloat(q.style.height)),R.style.left="0px";var U=document.getElementById("toolbarLogo");if(U){var z=U.style;if(z)if(!y){z.display="inline-block",Z.Utils.graphicSize(U,i,s),z.left=E+"px",z.top=S+"px",E+=i+2;var W=document.getElementById("logoDivider");if(W){Z.Utils.graphicSize(W,o,u);var X=W.style;X.left=E+"px",X.top=x+"px"}}else z.display="none"}if(Z.toolbarVisible!=0&&Z.toolbarVisible!=1){var V=document.getElementById("buttonMinimize"),$=document.getElementById("buttonExpand");if(V&&$){var J=V.style,K=$.style;J&&K&&(y?(J.display="none",K.display="none"):(J.display="inline-block",K.display="inline-block",Z.Utils.buttonSize(V,a,f),Z.Utils.buttonSize($,a,f),J.left=E+L+"px",J.top=N+"px",K.left=E+A+"px",K.top=N+"px"))}}E=_;var Q=document.getElementById("buttonZoomOut");Z.Utils.buttonSize(Q,a,f);var G=Q.style;G.left=E+"px",G.top=T+"px",E+=l;var Y=document.getElementById("trackSlider"),et=document.getElementById("buttonSlider");if(Y&&et){var tt=Y.style,nt=et.style;tt&&nt&&(m?(tt.display="none",nt.display="none"):(tt.display="inline-block",nt.display="inline-block",Z.Utils.graphicSize(Y,p,d),tt.left=E-2+"px",tt.top=C+"px",Z.Utils.buttonSize(et,c,h),nt.left=parseFloat(tt.left)+"px",nt.top=k+"px",E+=v))}var rt=document.getElementById("buttonZoomIn");Z.Utils.buttonSize(rt,a,f);var it=rt.style;it.left=E+"px",it.top=T+"px",E+=l+1;var st=document.getElementById("panDivider");Z.Utils.graphicSize(st,o,u);var ot=st.style;ot.left=E+"px",ot.top=x+"px",E+=O;var ut=document.getElementById("buttonPanLeft");Z.Utils.buttonSize(ut,a,f);var at=ut.style;at.left=E+"px",at.top=T+"px",E+=l;var ft=document.getElementById("buttonPanUp");Z.Utils.buttonSize(ft,a,f);var lt=ft.style;lt.left=E+"px",lt.top=T+"px",E+=l;var ct=document.getElementById("buttonPanDown");Z.Utils.buttonSize(ct,a,f);var ht=ct.style;ht.left=E+"px",ht.top=T+"px",E+=l;var pt=document.getElementById("buttonPanRight");Z.Utils.buttonSize(pt,a,f);var dt=pt.style;dt.left=E+"px",dt.top=T+"px",E+=l;var vt=document.getElementById("buttonReset");Z.Utils.buttonSize(vt,a,f);var mt=vt.style;mt.left=E+"px",mt.top=T+"px",E+=l+1;var gt=document.getElementById("fullPageDivider");if(gt){Z.Utils.graphicSize(gt,o,u);var yt=gt.style;yt.left=E+"px",yt.top=x+"px",E+=O;var bt=document.getElementById("buttonFullPage");Z.Utils.buttonSize(bt,a,f);var wt=bt.style;wt.left=E+"px",wt.top=T+"px"}var Et=document.getElementById("buttonEditMode");if(Et){E+=l+10,Z.Utils.buttonSize(Et,a,f);var St=Et.style;St.left=E+"px",St.top=T+"px"}var xt=document.getElementById("buttonEditCancel");if(xt){Z.Utils.buttonSize(xt,a,f);var Tt=xt.style;Tt.left=E+"px",Tt.top=T+"px",Tt.visibility="hidden"}var Nt=document.getElementById("buttonEditDelete");if(Nt){E+=l+1,Z.Utils.buttonSize(Nt,a,f);var Ct=Nt.style;Ct.left=E+"px",Ct.top=T+"px",Ct.visibility="hidden"}var kt=document.getElementById("buttonEditSave");if(kt){E+=l+1,Z.Utils.buttonSize(kt,a,f);var Lt=kt.style;Lt.left=E+"px",Lt.top=T+"px",Lt.visibility="hidden"}var At=document.getElementById("progressTextBox");if(At){var Ot=At.style;Ot&&(g?Ot.display="none":(Ot.display="inline-block",Ot.width=b+"px",Ot.height=w+"px",Ot.left=n-parseFloat(q.style.left)-parseFloat(Ot.width)+"px",Ot.top=(r-parseFloat(Ot.height))/2+"px"))}}function N(e){Z.toolbarVisible<4&&!Z.mobileDevice?C(e):k(!e)}function C(e){s&&(e?s.display="inline-block":s.display="none")}function k(e){if(s){var t=document.getElementById("buttonContainer"),n=document.getElementById("background"),r=document.getElementById("buttonMinimize"),i=document.getElementById("buttonExpand"),o=document.getElementById("logoDivider"),u=0;y||(u=parseFloat(i.style.left)+parseFloat(i.style.width)+4);var a=Z.toolbarCurrentW;e?(t.style.display="none",y||(o&&(o.style.display="none"),r.style.display="none",i.style.display="inline-block"),s.width=u+"px",n.style.width=u+"px"):(t.style.display="inline-block",y||(o&&(o.style.display="inline-block"),r.style.display="inline-block",i.style.display="none"),s.width=a+"px",n.style.width=a+"px")}}function L(e){if(Z.sliderVisible){o||(o=document.getElementById("trackSlider")),u||(u=o.style),a||(a=document.getElementById("buttonSlider")),f||(f=a.style);if(u&&f){var t=Z.maxZ-Z.minZ,n=(e-Z.minZ)/t;trackL=parseFloat(u.left),trackR=parseFloat(u.left)+parseFloat(u.width)-parseFloat(f.width);var r=trackR-trackL,i=n*r+trackL;f.left=i+"px"}}}function A(t){o||(o=document.getElementById("trackSlider")),u||(u=o.style);if(o&&u){var n,r=Z.Utils.getElementPosition(o);Z.mobileDevice?n=Z.Utils.getMousePosition(t).x-r.x:n=t.clientX-r.x;var i=D(n,0,parseFloat(u.width));i<Z.minZ+.1&&(i=Z.minZ),i>Z.maxZ-.1&&(i=Z.maxZ),e.scaleTierToZoom(i),e.updateView()}}function O(e){h=!0,a||(a=document.getElementById("buttonSlider"));if(a){var t=Z.Utils.getMousePosition(e);a.mouseXPrior=t.x,a.mouseYPrior=t.y}}function M(t){o||(o=document.getElementById("trackSlider")),u||(u=o.style),a||(a=document.getElementById("buttonSlider")),f||(f=a.style);if(u&&a&&f){trackL=parseFloat(u.left),trackR=parseFloat(u.left)+parseFloat(u.width)-parseFloat(f.width);var n=parseFloat(f.left)+(d.x-a.mouseXPrior);n<trackL?n=trackL:n>trackR?n=trackR:a.mouseXPrior=d.x,f.left=n+"px";var r=D(n,trackL,trackR);e.scaleTierToZoom(r)}}function _(){h=!1,e.updateView()}function D(e,t,n){var r=n-t,i=(e-t)/r,s=Z.maxZ-Z.minZ,o=Z.minZ+s*i;return o}function P(e){var e=Z.Utils.event(e),t=Z.Utils.relatedTarget(e);if(!h&&t){var n=t.parentNode;B(n)}}function H(e){Z.mobileDevice&&e.preventDefault();var e=Z.Utils.event(e),t=Z.Utils.target(e),n=Z.Utils.relatedTarget(e);if(t){var r=t.parentNode;r&&(targetParentID=r.id)}if(n){var i=n.parentNode;i&&(relatedTargetParentID=i.id)}if(!h||e.type=="mouseup"||e.type=="touchend"||e.type=="touchcancel")I(),t&&!Z.Utils.isRightMouseButton(e)&&(targetParentID&&targetParentID!="trackSlider"&&e.type!="mousemove"&&(q(e),R(e)),U(e))}function B(t){e&&e.zoomAndPanAllStop(true),t&&Z.Utils.isStrVal(t.id)&&(t.id.indexOf("button")!=-1?(j(t),F(t,null)):t.id.indexOf("background")!=-1&&I())}function j(e){Z.Utils.removeEventListener(e,"mousedown",H),Z.Utils.removeEventListener(e,"mouseup",H),Z.Utils.removeEventListener(e,"mouseout",H),Z.Utils.addEventListener(e,"mouseover",H)}function F(e,t){var n=document.getElementById(e._imgUpID),r=document.getElementById(e._imgOverID),i=document.getElementById(e._imgDownID);n&&(n.style.visibility=t!==null?t:"visible"),r&&(r.style.visibility="hidden"),i&&(i.style.visibility="hidden")}function I(){var e=Z.ToolbarDisplay.childNodes,t=null;for(var n=0,r=e.length;n<r;n++){t=e[n];if(t.id&&t.id.indexOf("button")!=-1)if(t.id!="buttonContainer")j(t),F(t,null);else{var i=t.childNodes,s=null;for(var o=0,u=i.length;o<u;o++)s=i[o],s.id&&s.id.indexOf("button")!=-1&&(!Z.editMode||s.id!="buttonEditMode"&&s.id!="buttonEditCancel"&&s.id!="buttonEditDelete"&&s.id!="buttonEditSave")&&(j(s),F(s,null))}}}function q(e){var t=Z.Utils.target(e);if(t){var n=t.parentNode;n&&(Z.mobileDevice?(Z.Utils.removeEventListener(n,"touchstart",H),Z.Utils.removeEventListener(n,"touchend",H),Z.Utils.removeEventListener(n,"touchcancel",H)):(Z.Utils.removeEventListener(n,"mouseover",H),Z.Utils.removeEventListener(n,"mousedown",H),Z.Utils.removeEventListener(n,"mouseup",H),Z.Utils.removeEventListener(n,"mouseout",H)))}}function R(e){var t=Z.Utils.target(e);if(t){var n=Z.Utils.target(e).parentNode;if(n)if(!n._imgUpID)B(n);else{var r=document.getElementById(n._imgUpID),i=document.getElementById(n._imgOverID),s=document.getElementById(n._imgDownID);if(r&&i&&s){var o=r.style,u=i.style,a=s.style;o.visibility="hidden",u.visibility="hidden",a.visibility="hidden";switch(e.type){case"mouseover":u.visibility="visible";break;case"mousedown":a.visibility="visible";break;case"mousemove":a.visibility="visible";break;case"mouseup":u.visibility="visible";break;case"mouseout":o.visibility="visible";break;case"touchstart":a.visibility="visible";break;case"touchend":o.visibility="visible";break;case"touchcancel":o.visibility="visible"}}}}}function U(n){var r=Z.Utils.target(n).parentNode;if(r){var i=r.id;switch(n.type){case"mouseover":Z.Utils.addEventListener(r,"mousedown",H);break;case"mousedown":Z.Utils.addEventListener(r,"mouseup",H);if(e)switch(i){case"buttonMinimize":t.minimize(!0),Z.Navigator.setVisibility(!1);break;case"buttonExpand":t.minimize(!1),Z.Navigator.setVisibility(!0);break;case"buttonZoomOut":e.zoom("out");break;case"buttonSlider":O(n),z(n),Z.Utils.addEventListener(document,"mousemove",z),p||(p=window.setInterval(M,c)),Z.Utils.addEventListener(document,"mouseup",H);break;case"trackSlider":A(n);break;case"buttonZoomIn":e.zoom("in");break;case"buttonPanLeft":e.pan("left");break;case"buttonPanUp":e.pan("up");break;case"buttonPanDown":e.pan("down");break;case"buttonPanRight":e.pan("right");break;case"buttonReset":e.reset()}break;case"mouseup":Z.Utils.addEventListener(r,"mousedown",H),e&&(i=="buttonSlider"||h?(p&&(window.clearInterval(p),p=null),_(),Z.Utils.removeEventListener(document,"mousemove",z),Z.Utils.removeEventListener(document,"mouseup",H),I()):i=="buttonZoomOut"||i=="buttonZoomIn"?e.zoom("stop"):i=="buttonPanLeft"||i=="buttonPanRight"?e.pan("horizontalStop"):i=="buttonPanUp"||i=="buttonPanDown"?e.pan("verticalStop"):i=="buttonFullPage"?e.toggleFullPageView():i=="buttonEditMode"?e.togglePolygonEditing():i=="buttonEditDelete"?e.deleteCurrentLabel():i=="buttonEditCancel"?e.cancelLabelEdits():i=="buttonEditSave"&&e.saveAnnotations());break;case"mouseout":Z.Utils.addEventListener(r,"mouseover",H),e&&(i=="buttonZoomOut"||i=="buttonZoomIn"?e.zoom("stop"):i=="buttonPanLeft"||i=="buttonPanRight"?e.pan("horizontalStop"):(i=="buttonPanUp"||i=="buttonPanDown")&&e.pan("verticalStop"));break;case"touchstart":Z.Utils.addEventListener(r,"touchend",H),Z.Utils.addEventListener(r,"touchcancel",H);if(e)switch(i){case"buttonMinimize":t.minimize(!0),Z.Navigator.setVisibility(!1);break;case"buttonExpand":t.minimize(!1),Z.Navigator.setVisibility(!0);break;case"buttonZoomOut":e.zoom("out");break;case"buttonSlider":O(n),W(n),Z.Utils.addEventListener(document,"touchmove",W),p||(p=window.setInterval(M,c)),Z.Utils.addEventListener(r,"touchend",H),Z.Utils.addEventListener(r,"touchcancel",H);break;case"trackSlider":A(n);break;case"buttonZoomIn":e.zoom("in");break;case"buttonPanLeft":e.pan("left");break;case"buttonPanUp":e.pan("up");break;case"buttonPanDown":e.pan("down");break;case"buttonPanRight":e.pan("right");break;case"buttonReset":e.reset()}break;case"touchend":Z.Utils.addEventListener(r,"touchstart",H),e&&(i=="buttonZoomOut"||i=="buttonZoomIn"?(e.zoom("stop"),Z.debug==0&&i=="buttonZoomOut"&&n.altKey&&Z.Utils.showGlobals()):i=="buttonSlider"?(p&&(window.clearInterval(p),p=null),_(),Z.Utils.removeEventListener(document,"touchmove",W)):i=="buttonPanLeft"||i=="buttonPanRight"?e.pan("horizontalStop"):i=="buttonPanUp"||i=="buttonPanDown"?e.pan("verticalStop"):i=="buttonFullPage"?e.toggleFullPageView():i=="buttonEditMode"?e.togglePolygonEditing():i=="buttonEditDelete"?e.deleteCurrentLabel():i=="buttonEditCancel"?e.cancelLabelEdits():i=="buttonEditSave"&&e.saveAnnotations());break;case"touchcancel":Z.Utils.addEventListener(r,"touchstart",H),e&&(i=="buttonZoomOut"||i=="buttonZoomIn"?(e.zoom("stop"),Z.debug==0&&i=="buttonZoomOut"&&n.altKey&&Z.Utils.showGlobals()):i=="buttonSlider"?(p&&(window.clearInterval(p),p=null),_(),Z.Utils.removeEventListener(document,"touchmove",W)):i=="buttonPanLeft"||i=="buttonPanRight"?e.pan("horizontalStop"):i=="buttonPanUp"||i=="buttonPanDown"?e.pan("verticalStop"):i=="buttonFullPage"?e.toggleFullPageView():i=="buttonEditMode"?e.togglePolygonEditing():i=="buttonEditDelete"?e.deleteCurrentLabel():i=="buttonEditCancel"?e.cancelLabelEdits():i=="buttonEditSave"&&e.saveAnnotations())}}}function z(e){d=new Z.Utils.Point(e.clientX,e.clientY)}function W(e){var t=Z.Utils.getFirstTouch(e);if(t){var n=t.target;d=new Z.Utils.Point(t.pageX,t.pageY)}}var t=this,n=!1;Z.skinPath=Z.Utils.removeTrailingSlashCharacters(Z.skinPath);var r=new Z.NetConnector;r.loadXML(Z.skinPath+"/"+Z.Utils.getResource("DEFAULT_SKINXMLFILE"));var i,s,o,u,a,f,l=[],c=parseInt(Z.Utils.getResource("DEFAULT_SLIDERTESTDURATION"),10),h=!1,p=null,d=null,v=null,m,g,y;this.getInitialized=function(){return E()},this.setSizeAndPosition=function(e,t,n,r){x(e,t,n,r)},this.show=function(e){N(e)},this.setVisibility=function(e){C(e)},this.minimize=function(e){k(e)},this.showProgress=function(){var e=document.getElementById("progressTextBox");if(e){var t=e.style;t&&(t.display="inline-block")}},this.hideProgress=function(){var e=document.getElementById("progressTextBox");if(e){var t=e.style;t&&(t.display="none")}},this.updateProgress=function(e,t){if(Z.progressVisible){v&&window.clearInterval(v);var n,r=document.getElementById("progressTextBox").firstChild.firstChild.firstChild.firstChild;r&&(e==0||t==0?(r.nodeValue="llllllllll",v=window.setInterval(w,parseInt(Z.Utils.getResource("DEFAULT_PROGRESSDURATION")),10)):(n=Math.round(100-t/e*100),r.nodeValue="l".multiply(Math.round(n/10))))}},this.parseSkinXML=function(e){Z.skinMode=e.getElementsByTagName("SETUP")[0].attributes.getNamedItem("SKINMODE").nodeValue;var t,n;Z.skinMode==1||Z.skinMode==0&&!Z.mobileDevice?(t=e.getElementsByTagName("SETUP")[0].attributes.getNamedItem("FOLDERSTANDARD").nodeValue,n="SIZESSTANDARD"):(t=e.getElementsByTagName("SETUP")[0].attributes.getNamedItem("FOLDERLARGE").nodeValue,n="SIZESLARGE");var r=[];r.push(parseFloat(e.getElementsByTagName(n)[0].attributes.getNamedItem("TOOLBARW").nodeValue)),r.push(parseFloat(e.getElementsByTagName(n)[0].attributes.getNamedItem("TOOLBARH").nodeValue)),r.push(parseFloat(e.getElementsByTagName(n)[0].attributes.getNamedItem("LOGOW").nodeValue)),r.push(parseFloat(e.getElementsByTagName(n)[0].attributes.getNamedItem("LOGOH").nodeValue)),r.push(parseFloat(e.getElementsByTagName(n)[0].attributes.getNamedItem("DIVIDERW").nodeValue)),r.push(parseFloat(e.getElementsByTagName(n)[0].attributes.getNamedItem("DIVIDERH").nodeValue)),r.push(parseFloat(e.getElementsByTagName(n)[0].attributes.getNamedItem("BUTTONW").nodeValue)),r.push(parseFloat(e.getElementsByTagName(n)[0].attributes.getNamedItem("BUTTONH").nodeValue)),r.push(parseFloat(e.getElementsByTagName(n)[0].attributes.getNamedItem("BUTTONSPAN").nodeValue)),r.push(parseFloat(e.getElementsByTagName(n)[0].attributes.getNamedItem("SLIDERBUTTONW").nodeValue)),r.push(parseFloat(e.getElementsByTagName(n)[0].attributes.getNamedItem("SLIDERBUTTONH").nodeValue)),r.push(parseFloat(e.getElementsByTagName(n)[0].attributes.getNamedItem("SLIDERTRACKW").nodeValue)),r.push(parseFloat(e.getElementsByTagName(n)[0].attributes.getNamedItem("SLIDERTRACKH").nodeValue)),r.push(parseFloat(e.getElementsByTagName(n)[0].attributes.getNamedItem("SLIDERSPAN").nodeValue)),r.push(parseFloat(e.getElementsByTagName(n)[0].attributes.getNamedItem("PROGRESSW").nodeValue)),r.push(parseFloat(e.getElementsByTagName(n)[0].attributes.getNamedItem("PROGRESSH").nodeValue)),r.push(parseFloat(e.getElementsByTagName(n)[0].attributes.getNamedItem("PROGRESSFONTSIZE").nodeValue));var i=[],s,o,u,a,f;s=Z.editMode?51:39,o=e.getElementsByTagName("FILES")[0].attributes.getNamedItem("SKIN0"),o!==null&&(u=o.nodeValue),a=e.getElementsByTagName("FILES")[0].attributes.getNamedItem("SKIN"+s.toString()),a!==null&&(f=a.nodeValue);if(typeof u!="undefined"&&Z.Utils.isStrVal(u)&&typeof f!="undefined"&&Z.Utils.isStrVal(f)){var l=!1;for(var c=0;c<s+1;c++){var h=e.getElementsByTagName("FILES")[0].attributes.getNamedItem("SKIN"+c).nodeValue;Z.Utils.isStrVal(h)?i[c]=t+"/"+h:(i[c]="null",l=!0)}l&&Z.Utils.showMessage(Z.Utils.getResource("ERROR_SKINXMLMISSINGNAMES")),b(r,i)}else Z.Utils.showMessage(Z.Utils.getResource("ERROR_SKINXMLINVALID"))},this.syncSliderToViewport=function(e){L(e)},this.buttonGraphicsReset=function(e,t){F(e,t)}},Z.ZoomifyNavigator=function(e){function x(e){Z.NavigatorDisplay=Z.Utils.createContainerElement("div","NavigatorDisplay","inline-block","absolute","hidden",d+"px",v+"px",m+"px",g+"px","solid","1px","transparent none","0px","0px","normal"),i=Z.NavigatorDisplay,s=i.style;var t=Z.Utils.getResource("DEFAULT_NAVIGATORBACKCOLOR"),n=Z.Utils.getResource("DEFAULT_NAVIGATORBACKCOLORNOALPHA"),r=Z.Utils.createContainerElement("div","navigatorBackground","inline-block","absolute","hidden",d+"px",v+"px","0px","0px","none","0px",t,"0px","0px","normal");Z.Utils.setOpacity(r,E,n),Z.NavigatorDisplay.appendChild(r),o=r,u=o.style;var b=Z.Utils.createContainerElement("div","navigatorImageContainer","inline-block","absolute","hidden",d+"px",v+"px","0px","0px","none","0px","transparent none","0px","0px","normal");b.appendChild(p),Z.NavigatorDisplay.appendChild(b),a=b,f=a.style,l=p;var w=Z.Utils.createContainerElement("div","navigatorRectangle","inline-block","absolute","hidden",d+1+"px",v+1+"px",m+"px",g+"px","solid","1px","transparent none","0px","0px","normal");w.style.borderColor=Z.Utils.getResource("DEFAULT_NAVIGATORRECTANGLECOLOR"),Z.NavigatorDisplay.appendChild(w),c=w,h=c.style,Z.ViewerDisplay.appendChild(Z.NavigatorDisplay),A(d,v,m,g,y),P(Z.navigatorVisible==1||Z.navigatorVisible==2),_(),Z.mobileDevice?(Z.Utils.addEventListener(i,"touchstart",U),Z.Utils.addEventListener(i,"touchmove",z),Z.Utils.addEventListener(i,"touchend",W),Z.Utils.addEventListener(i,"touchcancel",X)):(Z.Utils.addEventListener(l,"mousedown",Z.Utils.preventDefault),Z.Utils.addEventListener(i,"mousedown",Z.Utils.preventDefault),Z.Utils.addEventListener(i,"mouseover",Z.Utils.stopPropagation),Z.Utils.addEventListener(i,"mousedown",I)),Z.Utils.addEventListener(p,"contextmenu",Z.Utils.preventDefault),Z.Utils.addEventListener(r,"contextmenu",Z.Utils.preventDefault),Z.Utils.addEventListener(w,"contextmenu",Z.Utils.preventDefault),L(!0),D()}function T(e){Z.tileSource=="ZoomifyImageFolder"?S=Z.Utils.cacheProofPath(Z.imagePath+"/TileGroup0/"+"0-0-0.jpg"):Z.tileSource=="ZoomifyImageFile"&&(S=Z.Viewport.formatTilePath(0,0,0)),p=null,p=new Image,p.onload=e,p.onerror=F;if(S!="offsetLoading")p.src=S;else var t=window.setTimeout(function(){T(e)},100)}function N(e){a.appendChild(p),l=Z.NavigatorDisplay.childNodes[1].firstChild,A(d,v,m,g,y),P(Z.navigatorVisible==1||Z.navigatorVisible==2),_(),D()}function C(){if(k()){r&&(window.clearInterval(r),r=null);if(!i||!s||!o||!u||!a||!f||!l||!c||!h)i=Z.NavigatorDisplay,s=i.style,o=Z.NavigatorDisplay.childNodes[0],u=o.style,a=Z.NavigatorDisplay.childNodes[1],f=a.style,l=Z.NavigatorDisplay.childNodes[1].firstChild,c=Z.NavigatorDisplay.childNodes[2],h=c.style}}function k(){return n}function L(e){n=e}function A(e,t,n,r,o){e||(e=Z.navigatorW),t||(t=Z.navigatorH);if(typeof n=="undefined"||n===null)n=0;if(typeof r=="undefined"||r===null)r=0;i||(i=Z.NavigatorDisplay),s||(s=i.style),l=i.childNodes[1].firstChild;if(i&&s&&l){if(o){var u=1,a=1;o==0?a=Z.viewerW/Z.viewerH:a=l.width/l.height,u>1?(t=e,t/=a):(e=t,e*=a)}s.width=e+"px",s.height=t+"px",s.left=n-1+"px",s.top=r-1+"px",O(e,t)}}function O(e,t){u||(u=Z.NavigatorDisplay.firstChild.style),f||(f=Z.NavigatorDisplay.childNodes[1].style),l||(l=Z.NavigatorDisplay.childNodes[1].firstChild),u&&f&&l&&(u.width=e+"px",u.height=t+"px",M(e,t,l.width,l.height),f.width=l.width+"px",f.height=l.height+"px",f.left=(e-parseFloat(f.width))/2+"px",f.top=(t-parseFloat(f.height))/2+"px",D())}function M(e,t,n,r){l||(l=Z.NavigatorDisplay.childNodes[1].firstChild);if(l){var i=n/r,s=e/n,o=t/r,u=0,a=0;s<=o?(n=e,r=e/i,a=(t-r*(e/n))/2):o<s&&(r=t,n=t*i,u=(e-n*(t/r))/2),l.width=n,l.height=r}}function _(){s||(s=Z.NavigatorDisplay.style),s&&(s.zIndex=s.zIndex+100)}function D(){if(Z.Viewport&&Z.Viewport.getInitialized()){H();var e=Z.Viewport.calculateCurrentCenterCoordinates();B(e)}}function P(e){s||(s=Z.NavigatorDisplay.style),s&&(e?s.display="inline-block":s.display="none")}function H(){if(l&&h){var e=l.width/Z.imageW,t=l.height/Z.imageH,n=Z.Viewport.getZoom(),r=Z.viewerW*e/n,i=Z.viewerH*t/n;h.width=r+"px",h.height=i+"px"}}function B(e){if(l&&h&&f){var t=l.width/Z.imageW,n=l.height/Z.imageH,r=e.x*t,i=e.y*n,s=r-parseFloat(h.width)/2,o=i-parseFloat(h.height)/2;h.left=Math.round(s+parseFloat(f.left))+"px",h.top=Math.round(o+parseFloat(f.top))+"px"}}function j(){if(h&&f&&l){var e=parseFloat(h.left)-parseFloat(f.left),t=parseFloat(h.top)-parseFloat(f.top),n=e+(parseFloat(h.width)-1)/2,r=t+(parseFloat(h.height)-1)/2,i=Z.imageW/l.width,s=Z.imageH/l.height,o=n*i,u=r*s;Z.Viewport.syncToNavigator(o,u)}}function F(){Z.Utils.showMessage(Z.Utils.getResource("ERROR_NAVIGATORIMAGEPATHINVALID"))}function I(e){Z.Viewport.zoomAndPanAllStop();if(i&&c&&h){var e=Z.Utils.event(e);c.mouseXPrior=e.clientX,c.mouseYPrior=e.clientY,dragPtStart=new Z.Utils.Point(e.clientX,e.clientY),Z.Utils.addEventListener(i,"mousemove",q),Z.Utils.addEventListener(i,"mouseup",R),Z.Utils.addEventListener(document,"mouseup",R)}}function q(e){if(c&&h){var t=parseFloat(h.left),n=parseFloat(h.top);return h.left=t+(e.clientX-c.mouseXPrior)+"px",h.top=n+(e.clientY-c.mouseYPrior)+"px",c.mouseXPrior=e.clientX,c.mouseYPrior=e.clientY,j(),!1}}function R(e){if(i&&c&&h){document.mousemove=null,document.mouseup=null,Z.Utils.removeEventListener(i,"mousemove",q),Z.Utils.removeEventListener(i,"mouseup",R),Z.Utils.removeEventListener(document,"mouseup",R);var e=Z.Utils.event(e),t=new Z.Utils.Point(e.clientX,e.clientY),n=Z.Utils.calculatePointsDistance(dragPtStart.x,dragPtStart.y,t.x,t.y,2);if(n<4){var r=Z.Utils.getElementPosition(Z.NavigatorDisplay);h.left=e.clientX-r.x-parseFloat(h.width)/2+"px",h.top=e.clientY-r.y-parseFloat(h.height)/2+"px"}j(),Z.Viewport.updateView()}}function U(e){e.preventDefault();if(i&&c&&h){var t=Z.Utils.getFirstTouch(e);if(t){var n=t.target,r=new Z.Utils.Point(t.pageX,t.pageY);dragPtStart=new Z.Utils.Point(r.x,r.y),c.mouseXPrior=r.x,c.mouseYPrior=r.y}}}function z(e){e.preventDefault();if(!Z.mousePan)return;if(c&&h){var t=Z.Utils.getFirstTouch(e);if(t){var n=t.target,r=new Z.Utils.Point(t.pageX,t.pageY),i=parseFloat(h.left),s=parseFloat(h.top);return h.left=i+(r.x-c.mouseXPrior)+"px",h.top=s+(r.y-c.mouseYPrior)+"px",c.mouseXPrior=r.x,c.mouseYPrior=r.y,j(),!1}}return!1}function W(e){if(i&&c&&h){var t=Z.Utils.getFirstTouch(e);if(t){var n=t.target,r=new Z.Utils.Point(t.pageX,t.pageY),s=new Z.Utils.Point(r.x,r.y),o=Z.Utils.calculatePointsDistance(dragPtStart.x,dragPtStart.y,s.x,s.y,2),u=Z.mobileDevice?6:3;if(o<u){var a=Z.Utils.getElementPosition(Z.NavigatorDisplay);h.left=r.x-a.x-parseFloat(h.width)/2+"px",h.top=r.y-a.y-parseFloat(h.height)/2+"px"}}j(),Z.Viewport.updateView()}}function X(e){if(i&&c&&h){var t=Z.Utils.getFirstTouch(e);if(t){var n=t.target,r=new Z.Utils.Point(t.pageX,t.pageY),s=new Z.Utils.Point(r.x,r.y),o=Z.Utils.calculatePointsDistance(dragPtStart.x,dragPtStart.y,s.x,s.y,2),u=Z.mobileDevice?6:3;if(o<u){var a=Z.Utils.getElementPosition(Z.NavigatorDisplay);h.left=r.x-a.x-parseFloat(h.width)/2+"px",h.top=r.y-a.y-parseFloat(h.height)/2+"px"}}j(),Z.Viewport.updateView()}}var t=this,n=!1,r,i,s,o,u,a,f,l,c,h,p,d=Z.navigatorW,v=Z.navigatorH,m=Z.navigatorL-1,g=Z.navigatorT-1,y=Z.navigatorFit,b,w=null,E=parseFloat(Z.Utils.getResource("DEFAULT_NAVIGATORBACKALPHA")),S;T(x),this.setImagePath=function(e){a.removeChild(p),T(N)},this.getInitialized=function(){return k()},this.setSizeAndPosition=function(e,t,n,r,i){i||(i=y),A(e,t,n,r,i)},this.setVisibility=function(e){P(e)},this.syncToViewport=function(){D()},this.syncNavigatorRectangleDimensions=function(){H()},this.syncNavigatorRectanglePosition=function(e){B(e)},this.validateNavigatorGlobals=function(){k()?C():r=window.setInterval(C,300)}},Z.NetConnector=function(){function n(e,t,n){var r=null,i=typeof t=="function";if(i)var s=t,t=function(){window.setTimeout(Z.Utils.createCallback(null,s,r),1)};if(window.ActiveXObject){var o=["Msxml2.XMLHTTP","Msxml3.XMLHTTP","Microsoft.XMLHTTP"];for(var u=0;u<o.length;u++)try{r=new ActiveXObject(o[u]);break}catch(a){continue}}else window.XMLHttpRequest&&(r=new XMLHttpRequest);r||Z.Utils.showMessage(Z.Utils.getResource("ERROR_XMLHTTPREQUESTUNSUPPORTED")),i&&(r.onreadystatechange=function(){r.readyState==4&&(r.onreadystatechange=new Function,t())});try{n===null?(r.open("GET",e,i),r.send(null)):(Z.postingXML=!0,r.open("POST",e,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.setRequestHeader("Content-length",params.length),r.setRequestHeader("Connection","close"),r.send(params))}catch(a){e.indexOf("ImageProperties.xml")!=-1?Z.Utils.showMessage(Z.Utils.getResource("ERROR_MAKINGNETWORKREQUEST-IMAGEXML")):e.toUpperCase().indexOf(".PFF")!=-1?Z.Utils.showMessage(Z.Utils.getResource("ERROR_MAKINGNETWORKREQUEST-IMAGEHEADER")):e.toUpperCase().indexOf("reply_data")!=-1?Z.Utils.showMessage(Z.Utils.getResource("ERROR_MAKINGNETWORKREQUEST-IMAGEOFFSET")):e.indexOf(Z.Utils.getResource("DEFAULT_SKINXMLFILE"))!=-1?Z.Utils.showMessage(Z.Utils.getResource("ERROR_MAKINGNETWORKREQUEST-TOOLBARXML")):e.indexOf(Z.Utils.getResource("DEFAULT_HOTSPOTSXMLFILE"))!=-1?Z.Utils.showMessage(Z.Utils.getResource("ERROR_MAKINGNETWORKREQUEST-HOTSPOTSXML")):e.indexOf(Z.Utils.getResource("DEFAULT_ANNOTATIONSXMLFILE"))!=-1?Z.Utils.showMessage(Z.Utils.getResource("ERROR_MAKINGNETWORKREQUEST-ANNOTATIONSXML")):e.toUpperCase().indexOf(Z.Utils.getResource("DEFAULT_ANNOTATIONSXMLSAVEHANDLERNAME1"))!=-1||e.toUpperCase().indexOf(Z.Utils.getResource("DEFAULT_ANNOTATIONSXMLSAVEHANDLERNAME1"))!=-1?Z.Utils.showMessage(Z.Utils.getResource("ERROR_MAKINGNETWORKREQUEST-ANNOTATIONSSAVEHANDLER")):Z.Utils.showMessage(Z.Utils.getResource("ERROR_MAKINGNETWORKREQUEST")),r.onreadystatechange=null,r=null}return i?null:r}function r(e){if(!e)Z.Utils.showMessage(Z.Utils.getResource("ERROR_NETWORKSECURITY"));else if(e.status!==200&&e.status!==0){var t=e.status,n=t==404?"Not Found":e.statusText;Z.Utils.showMessage(Z.Utils.getResource("ERROR_NETWORKSTATUS")+t+" - "+n)}else{var r=null;if(e.responseXML&&e.responseXML.documentElement)r=e.responseXML,i(r);else if(e.responseText){var s=e.responseText;if(Z.postingXML)Z.postingXML=!1,Z.Utils.showMessage(Z.Utils.getResource("ALERT_ANNOTATIONSAVESUCCESSFUL")),Z.Viewport&&Z.Viewport.setAllHotspotsSaved();else if(Z.tileSource=="ZoomifyImageFolder")r=Z.Utils.convertXMLTextToXMLDoc(s),i(r);else if(Z.tileSource=="ZoomifyImageFile"){if(s.toUpperCase().indexOf("PFFHEADER")!=-1){var o=s.indexOf("reply_data=")+"reply_data=".length;s=s.substring(o,s.length)}else{var u=s.indexOf("begin=")+"begin=".length,a=s.indexOf("&",u);beginValue=s.substring(u,a);var f=s.indexOf("reply_data=")+"reply_data=".length;replyDataValue=s.substring(f,s.length),s='<PFFOFFSET BEGIN="'+beginValue+'" REPLYDATA="'+replyDataValue+'" />'}r=Z.Utils.convertXMLTextToXMLDoc(s),i(r)}}}}function i(e){if(e&&e.documentElement){var t=e.documentElement.tagName;t=="COPYRIGHT"?s("copyright",e):t=="IMAGE_PROPERTIES"||t=="PFFHEADER"?s("image",e):t=="PFFOFFSET"?s("offset",e):t=="SKINDATA"?s("skin",e):t=="DATA"?s("hotspots",e):t=="ZAS"?s("annotations",e):Z.Utils.showMessage(Z.Utils.getResource("ERROR_XMLINVALID"))}else Z.Utils.showMessage(Z.Utils.getResource("ERROR_XMLDOCINVALID"))}function s(e,t){if(e=="copyright"){var n=t.documentElement.getAttribute("STATEMENTTEXT"),r=t.documentElement.getAttribute("DECLINEDTEXT");Z.Utils.isStrVal(n)?Z.Utils.showCopyright(n,r):Z.Utils.showMessage(Z.Utils.getResource("ERROR_IMAGEXMLINVALID"))}else e=="image"?(Z.tileSource=="ZoomifyImageFolder"||Z.tileSource=="ZoomifyImageFile"||Z.tileSource=="OtherTileSource")&&Z.Viewport&&Z.Viewport.parseImageXML(t):e=="offset"?Z.Viewport&&Z.Viewport.parseOffsetChunk(t):e=="skin"?Z.Toolbar&&Z.Toolbar.parseSkinXML(t):e=="hotspots"?Z.Viewport&&Z.Viewport.parseHotspotsXML(t):e=="annotations"&&Z.Viewport&&Z.Viewport.parseAnnotationsXML(t)}function o(t,n,r){e--;if(typeof t=="function")try{t(r)}catch(i){Z.Utils.showMessage(i.name+Z.Utils.getResource("ERROR_EXECUTINGCALLBACK")+n+" "+i.message)}}function u(e,n,r){function o(t){i.onload=null,i.onabort=null,i.onerror=null,s&&window.clearTimeout(s),window.setTimeout(function(){n(e,t?i:null)},1)}var i=null,s=null;this.start=function(){i=new Image;var n=function(){o(!0)},u=function(){o(!1)},a=function(){Z.Utils.showMessage(Z.Utils.getResource("ERROR_IMAGEREQUESTTIMEDOUT")+e),o(!1),Z.debug==2&&Z.Utils.trace("Image request for "+r+" timeout: "+e)};i.onload=n,i.onabort=u,i.onerror=u,s=window.setTimeout(a,t),i.src=e}}var e=0,t=parseFloat(Z.Utils.getResource("DEFAULT_IMAGELOADTIMEOUT"));this.loadXML=function(e){n(e,r,null)},this.postXML=function(e,t){n(e,r,t)},this.loadImage=function(t,n,r){if(e>=parseInt(Z.Utils.getResource("DEFAULT_IMAGESLOADINGMAX"),10))return!1;var i=Z.Utils.createCallback(null,o,n),s=new u(t,i,r);return e++,s.start(),!0}},Z.Utils={declareGlobals:function(){Z.pageContainerID=null,Z.imagePath=null,Z.skinPath=null,Z.skinMode=null,Z.parameters=null,Z.browsers=null,Z.browser=null,Z.browserVersion=null,Z.canvasSupported=null,Z.cssTransformsSupported=null,Z.cssTransformProperty=null,Z.cssTransformNoUnits=null,Z.alphaSupported=null,Z.renderQuality=null,Z.mobileDevice=null,Z.initialX=null,Z.initialY=null,Z.initialZ=null,Z.minZ=null,Z.maxZ=null,Z.zoomSpeed=null,Z.panSpeed=null,Z.fadeInSpeed=null,Z.toolbarVisible=null,Z.toolbarW=null,Z.toolbarH=null,Z.toolbarPosition=null,Z.navigatorVisible=null,Z.navigatorW=null,Z.navigatorH=null,Z.navigatorL=null,Z.navigatorT=null,Z.navigatorFit=null,Z.clickZoom=null,Z.clickPan=null,Z.mousePan=null,Z.keys=null,Z.constrainPan=null,Z.tooltipsVisible=null,Z.watermarkPath=null,Z.copyrightPath=null,Z.hotspotPath=null,Z.hotspotListTitle=null,Z.annotationPath=null,Z.saveHandlerPath=null,Z.postingXML=!1,Z.sliderVisible=null,Z.fullPageVisible=null,Z.fullPageInitial=null,Z.progressVisible=null,Z.logoVisible=null,Z.logoCustomPath=null,Z.canvas=null,Z.debug=null,Z.imageProperties=null,Z.serverIP=null,Z.serverPort=null,Z.tileHandlerPath=null,Z.tileHandlerPathFull=null,Z.tileSource=null,Z.editMode=!1,Z.polygonEditing=!1,Z.Viewer=null,Z.ViewerDisplay=null,Z.Viewport=null,Z.Toolbar=null,Z.ToolbarDisplay=null,Z.TooltipDisplay=null,Z.Navigator=null,Z.NavigatorDisplay=null,Z.MessageDisplay=null,Z.CopyrightDisplay=null,Z.AnnotationPanelDisplay=null,Z.imageW=null,Z.imageH=null,Z.imageX=0,Z.imageY=0,Z.imageZ=0,Z.fitZ=null,Z.zooming="stop",Z.panningX="stop",Z.panningY="stop",Z.fullPage=!1,Z.useCanvas=!0,Z.TraceDisplay=null,Z.traces=null},enforceCopyright:function(){var e=this.readCookie("imageCopyright");e?Z.Viewer.configureViewer():this.loadCopyrightText()},loadCopyrightText:function(){var e=new Z.NetConnector;e.loadXML(Z.copyrightPath)},showCopyright:function(e,t){var n=this.getResource("DEFAULT_COPYRIGHTSCREENCOLOR"),r=this.getResource("DEFAULT_COPYRIGHTBUTTONCOLOR");Z.CopyrightDisplay=this.createContainerElement("div","CopyrightDisplay","inline-block","absolute","hidden",Z.viewerW-2+"px",Z.viewerH-2+"px","0px","0px","solid","1px",n,"0px","0px","normal"),Z.ViewerDisplay.appendChild(Z.CopyrightDisplay);var i=440,s=200,o=parseFloat(Z.CopyrightDisplay.style.width)/2-i/2,u=parseFloat(Z.CopyrightDisplay.style.height)/2-s/2,a=this.createContainerElement("div","textBox","inline-block","absolute","hidden",i+"px",s+"px",o+"px",u+"px","none","0px","transparent none","0px","0px","normal");a.id="textBox",Z.CopyrightDisplay.appendChild(a);var f=document.createTextNode(e);a.appendChild(this.createCenteredElement(f)),this.setTextStyle(f,"black","verdana","16px","none","normal","normal","normal","normal","1em","justify","none");var l=document.createTextNode(t);a.appendChild(l);var c=80,h=20,p=30,d=20,v=o+i/2-(c*2+p)/2,m=u+s+d,g=this.getResource("DEFAULT_COPYRIGHTAGREEBUTTONTEXT"),y=new Z.Utils.Button("buttonAgree",g,null,null,null,null,c+"px",h+"px",v+"px",m+"px","mousedown",this.copyrightAgreeButtonHandler,"TIP_COPYRIGHTAGREE","solid","1px",r,"0px","0px");Z.CopyrightDisplay.appendChild(y.elmt),v+=c+p,g=this.getResource("DEFAULT_COPYRIGHTEXITBUTTONTEXT");var b=new Z.Utils.Button("buttonExit",g,null,null,null,null,c+"px",h+"px",v+"px",m+"px","mousedown",this.copyrightExitButtonHandler,"TIP_COPYRIGHTEXIT","solid","1px",r,"0px","0px");Z.CopyrightDisplay.appendChild(b.elmt)},hideCopyright:function(){var e=document.getElementById("textBox"),t=e.childNodes[1].nodeValue;e.firstChild.firstChild.firstChild.firstChild.nodeValue=t;var n=document.getElementById("buttonAgree");this.removeEventListener(n,"mousedown",this.copyrightAgreeButtonHandler),Z.CopyrightDisplay.removeChild(n);var r=document.getElementById("buttonExit");this.removeEventListener(r,"mousedown",this.copyrightExitButtonHandler),Z.CopyrightDisplay.removeChild(r)},copyrightAgreeButtonHandler:function(e){Z.ViewerDisplay.removeChild(Z.CopyrightDisplay),document.cookie="imageCopyright=confirmed",Z.Viewer.configureViewer()},copyrightExitButtonHandler:function(e){Z.Utils.hideCopyright();return},Button:function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b){var w=Z.Utils.createContainerElement("span",e,"inline-block","absolute","hidden",o,u,a,f,p,d,v,m,g,y,b);if(!Z.Utils.isStrVal(t)){n=Z.Utils.removeTrailingSlashCharacters(n);var E=Z.Utils.createGraphicElement(n+"/"+r),S=Z.Utils.createGraphicElement(n+"/"+i),x=Z.Utils.createGraphicElement(n+"/"+s);E.id=w.id+"-imgUp",S.id=w.id+"-imgOver",x.id=w.id+"-imgDown",w._imgUpID=E.id,w._imgOverID=S.id,w._imgDownID=x.id;var T=E.style,N=S.style,C=x.style;T.position=N.position=C.position="absolute",T.width=N.width=N.width=o,T.height=N.height=N.height=u,T.top=N.top=C.top="0px",T.left=N.left=C.left="0px",Z.browser==Z.browsers.FIREFOX&&Z.browserVersion<3&&(T.top=N.top=C.top=""),N.visibility="hidden",C.visibility="hidden",w.appendChild(E),w.appendChild(S),w.appendChild(x),Z.Utils.addEventListener(E,"contextmenu",Z.Utils.preventDefault),Z.Utils.addEventListener(S,"contextmenu",Z.Utils.preventDefault),Z.Utils.addEventListener(x,"contextmenu",Z.Utils.preventDefault)}else{var k=document.createTextNode(t);w.appendChild(Z.Utils.createCenteredElement(k)),Z.Utils.setTextStyle(k,"black","verdana","13px","none","normal","normal","normal","normal","1em","center","none"),Z.Utils.disableTextInteraction(k),Z.Utils.addEventListener(w,"contextmenu",Z.Utils.preventDefault)}Z.tooltipsVisible&&Z.Utils.isStrVal(h)&&(w.title=Z.Utils.getResource(h)),Z.mobileDevice?Z.Utils.addEventListener(w,"touchstart",c):(Z.Utils.addEventListener(w,"mousedown",Z.Utils.preventDefault),Z.Utils.addEventListener(w,"mouseover",Z.Utils.stopPropagation),Z.Utils.addEventListener(w,"mouseout",Z.Utils.stopPropagation),Z.Utils.addEventListener(w,l,c)),this.elmt=w},buttonSize:function(e,t,n){var r=e.style;r.width=t+"px",r.height=n+"px";var i=document.getElementById(e._imgUpID),s=document.getElementById(e._imgOverID),o=document.getElementById(e._imgDownID);if(i&&s&&o){var u=i.style,a=s.style,f=o.style;u.width=t+"px",u.height=n+"px",a.width=t+"px",a.height=n+"px",f.width=t+"px",f.height=n+"px"}},Graphic:function(e,t,n,r,i,s,o){t=Z.Utils.removeTrailingSlashCharacters(t);var u=n?t+"/"+n:t,a=Z.Utils.createGraphicElement(u),f=a.style;f.width=r,f.height=i;var n=Z.Utils.createContainerElement("span",e,"inline-block","absolute","hidden",r,i,s,o,"none","0px","transparent none","0px","0px","normal");n.appendChild(a),this.elmt=n,Z.mobileDevice?Z.Utils.addEventListener(a,"touchstart",Z.Utils.preventDefault):Z.Utils.addEventListener(a,"mousedown",Z.Utils.preventDefault),Z.Utils.addEventListener(a,"contextmenu",Z.Utils.preventDefault)},graphicSize:function(e,t,n){var r=e.style;r.width=t+"px",r.height=n+"px";var i=e.firstChild,s=i.style;s.width=t+"px",s.height=n+"px"},addCrossBrowserPrototypes:function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){t?t<0&&(t=Math.max(0,this.length+t)):t=0;for(var n=t,r=this.length;n<r;n++)if(this[n]===e)return n;return-1}),Array.prototype.indexOfObjectValue||(Array.prototype.indexOfObjectValue=function(e,t,n){n?n<0&&(n=Math.max(0,this.length+n)):n=0;for(var r=n,i=this.length;r<i;r++)if(this[r][e]===t)return r;return-1}),Array.prototype.indexOfObjectValueSubstring||(Array.prototype.indexOfObjectValueSubstring=function(e,t,n){n?n<0&&(n=Math.max(0,this.length+n)):n=0;for(var r=n,i=this.length;r<i;r++)if(this[r][e].indexOf(t)!=-1)return r;return-1}),Array.prototype.push||(Array.prototype.push=function(e){this[this.length]=e}),Array.prototype.splice||(Array.prototype.subarr=function(e,t){if(e>=this.length||t&&t<=0)return[];e<0&&(Math.abs(e)>this.length?e=0:e=this.length+e);if(!t||t+e>this.length)t=this.length-e;var n=[];for(var r=e;r<e+t;r++)n.push(this[r]);return n},Array.prototype.subarray=function(e,t){e<0&&(e=0);if(!t||t>this.length)t=this.length;if(e==t)return[];var n=[];for(var r=e;r<t;r++)n.push(this[r]);return n},Array.prototype.splice=function(e,t){t<0&&(t=0);var n=[];if(arguments.length>2)for(var r=2,i=arguments.length;r<i;r++)n.push(arguments[r]);var s=this.subarray(0,e),o=this.subarr(e,t),u=this.subarray(e+t),a=s.concat(n,u);this.length=0;for(var r=0,i=a.length;r<i;r++)this.push(a[r]);return o}),String.prototype.multiply||(String.prototype.multiply=function(){var e=Array.prototype.join,t={};return function(n){return t.length=n+1,e.call(t,this)}}())},addCrossBrowserMethods:function(){document.addEventListener?(this.disableTextInteraction=function(e){e&&(tnS=e.parentNode.style,tnS&&(e.parentNode.unselectable="on",tnS.userSelect="none",tnS.MozUserSelect="none",tnS.webkitUserSelect="none",tnS.webkitTouchCallout="none",tnS.webkitTapHighlightColor="transparent"))},this.renderQuality=function(e,t){if(t){var n=t=="high"?"optimizeQuality":"optimizeSpeed";e.style.setProperty("image-rendering",n,null)}},this.setOpacity=function(e,t,n){Z.alphaSupported?e.style.opacity=t:n&&(e.style.backgroundColor=n)}):document.attachEvent&&(this.disableTextInteraction=function(e){e&&(e.parentNode.unselectable="on",e.parentNode.onselectstart=function(){return!1})},this.renderQuality=function(e,t){if(t){var n=t=="high"?"bicubic":"nearest-neighbor";e.style.msInterpolationMode=n}},this.setOpacity=function(e,t,n){Z.alphaSupported?(t*=100,e.style.zoom=1,e.style.filter="progid:DXImageTransform.Microsoft.Alpha(Opacity="+t+")",e.style.filter="alpha(opacity="+t+")",t==100&&(e.style.filter="")):n&&(e.style.backgroundColor=n)})},addCrossBrowserEvents:function(){document.addEventListener?(this.addEventListener=function(e,t,n){t=="mousewheel"&&elmt.addEventListener("DOMMouseScroll",n,!1),e.addEventListener(t,n,!1)},this.removeEventListener=function(e,t,n){t=="mousewheel"&&elmt.addEventListener("DOMMouseScroll",n,!1),e&&e.removeEventListener(t,n,!1)},this.event=function(e){return e},this.target=function(e){return e.target},this.relatedTarget=function(e){return e.relatedTarget},this.isRightMouseButton=function(e){var t=!1;if(e.which==2||e.which==3)t=!0;return t},this.preventDefault=function(e){e.preventDefault()},this.stopPropagation=function(e){e.stopPropagation()}):document.attachEvent&&(this.addEventListener=function(e,t,n){if(this._findListener(e,t,n)!=-1)return;var r=function(){var t=window.event;Function.prototype.call?n.call(e,t):(e._currentListener=n,e._currentListener(t),e._currentListener=null)};e.attachEvent("on"+t,r);var i={target:e,eventName:t,handler:n,handler2:r},s=e.document||e,o=s.parentWindow,u="l"+this._listenerCounter++;o._allListeners||(o._allListeners={}),o._allListeners[u]=i,e._listeners||(e._listeners=[]),e._listeners[e._listeners.length]=u,o._unloadListenerAdded||(o._unloadListenerAdded=!0,o.attachEvent("onunload",this._removeAllListeners))},this.removeEventListener=function(e,t,n){if(e){var r=this._findListener(e,t,n);if(r==-1)return;var i=e.document||e,s=i.parentWindow,o=e._listeners[r],u=s._allListeners[o];e.detachEvent("on"+t,u.handler2),e._listeners.splice(r,1),delete s._allListeners[o]}},this.event=function(e){return window.event},this.target=function(e){return e.srcElement},this.relatedTarget=function(e){var t=null;return e.type=="mouseover"?t=e.fromElement:e.type=="mouseout"&&(t=e.toElement),t},this.isRightMouseButton=function(e){var t=!1;return e.button==2&&(t=!0),t},this.preventDefault=function(e){e&&(e.returnValue=!1)},this.stopPropagation=function(e){e.cancelBubble=!0},this._findListener=function(e,t,n){var r=e._listeners;if(!r)return-1;var i=e.document||e,s=i.parentWindow;for(var o=r.length-1;o>=0;o--){var u=r[o],a=s._allListeners[u];if(a.eventName==t&&a.handler==n)return o}return-1},this._removeAllListeners=function(){var e=this;for(id in e._allListeners){var t=e._allListeners[id];t.target.detachEvent("on"+t.eventName,t.handler2),delete e._allListeners[id]}},this._listenerCounter=0)},detectBrowserInfo:function(){Z.browsers={UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5};var e=Z.browsers.UNKNOWN,t=0,n=navigator.appName,r=navigator.appVersion,i=!1,s=!1,o=navigator.userAgent.toLowerCase();if(n!="Microsoft Internet Explorer"||!window.attachEvent||!window.ActiveXObject)if(n!="Netscape"||!window.addEventListener)n=="Opera"&&!!window.opera&&!!window.attachEvent&&(e=Z.browsers.OPERA,t=parseFloat(r));else{var a=o.indexOf("firefox"),f=o.indexOf("safari"),l=o.indexOf("chrome");if(a>=0)e=Z.browsers.FIREFOX,t=parseFloat(o.substring(a+8));else if(f>=0){var c=o.substring(0,f).lastIndexOf("/");e=l>=0?Z.browsers.CHROME:Z.browsers.SAFARI,t=parseFloat(o.substring(c+1,f))}var h=new Image;h.style.getPropertyValue&&(s=h.style.getPropertyValue("image-rendering"))}else{var u=o.indexOf("msie");e=Z.browsers.IE,t=parseFloat(o.substring(u+5,o.indexOf(";",u))),i=typeof document.documentMode!="undefined"}var p=document.documentElement||{},d=p.style||{},v=!1,m=["transform","WebkitTransform","MozTransform"],g,y;while(g=m.shift())if(typeof d[g]!="undefined"){v=!0,y=/webkit/i.test(g);break}var b=document.createElement("canvas").getContext&&document.createElement("canvas").getContext("2d"),w=!(e==Z.browsers.SAFARI&&t<4||e==Z.browsers.CHROME&&t<2),E=b&&w,S=!(e==Z.browsers.CHROME&&t<2),x=i||s?"high":null,T=o.indexOf("android")>-1||o.indexOf("iphone")>-1||o.indexOf("ipad")>-1||o.indexOf("ipod")>-1;Z.browser=e,Z.browserVersion=t,Z.canvasSupported=E,Z.useCanvas=Z.canvasSupported,Z.cssTransformsSupported=v,Z.cssTransformProperty=g,Z.cssTransformNoUnits=y,Z.alphaSupported=S,Z.renderQuality=x,Z.mobileDevice=T},isStrVal:function(e){return e!=null&&e!=""&&e!="null"},getCurrentUTCDateAsString:function(){var e=new Date,t=(e.getUTCMonth()+1<10?"0":"")+(e.getUTCMonth()+1),n=(e.getUTCDate()<10?"0":"")+e.getUTCDate(),r=(e.getUTCHours()<10?"0":"")+e.getUTCHours(),i=(e.getUTCMinutes()<10?"0":"")+e.getUTCMinutes(),s=(e.getUTCSeconds()<10?"0":"")+e.getUTCSeconds();return e.getUTCFullYear()+t+n+r+i+s},getElementPosition:function(e){var t=0,n=0,r=this.getElementStyle(e).position=="fixed",i=this.getOffsetParent(e,r);while(i){t+=e.offsetLeft,n+=e.offsetTop;if(r){var s=this.getPageScroll();t+=s.x,n+=s.y}e=i,r=this.getElementStyle(e).position=="fixed",i=this.getOffsetParent(e,r)}return new this.Point(t,n)},getOffsetParent:function(e,t){return t&&e!=document.body?document.body:e.offsetParent},getElementSize:function(e){return new this.Point(e.clientWidth,e.clientHeight)},getElementStyle:function(e){if(e.currentStyle)return e.currentStyle;if(window.getComputedStyle)return window.getComputedStyle(e,"");this.showMessage(this.getResource("ERROR_UNKNOWNELEMENTSTYLE"))},getElementStyleProperty:function(e,t){if(e.currentStyle)return e.currentStyle[t];if(window.getComputedStyle)return document.defaultView.getComputedStyle(e,null).getPropertyValue(t);this.showMessage(this.getResource("ERROR_UNKNOWNELEMENTSTYLE"))},getEventTargetCoords:function(e){return getElementPosition(Z.Utils.target(e))},getFirstTouch:function(e){var t=null,n=e.touches,r=e.changedTouches;return n!==undefined?t=n[0]:r!==undefined&&(t=r[0]),t},getMousePosition:function(e){var t=0,n=0;return e.type=="DOMMouseScroll"&&browser==Browser.FIREFOX&&browserVersion<3?(t=e.screenX,n=e.screenY):typeof e.pageX=="number"?(t=e.pageX,n=e.pageY):typeof e.clientX=="number"?(t=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,n=e.clientY+document.body.scrollTop+document.documentElement.scrollTop):this.showMessage(this.getResource("ERROR_UNKNOWNMOUSEPOSITION")),new this.Point(t,n)},getMouseScroll:function(e){var t=0;return typeof e.wheelDelta=="number"?t=e.wheelDelta:typeof e.detail=="number"?t=e.detail*-1:this.showMessage(this.getResource("ERROR_UNKNOWNMOUSESCROLL")),t?t/Math.abs(t):0},getPageScroll:function(){var e=0,t=0,n=document.documentElement||{},r=document.body||{};if(typeof window.pageXOffset=="number")e=window.pageXOffset,t=window.pageYOffset;else if(r.scrollLeft||r.scrollTop)e=r.scrollLeft,t=r.scrollTop;else if(n.scrollLeft||n.scrollTop)e=n.scrollLeft,t=n.scrollTop;return new this.Point(e,t)},getWindowSize:function(){var e=0,t=0,n=document.documentElement||{},r=document.body||{};return typeof window.innerWidth=="number"?(e=window.innerWidth,t=window.innerHeight):n.clientWidth||n.clientHeight?(e=n.clientWidth,t=n.clientHeight):r.clientWidth||r.clientHeight?(e=r.clientWidth,t=r.clientHeight):this.showMessage(this.getResource("ERROR_UNKNOWNWINDOWSIZE")),new this.Point(e,t)},nodeIsInViewer:function(e){var t=!1,n=e;while(t==0){if(!n)break;n.id?n.id=="ViewerDisplay"?t=!0:n=n.parentNode:n=n.parentNode}return t},readCookie:function(e){var t=e+"=",n=document.cookie.split(";");for(var r=0;r<n.length;r++){var i=n[r];while(i.charAt(0)==" ")i=i.substring(1,i.length);if(i.indexOf(t)==0)return i.substring(t.length,i.length)}return null},removeTrailingSlashCharacters:function(e){var t=e.slice(-1,e.length)=="/"?e.slice(0,e.length-1):e;return t},cacheProofPath:function(e){return e+="?noCacheSfx="+(new Date).getTime().toString(),e},easing:function(e,t,n,r){var i=t-e;return(n/=r/2)<1?i/2*n*n*n*n*n+e:i/2*((n-=2)*n*n*n*n+2)+e},parseParameters:function(e){var t;return e&&(t=e.split("&")),t},setParameters:function(e){var t=this.getResource("DEFAULT_PARAMETERSENABLETEST"),n=this.getResource("DEFAULT_PARAMETERSDISABLEVALUE"),r=this.getResource("DEFAULT_PARAMETERSDISABLEDALERT"),i=this.getResource("DEFAULT_PFFSUPPORTENABLETEST"),s=this.getResource("DEFAULT_PFFSUPPORTDISABLEVALUE"),o=this.getResource("DEFAULT_PFFSUPPORTDISABLEDALERT"),u=i!=s?!0:!1,a=this.getResource("DEFAULT_ANNOTATIONSUPPORTENABLETEST"),f=this.getResource("DEFAULT_ANNOTATIONSUPPORTDISABLEVALUE"),l=this.getResource("DEFAULT_ANNOTATIONSUPPORTDISABLEDALERT"),c=a!=f?!0:!1;Z.skinPath=this.getResource("DEFAULT_SKINXMLPATH"),Z.skinMode=this.getResource("DEFAULT_SKINMODE"),isNaN(parseFloat(this.getResource("DEFAULT_INITIALX")))||(Z.initialX=parseFloat(this.getResource("DEFAULT_INITIALX"))),isNaN(parseFloat(this.getResource("DEFAULT_INITIALY")))||(Z.initialY=parseFloat(this.getResource("DEFAULT_INITIALY"))),isNaN(parseFloat(this.getResource("DEFAULT_INITIALZOOM")))||(Z.initialZ=parseFloat(this.getResource("DEFAULT_INITIALZOOM"))),isNaN(parseFloat(this.getResource("DEFAULT_MINZOOM")))||(Z.minZ=parseFloat(this.getResource("DEFAULT_MINZOOM"))),isNaN(parseFloat(this.getResource("DEFAULT_MAXZOOM")))||(Z.maxZ=parseFloat(this.getResource("DEFAULT_MAXZOOM"))),isNaN(parseFloat(this.getResource("DEFAULT_ZOOMSPEED")))||(Z.zoomSpeed=parseFloat(this.getResource("DEFAULT_ZOOMSPEED"))),isNaN(parseFloat(this.getResource("DEFAULT_PANSPEED")))||(Z.panSpeed=parseFloat(this.getResource("DEFAULT_PANSPEED"))),isNaN(parseFloat(this.getResource("DEFAULT_FADEINSPEED")))||(Z.fadeInSpeed=parseFloat(this.getResource("DEFAULT_FADEINSPEED"))),Z.toolbarVisible=parseInt(this.getResource("DEFAULT_TOOLBARVISIBLE"),10),Z.toolbarPosition=parseFloat(this.getResource("DEFAULT_TOOLBARPOSITION")),Z.tooltipsVisible=this.getResource("DEFAULT_TOOLTIPSVISIBLE")!="0",Z.navigatorVisible=parseInt(this.getResource("DEFAULT_NAVIGATORVISIBLE"),10),Z.navigatorW=parseInt(this.getResource("DEFAULT_NAVIGATORWIDTH"),10),Z.navigatorH=parseInt(this.getResource("DEFAULT_NAVIGATORHEIGHT"),10),Z.navigatorL=parseInt(this.getResource("DEFAULT_NAVIGATORLEFT"),10),Z.navigatorT=parseInt(this.getResource("DEFAULT_NAVIGATORTOP"),10),Z.navigatorFit=this.getResource("DEFAULT_NAVIGATORFIT"),Z.clickZoom=this.getResource("DEFAULT_CLICKZOOM")!="0",Z.clickPan=this.getResource("DEFAULT_CLICKPAN")!="0",Z.mousePan=this.getResource("DEFAULT_MOUSEPAN")!="0",Z.keys=this.getResource("DEFAULT_KEYS")!="0",Z.constrainPan=this.getResource("DEFAULT_CONSTRAINPAN")!="0",Z.sliderVisible=this.getResource("DEFAULT_SLIDERVISIBLE")!="0",Z.fullPageVisible=this.getResource("DEFAULT_FULLPAGEVISIBLE")!="0",Z.fullPageInitial=this.getResource("DEFAULT_FULLPAGEINITIAL")!="0",Z.progressVisible=this.getResource("DEFAULT_PROGRESSVISIBLE")!="0",Z.logoVisible=this.getResource("DEFAULT_LOGOVISIBLE")!="0",Z.logoCustomPath=this.getResource("DEFAULT_LOGOCUSTOMPATH"),Z.canvas=this.getResource("DEFAULT_CANVAS")!="0",Z.debug=parseInt(this.getResource("DEFAULT_DEBUG"),10);if(this.isStrVal(e))for(var h=0,p=e.length;h<p;h++){var d=e[h],v=d.indexOf("=");if(v>0){var m=d.substring(0,v),g=d.substring(v+1);if(this.isStrVal(g))switch(m){case"zInitialX":isNaN(parseFloat(g))||(Z.initialX=parseFloat(g));break;case"zInitialY":isNaN(parseFloat(g))||(Z.initialY=parseFloat(g));break;case"zInitialZoom":isNaN(parseFloat(g))||(Z.initialZ=parseFloat(g),Z.initialZ&&(Z.initialZ/=100));break;case"zMinZoom":!isNaN(parseFloat(g))&&parseFloat(g)>.01&&(Z.minZ=parseFloat(g),Z.minZ&&(Z.minZ/=100));break;case"zMaxZoom":isNaN(parseFloat(g))||(Z.maxZ=parseFloat(g),Z.maxZ&&(Z.maxZ/=100));break;case"zNavigatorVisible":Z.navigatorVisible=parseInt(g,10);break;case"zToolbarVisible":Z.toolbarVisible=parseInt(g,10);break;case"zLogoVisible":g=="0"&&(Z.logoVisible=!1);break;case"zSliderVisible":g=="0"&&(Z.sliderVisible=!1);break;case"zFullPageVisible":g=="0"&&(Z.fullPageVisible=!1);break;case"zFullPageInitial":g=="1"&&(Z.fullPageInitial=!0);break;case"zProgressVisible":g=="0"&&(Z.progressVisible=!1);break;case"zTooltipsVisible":g=="0"&&(Z.tooltipsVisible=!1);break;case"zSkinPath":Z.skinPath=g;break;default:if(t==n)alert(r+" "+m);else switch(m){case"zZoomSpeed":Z.zoomSpeed=parseInt(g,10);break;case"zPanSpeed":Z.panSpeed=parseInt(g,10);break;case"zFadeInSpeed":Z.fadeInSpeed=parseInt(g,10);break;case"zToolbarPosition":Z.toolbarPosition=parseInt(g,10);break;case"zNavigatorWidth":isNaN(parseFloat(g))||(Z.navigatorW=parseFloat(g));break;case"zNavigatorHeight":isNaN(parseFloat(g))||(Z.navigatorH=parseFloat(g));break;case"zNavigatorLeft":isNaN(parseFloat(g))||(Z.navigatorL=parseFloat(g));break;case"zNavigatorTop":isNaN(parseFloat(g))||(Z.navigatorT=parseFloat(g));break;case"zNavigatorFit":isNaN(parseFloat(g))||(Z.navigatorFit=parseInt(g,10));break;case"zClickZoom":g=="0"&&(Z.clickZoom=!1);break;case"zClickPan":g=="0"&&(Z.clickPan=!1);break;case"zMousePan":g=="0"&&(Z.mousePan=!1);break;case"zKeys":g=="0"&&(Z.keys=!1);break;case"zConstrainPan":g=="0"&&(Z.constrainPan=!1);break;case"zWatermarkPath":Z.watermarkPath=g;break;case"zCopyrightPath":Z.copyrightPath=g;break;case"zHotspotPath":Z.hotspotPath=g;break;case"zHotspotListTitle":Z.hotspotListTitle=g;break;case"zAnnotationPath":Z.annotationPath=g;break;case"zLogoCustomPath":Z.logoCustomPath=g;break;case"zCanvas":g=="0"&&(Z.canvas=!1);if(!Z.canvasSupported||!Z.canvas)Z.useCanvas=!1;break;case"zDebug":Z.debug=parseInt(g,10);break;case"zImageProperties":Z.imageProperties=g;break;case"zServerIP":Z.serverIP=g;break;case"zServerPort":Z.serverPort=g;break;case"zTileHandlerPath":Z.tileHandlerPath=g;break;case"zEditMode":Z.editMode=g;break;case"zSaveHandlerPath":Z.saveHandlerPath=g}}}}if(!Z.Utils.isStrVal(Z.tileHandlerPath))Z.tileSource="ZoomifyImageFolder";else if(Z.imagePath.toLowerCase().indexOf(".pff")!=-1)if(u){Z.tileSource="ZoomifyImageFile";var y=Z.tileHandlerPath;Z.tileHandlerPathFull=y}else alert(o);else Z.tileSource="OtherTileSource";if(Z.Utils.isStrVal(Z.annotationPath)||Z.Utils.isStrVal(Z.saveHandlerPath))if(c){if(Z.Utils.isStrVal(Z.saveHandlerPath)){var b=Z.saveHandlerPath;Z.saveHandlerPath=b}}else Z.annotationPath="",alert(l)},removeDups:function(e){for(var t=1;t<e.length;)e[t-1]==e[t]?e.splice(t,1):t++;return e},intersect:function(e,t){var n=[];for(var r=0;r<e.length;r++){var i=e[r],s=!1;for(var o=0;o<t.length&&i>=(elmt2=t[o]);o++)if(elmt2==i){s=!0;break}s&&n.push(e[r])}return n},subtract:function(e,t){for(var n=0;n<e.length;n++){var r=e[n],i=!1;for(var s=0;s<t.length&&r>=(elmt2=t[s]);s++)if(elmt2==r){i=!0;break}i&&e.splice(n--,1)}return e},clone:function(e,t,n){n=[];switch(e){case"hotspots":for(var r=0,i=t.length;r<i;r++){polygonPtsTemp=[];var s=t[r].polygonPts;if(t[r].polygonPts!==null)for(var o=0,u=s.length;o<u;o++)polygonPtsTemp.push({x:s[o].x,y:s[o].y});n.push({id:t[r].id,internalID:t[r].internalID,name:t[r].name,media:t[r].media,mediaType:t[r].mediaType,image:t[r].image,iW:t[r].iW,iH:t[r].iH,x:t[r].x,y:t[r].y,zoom:t[r].zoom,xScale:t[r].xScale,yScale:t[r].yScale,url:t[r].url,urlTarget:t[r].urlTarget,visibility:t[r].visibility,rollover:t[r].rollover,caption:t[r].caption,tooltip:t[r].tooltip,textColor:t[r].textColor,backColor:t[r].backColor,lineColor:t[r].lineColor,fillColor:t[r].fillColor,textVisible:t[r].textVisible,backVisible:t[r].backVisible,lineVisible:t[r].lineVisible,fillVisible:t[r].fillVisible,captionPosition:t[r].captionPosition,saved:t[r].saved,polygonPts:polygonPtsTemp})}break;case"pois":for(var r=0,i=t.length;r<i;r++)n.push({text:t[r].text,value:t[r].value,x:t[r].x,y:t[r].y,zoom:t[r].zoom});break;case"notes":for(var r=0,i=t.length;r<i;r++)n.push({text:t[r].text,value:t[r].value,noteText:t[r].noteText,poiID:t[r].poiID});break;case"labels":for(var r=0,i=t.length;r<i;r++)n.push({text:t[r].text,value:t[r].value,poiID:t[r].poiID})}return n},calculatePointsDistance:function(e,t,n,r){return Math.sqrt((e-=n)*e+(t-=r)*t)},getDimensionsFromPolygonPoints:function(e){var t=e[0].x,n=e[0].y,r=e[0].x,i=e[0].y;for(var s=1,o=e.length;s<o;s++)e[s].x<t&&(t=e[s].x),e[s].x>r&&(r=e[s].x),e[s].y<n&&(n=e[s].y),e[s].y>i&&(i=e[s].y);var u=r-t,a=i-n;return new Z.Utils.Point(u,a)},getCenterOfPolygonPoints:function(e){var t=e[0].x,n=e[0].y,r=e[0].x,i=e[0].y;for(var s=1,o=e.length;s<o;s++)t=Math.min(t,e[s].x),n=Math.min(n,e[s].y),r=Math.max(r,e[s].x),i=Math.max(i,e[s].y);var u=t+(r-t)/2,a=n+(i-n)/2;return new Z.Utils.Point(u,a)},createCallback:function(e,t){var n=[];for(var r=2,i=arguments.length;r<i;r++)n.push(arguments[r]);return function(){var r=n.concat([]);for(var i=0,s=arguments.length;i<s;i++)r.push(arguments[i]);return t.apply(e,r)}},createContainerElement:function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){var m=document.createElement(e);this.isStrVal(t)&&(m.id=t);var g=m.style;return g.display=this.isStrVal(n)?n:"inline-block",g.position=this.isStrVal(r)?r:"static",g.overflow=this.isStrVal(i)?i:"hidden",e=="canvas"?(this.isStrVal(s)&&m.setAttribute("width",s),this.isStrVal(o)&&m.setAttribute("height",o)):(this.isStrVal(s)&&(g.width=s),this.isStrVal(o&&o)&&(g.height=o)),this.isStrVal(u)&&(g.left=u),this.isStrVal(a)&&(g.top=a),g.borderStyle=this.isStrVal(f)?f:"none",g.borderWidth=this.isStrVal(l)?l:"0px",g.borderColor="#696969",g.background=this.isStrVal(c)?c:"transparent none",g.margin=this.isStrVal(h)?h:"0px",g.padding=this.isStrVal(p)?p:"0px",g.whiteSpace=this.isStrVal(d)?d:"normal",this.isStrVal(v)&&(g.cursor=v),m},createCenteredElement:function(e){var t=this.createContainerElement("div"),n=[];n.push('<div style="display:table; height:100%; width:100%;'),n.push("border:none; margin:0px; padding:0px;"),n.push('#position:relative; overflow:hidden; text-align:left;">'),n.push('<div style="#position:absolute; #top:50%; width:100%; '),n.push("border:none; margin:0px; padding:0px;"),n.push('display:table-cell; vertical-align:middle;">'),n.push('<div style="#position:relative; #top:-50%; width:100%; '),n.push("border:none; margin:0px; padding:0px;"),n.push('text-align:center;"></div></div></div>'),t.innerHTML=n.join(""),t=t.firstChild;var r=t,i=t.getElementsByTagName("div");while(i.length>0)r=i[0],i=r.getElementsByTagName("div");return r.appendChild(e),t},createGraphicElement:function(e){var t=this.createContainerElement("img"),n=null;return Z.browser==Z.browsers.IE&&Z.browserVersion<7?(n=this.createContainerElement("span",null,"inline-block"),t.onload=function(){n.style.width=n.style.width||t.width+"px",n.style.height=n.style.height||t.height+"px",t.onload=null,t=null},n.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+e+"', sizingMethod='scale')"):(n=t,n.src=e),n},createTextElement:function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){var d=Z.Utils.createContainerElement("div","textBoxFor"+e,"inline-block","absolute","hidden",n,r,i,s,u,a,"white","0px",o,"normal"),v=document.createElement("textarea");d.appendChild(v);var m=v,g=m.style;return m.id=e,m.value=t,m.readOnly=l,m.overflowY=f,g.width="100%",g.height="100%",g.margin="0",g.border="0",g.fontFamily=c,g.fontSize=h,g.resize=p,d},createSelectElement:function(e,t,n,r,i,s,o,u){sList=document.createElement("select"),sList.id=e,Z.Utils.isStrVal(t)&&(sList.options[0]=new Option(t,null));for(var a=0,f=n.length;a<f;a++)sList.options[sList.options.length]=new Option(n[a].text,n[a].value);return sList.onchange=u,sList.style.width=r+"px",sList.style.position="absolute",sList.style.left=i+"px",sList.style.top=s+"px",sList.style.visibility=o,sList},updateSelectElement:function(e,t){if(e){e.innerHTML="";for(var n=0,r=t.length;n<r;n++)e.options[e.options.length]=new Option(t[n].text,t[n].value)}},setTextStyle:function(e,t,n,r,i,s,o,u,a,f,l,c){var h=e.parentNode.style;h.color=t,h.fontFamily=n,h.fontSize=r,h.fontSizeAdjust=i,h.fontStyle=s,h.fontStretch=o,h.fontVariant=u,h.fontWeight=a,h.lineHeight=f,h.textAlign=l,h.textDecoration=c},convertXMLTextToXMLDoc:function(e){var t=null;if(window.ActiveXObject)try{t=new ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.loadXML(e)}catch(n){this.showMessage(n.name+this.getResource("ERROR_CONVERTINGXMLTEXTTODOC")+n.message)}else if(window.DOMParser)try{var r=new DOMParser;t=r.parseFromString(e,"text/xml")}catch(n){this.showMessage(n.name+this.getResource("ERROR_CONVERTINGXMLTEXTTODOC")+n.message)}else this.showMessage(this.getResource("ERROR_XMLDOMUNSUPPORTED"));return t},convertXMLDocToXMLText:function(e){var t=null;if(window.ActiveXObject)try{t=e.xml}catch(n){this.showMessage(n.name+this.getResource("ERROR_CONVERTINGXMLDOCTOTEXT")+n.message)}else if(window.DOMParser)try{t=(new XMLSerializer).serializeToString(e)}catch(n){this.showMessage(n.name+this.getResource("ERROR_CONVERTINGXMLDOCTOTEXT")+n.message)}else this.showMessage(this.getResource("ERROR_XMLDOMUNSUPPORTED"));return t},Point:function(e,t){this.x=typeof e=="number"?e:0,this.y=typeof t=="number"?t:0},Point3D:function(e,t,n){this.x=typeof e=="number"?e:0,this.y=typeof t=="number"?t:0,this.z=typeof n=="number"?n:0},getResource:function(e){var t="";switch(e){case"DEFAULT_PARAMETERSENABLETEST":t="Enable Developer parameters";break;case"DEFAULT_PARAMETERSDISABLEVALUE":t="Changing This Violates License Agreement";break;case"DEFAULT_PARAMETERSDISABLEDALERT":t="Support for this parameter is enabled only in the Zoomify Image Viewer included in the Zoomify HTML5 Developer edition: ";break;case"DEFAULT_PFFSUPPORTENABLETEST":t="Changing this violates License Agreement";break;case"DEFAULT_PFFSUPPORTDISABLEVALUE":t="Changing this violates License Agreement";break;case"DEFAULT_PFFSUPPORTDISABLEDALERT":t="Support for PFF single file storage is enabled only in the Zoomify Image Viewer included in the Zoomify Enterprise products.";break;case"DEFAULT_ANNOTATIONSUPPORTENABLETEST":t="Changing this violates License Agreement";break;case"DEFAULT_ANNOTATIONSUPPORTDISABLEVALUE":t="Changing this violates License Agreement";break;case"DEFAULT_ANNOTATIONSUPPORTDISABLEDALERT":t="Support for annotations is enabled only in the Zoomify Image Viewer included in the Zoomify Enterprise products.";break;case"DEFAULT_IMAGESLOADINGMAX":t="200";break;case"DEFAULT_IMAGELOADTIMEOUT":t="30000";break;case"DEFAULT_TIERSMAXSCALEUP":t="1.15";break;case"DEFAULT_TILESMAXCACHE":Z.mobileDevice?t="50":t="300";break;case"DEFAULT_BACKFILLTHRESHOLD2":t="6";break;case"DEFAULT_BACKFILLTHRESHOLD1":t="3";break;case"DEFAULT_BACKFILLCHOICE2":t="3";break;case"DEFAULT_BACKFILLCHOICE1":t="2";break;case"DEFAULT_BACKFILLCHOICE0":t="0";break;case"DEFAULT_PANBUFFER":Z.mobileDevice?t="1":t="1.5";break;case"DEFAULT_PANSPEED":t="5";break;case"DEFAULT_PANSTEPDISTANCE":t="10";break;case"DEFAULT_ZOOMSPEED":t="5";break;case"DEFAULT_ZOOMSTEPDISTANCE":t="0.02";break;case"DEFAULT_ZAPSTEPDURATION":t="30";break;case"DEFAULT_ZAPTVSTEPS":t="20";break;case"DEFAULT_ZAPTVDURATION":t="800";break;case"DEFAULT_CLICKZOOMTIERSKIPTHRESHOLD":t="0.2";break;case"DEFAULT_GESTURETESTDURATION":t="10";break;case"DEFAULT_FADEINSPEED":t="5";break;case"DEFAULT_FADEINSTEP":t="0.067";break;case"DEFAULT_TOOLBARVISIBLE":t="4";break;case"DEFAULT_TOOLBARPOSITION":t="1";break;case"DEFAULT_TOOLTIPSVISIBLE":t="1";break;case"DEFAULT_NAVIGATORVISIBLE":t="2";break;case"DEFAULT_NAVIGATORWIDTH":t="150";break;case"DEFAULT_NAVIGATORHEIGHT":t="100";break;case"DEFAULT_NAVIGATORLEFT":t="0";break;case"DEFAULT_NAVIGATORTOP":t="0";break;case"DEFAULT_NAVIGATORFIT":t=null;break;case"DEFAULT_NAVIGATORBACKCOLOR":t="#ffffff";break;case"DEFAULT_NAVIGATORBACKCOLORNOALPHA":t="#fbfafa";break;case"DEFAULT_NAVIGATORBACKALPHA":t="0.75";break;case"DEFAULT_ANNOTATIONPANELBACKCOLOR":t="#ffffff";break;case"DEFAULT_ANNOTATIONPANELBACKCOLORNOALPHA":t="#fbfafa";break;case"DEFAULT_ANNOTATIONPANELBACKALPHA":t="0.75";break;case"DEFAULT_NAVIGATORRECTANGLECOLOR":t="blue";break;case"DEFAULT_SKINXMLFILE":t="skinFiles.xml";break;case"DEFAULT_SKINXMLPATH":t="Assets/Skins/Default";break;case"DEFAULT_SKINMODE":t="0";break;case"DEFAULT_CONSTRAINPAN":t="1";break;case"DEFAULT_SLIDERVISIBLE":t="1";break;case"DEFAULT_SLIDERTESTDURATION":t="10";break;case"DEFAULT_FULLPAGEVISIBLE":t="1";break;case"DEFAULT_FULLPAGEINITIAL":t="0";break;case"DEFAULT_FULLPAGEBACKCOLOR":t="white";break;case"DEFAULT_FPCANCELBUTTONTEXT":t="X";break;case"DEFAULT_FPCANCELBUTTONCOLOR":t="	#F8F8F8";break;case"DEFAULT_PROGRESSVISIBLE":t="1";break;case"DEFAULT_PROGRESSDURATION":t="500";break;case"DEFAULT_PROGRESSTEXT":t=" ";break;case"DEFAULT_LOGOVISIBLE":t="1";break;case"DEFAULT_LOGOCUSTOMPATH":t=null;break;case"DEFAULT_CANVAS":t="1";break;case"DEFAULT_DEBUG":t="0";break;case"DEFAULT_MESSAGESCREENCOLOR":t="lightgray";break;case"DEFAULT_MESSAGEBUTTONCOLOR":t="white";break;case"DEFAULT_MESSAGEOKBUTTONTEXT":t="OK";break;case"DEFAULT_MESSAGECANCELBUTTONTEXT":t="Cancel";break;case"DEFAULT_COPYRIGHTSCREENCOLOR":t="lightgray";break;case"DEFAULT_COPYRIGHTBUTTONCOLOR":t="white";break;case"DEFAULT_COPYRIGHTAGREEBUTTONTEXT":t="Agree";break;case"DEFAULT_COPYRIGHTEXITBUTTONTEXT":t="Exit";break;case"DEFAULT_WATERMARKALPHA":t="0.6";break;case"DEFAULT_WATERMARKMINSCALE":t="0.33";break;case"DEFAULT_WATERMARKSPANW":t="512";break;case"DEFAULT_WATERMARKSPANH":t="384";break;case"DEFAULT_HOTSPOTSXMLFILE":t="hotspots.xml";break;case"DEFAULT_HOTSPOTCAPTIONPADDING":t="6";break;case"DEFAULT_MINHOTSPOTCAPTIONPADDING":t="2";break;case"DEFAULT_MAXHOTSPOTCAPTIONPADDING":t="7";break;case"DEFAULT_HOTSPOTCAPTIONFONTSIZE":t="14";break;case"DEFAULT_MINHOTSPOTCAPTIONFONTSIZE":t="3";break;case"DEFAULT_MAXHOTSPOTCAPTIONFONTSIZE":t="14";break;case"DEFAULT_FONTTOPIXELSCONVERSIONFACTOR":t="1.8";break;case"DEFAULT_HOTSPOTSINITIALVISIBILITY":t=!0;break;case"DEFAULT_POLYGONLINEWIDTH":t=1;break;case"DEFAULT_CONTROLPOINTLINEWIDTH":t="1";break;case"DEFAULT_CONTROLPOINTSTROKECOLOR":t="#ffffff";break;case"DEFAULT_FIRSTCONTROLPOINTFILLCOLOR":t="#ffffff";break;case"DEFAULT_STANDARDCONTROLPOINTFILLCOLOR":t="#999999";break;case"DEFAULT_CONTROLPOINTRADIUS":t="10";break;case"DEFAULT_HOTSPOTLISTTITLE":t="Hotspots";break;case"DEFAULT_HOTSPOTLISTSOURCE":t="NAME";break;case"DEFAULT_HOTSPOTLISTWIDTH":t="200";break;case"DEFAULT_HOTSPOTLISTPOSITION":t="2";break;case"DEFAULT_ANNOTATIONSXMLFILE":t="annotations.xml";break;case"DEFAULT_ANNOTATIONSXMLSAVEHANDLERNAME1":t="save";break;case"DEFAULT_ANNOTATIONSXMLSAVEHANDLERNAME2":t="upload";break;case"DEFAULT_ANNOTATIONSINITIALVISIBILITY":t=!0;break;case"DEFAULT_ANNOTATIONPANELWIDTH":t="220";break;case"DEFAULT_ANNOTATIONPANELHEIGHT":t="200";break;case"DEFAULT_ANNOTATIONLISTWIDTH":t="160";break;case"DEFAULT_ANNOTATIONNOTEWIDTH":t="189";break;case"DEFAULT_ANNOTATIONNOTEHEIGHT":t="88";break;case"DEFAULT_ANNOTATIONNOTEPADDING":t="6";break;case"DEFAULT_ANNOTATIONNOTEFONTSIZE":t="11";break;case"DEFAULT_ANNOTATIONNOTEVISIBILITY":t=!0;break;case"DEFAULT_ANNOTATIONPANELLABELFONTSIZE":t="11";break;case"DEFAULT_INITIALX":t=null;break;case"DEFAULT_INITIALY":t=null;break;case"DEFAULT_INITIALZOOM":t=null;break;case"DEFAULT_MINZOOM":t=null;break;case"DEFAULT_MAXZOOM":t="1";break;case"DEFAULT_CLICKZOOM":t="1";break;case"DEFAULT_CLICKPAN":t="1";break;case"DEFAULT_MOUSEPAN":t="1";break;case"DEFAULT_KEYS":t="1";break;case"DEFAULT_TRACEDISPLAYDEBUGINFOTEXT":t="This panel is enabled using the HTML parameter 'zDebug=1' (basic) or 'zDebug=2' (adds tile tracing). It can be called in JavaScript as follows:\n\n   Z.Utils.trace('value to display');  \n\nThe buttons below display or modify important state values.  Web designers new to JavaScript will also benefit from the console, trace, profiling, and other debugging features of leading browsers.";break;case"DEFAULT_TRACEDISPLAYSCREENCOLOR":t="lightgray";break;case"DEFAULT_TRACEDISPLAYBUTTONCOLOR":t="white";break;case"DEFAULT_TRACEDISPLAYSHOWGLOBALSBUTTONTEXT":t="Show Globals";break;case"DEFAULT_TRACEDISPLAYTOGGLEDISPLAYBUTTONTEXT":t="Toggle Display";break;case"DEFAULT_TRACEDISPLAYTOGGLEBACKFILLBUTTONTEXT":t="Toggle Backfill";break;case"DEFAULT_TRACEDISPLAYTOGGLECONSTRAINPANBUTTONTEXT":t="Toggle Constrain Pan";break;case"ALERT_POLYGONSREQUIRECANVAS":t="Displaying or editing polygon hotspots requires a browser that supports the HTML5 canvas feature.";break;case"ALERT_CANCELLINGUNSAVEDEDITS":t="Cancelling all unsaved edits.";break;case"ALERT_SAVINGUNSAVEDEDITS":t="Saving unsaved edits.";break;case"ALERT_ANNOTATIONSAVESUCCESSFUL":t="XML save complete.";break;case"ALERT_SAVEDISABLEDFORDEMOKEY":t="SAVEDISABLEDFORDEMO";break;case"ALERT_SAVEDISABLEDFORDEMOTEXT":t="Edits to this demo are saved only for the duration of the browser session.";break;case"ERROR_XMLHTTPREQUESTUNSUPPORTED":t="Browser does not support XMLHttpRequest.";break;case"ERROR_MAKINGNETWORKREQUEST-IMAGEXML":t="Error loading image: please make sure image path in web page matches image folder location on webserver.";break;case"ERROR_MAKINGNETWORKREQUEST-IMAGEHEADER":t="Error loading image: image header request invalid.";break;case"ERROR_MAKINGNETWORKREQUEST-IMAGEOFFSET":t="Error loading image: image offset request invalid.";break;case"ERROR_MAKINGNETWORKREQUEST-TOOLBARXML":t="Error loading toolbar - skin files not found: please verify that the folders 'Assets/Skins/Default' are in same folder as the web page displaying the Viewer, or add zSkinPath parameter to web page.";break;case"ERROR_MAKINGNETWORKREQUEST-HOTSPOTSXML":t="Error loading hotspots: please make sure hotspot path in web page matches hotspot folder location on webserver.";break;case"ERROR_MAKINGNETWORKREQUEST-ANNOTATIONSXML":t="Error loading annotations: please make sure annotation path in web page matches annotation folder location on webserver.";break;case"ERROR_MAKINGNETWORKREQUEST-ANNOTATIONSSAVEHANDLER":t="Error saving annotations: please make sure save handler path in web page matches save handler file location on webserver.";break;case"ERROR_MAKINGNETWORKREQUEST":t="Error making network request: possible invalid path or network error.";break;case"ERROR_IMAGEPATHINVALID":t="Image failed to load: possible invalid path, missing image, or network error.";break;case"ERROR_TILEPATHINVALID":t="Sorry!  Part of this view isn't refreshing.  The network may be slow, or the website might be missing a file:  ";break;case"ERROR_HOTSPOTPATHINVALID":t="Hotspot media failed to load: possible invalid path, missing file, or legacy hotspot media such as library clip of Flash-based viewer.";break;case"ERROR_HOTSPOTMEDIAINVALID":t="Media of one or more hotspots unsupported: hotspot media of type 'symbol' depend on internal Library of Flash-based viewers.";break;case"ERROR_XMLSAVEHANDLERPATHINVALID":t="Annotations cannot be saved: missing or incorrect save handler path parameter, or missing file on server.";break;case"ERROR_NETWORKSECURITY":t="Error related to network security: ";break;case"ERROR_NETWORKSTATUS":t="Error related to network status: ";break;case"ERROR_CONVERTINGXMLTEXTTODOC":t=" converting XML text to XML doc (DOMParser): ";break;case"ERROR_CONVERTINGXMLDOCTOTEXT":t=" converting XML doc to XML text (DOMParser): ";break;case"ERROR_XMLDOMUNSUPPORTED":t="Browser does not support XML DOM.";break;case"ERROR_XMLDOCINVALID":t="XML Doc invalid.";break;case"ERROR_XMLINVALID":t="XML invalid.";break;case"ERROR_IMAGEXMLINVALID":t="Image XML invalid.";break;case"ERROR_IMAGEPROPERTIESPARAMETERINVALID":t="Image properties parameter invalid.";break;case"ERROR_IMAGETILECOUNTINVALID":t="Image tile count does not match value in image XML. If the count is invalid display problems can result.";break;case"ERROR_EXECUTINGCALLBACK":t=" while executing callback: ";break;case"ERROR_IMAGEREQUESTTIMEDOUT":t="Image timed out: ";break;case"ERROR_NAVIGATORIMAGEPATHINVALID":t="Navigator image failed to load: possible invalid path, missing image, or network error.";break;case"ERROR_SKINXMLINVALID":t="Skin XML invalid.";break;case"ERROR_SKINXMLMISSINGNAMES":t="The skin XML file has one or more faulty name lines.";break;case"ERROR_WATERMARKPATHINVALID":t="Watermark image failed to load: ";break;case"ERROR_UNKNOWNELEMENTSTYLE":t="Unknown element style - no known method to identify.";break;case"ERROR_UNKNOWNMOUSEPOSITION":t="Unknown mouse position - no known method to calculate.";break;case"ERROR_UNKNOWNMOUSESCROLL":t="Unknown mouse scroll - no known method to calculate.";break;case"ERROR_UNKNOWNWINDOWSIZE":t="Unknown window size - no known method to calculate.";break;case"TIP_LOGO":t="Launch Zoomify Website";break;case"TIP_MINIMIZE":t="Minimize Toolbar";break;case"TIP_EXPAND":t="Expand Toolbar";break;case"TIP_ZOOMOUT":t="Zoom Out";break;case"TIP_SLIDER":t="Zoom In And Out";break;case"TIP_ZOOMIN":t="Zoom In";break;case"TIP_PANLEFT":t="Pan Left";break;case"TIP_PANUP":t="Pan Up";break;case"TIP_PANDOWN":t="Pan Down";break;case"TIP_PANRIGHT":t="Pan Right";break;case"TIP_RESET":t="Reset Initial View";break;case"TIP_TOGGLEFULLPAGE":t="Toggle Full Page View";break;case"TIP_CANCELFULLPAGE":t="Cancel Full Page View";break;case"TIP_TOGGLEEDITMODE":t="Toggle Label Editing";break;case"TIP_EDITDELETE":t="Delete Label Selected in Choicelist";break;case"TIP_EDITCANCEL":t="Cancel Edits To Current Label";break;case"TIP_EDITSAVE":t="Save All Label Edits";break;case"TIP_MESSAGEOK":t="Accept and close message";break;case"TIP_MESSAGECANCEL":t="Decline and close message";break;case"TIP_COPYRIGHTAGREE":t="Agree to copyright and view images";break;case"TIP_COPYRIGHTEXIT":t="Exit and do not view images";break;case"TIP_SHOWGLOBALS":t="Toggle Full Page View";break;case"TIP_TOGGLEDISPLAY":t="Toggle Viewport Display";break;case"TIP_TOGGLEBACKFILL":t="Toggle Viewport Backfill";break;case"TIP_TOGGLECONSTRAINPAN":t="Toggle Constrain Pan";break;case"UI_ANNOTATIONPANELLABELPOI":t="POI";break;case"UI_ANNOTATIONPANELLABELNOTE":t="Note";break;case"UI_ANNOTATIONPANELLABELLABEL":t="Label";break;case"CONTENT_SKIPUSERNAMENAME":t="Anonymous";break;case"CONTENT_POINAME":t="Unnamed Point Of Interest";break;case"CONTENT_POIUSER":t=this.getResource("CONTENT_SKIPUSERNAMENAME");break;case"CONTENT_NOTENAME":t="Unnamed Note";break;case"CONTENT_NOTETEXT":t="Note text";break;case"CONTENT_NOTEUSER":t=this.getResource("CONTENT_SKIPUSERNAMENAME");break;case"CONTENT_LABELNAME":t="Unnamed Label";break;case"CONTENT_LABELUSER":t=this.getResource("CONTENT_SKIPUSERNAMENAME");break;case"CONTENT_ANNOTATIONPLACEHOLDERLISTTEXT":t="List creation in progress...";break;case"CONTENT_ANNOTATIONPLACEHOLDERNOTETEXT":t="Note loading in progress...";break;case"CONTENT_ANNOTATIONSCAPTIONTEXTCOLOR":t="#000000";break;case"CONTENT_ANNOTATIONSCAPTIONBACKCOLOR":t="#ffffff";break;case"CONTENT_ANNOTATIONSCAPTIONBACKVISIBLE":t="1";break;case"CONTENT_ANNOTATIONSCAPTIONPOSITION":t="8";break;case"CONTENT_POLYGONLINECOLOR":t="#ffff00";break;case"CONTENT_POLYGONFILLCOLOR":t="#ffffff";break;case"CONTENT_POLYGONLINEVISIBLE":t="1";break;case"CONTENT_POLYGONFILLVISIBLE":t="1";break;default:t="Unexpected resource request"}return t},showGlobals:function(){var e="";e+="\n",e+="                            ZOOMIFY IMAGE VIEWER - CURRENT VALUES\n",e+="\n",e+="IMAGE & SKIN:    ",e+="Z.imagePath="+Z.imagePath+",   ",e+="Z.skinPath="+Z.skinPath+",   ",e+="Z.skinMode="+Z.skinMode+",   ",e+="Z.imageW="+Z.imageW+",   ",e+="Z.imageH="+Z.imageH+",   ",e+="tierCount="+Z.Viewport.getTierCount()+",   ",e+="TILE_SIZE="+Z.Viewport.getTileSize()+"\n",e+="\n",e+="PAGE & BROWSER:    ",e+="Z.pageContainer="+Z.pageContainer+",   ",e+="Z.browser="+Z.browser+",   ",e+="Z.browserVersion="+Z.browserVersion+",   ",e+="Z.canvasSupported="+Z.canvasSupported+",   ",e+="Z.cssTransformsSupported="+Z.cssTransformsSupported+",   ",e+="Z.cssTransformProperty="+Z.cssTransformProperty+",   ",e+="Z.cssTransformNoUnits="+Z.cssTransformNoUnits+",   ",e+="Z.alphaSupported="+Z.alphaSupported+",   ",e+="Z.renderQuality="+Z.renderQuality+",   ",e+="Z.mobileDevice="+Z.mobileDevice+"\n",e+="\n",e+="VIEWER OPTIONS & DEFAULTS:    ",e+="Z.initialX="+Z.initialX+",   ",e+="Z.initialY="+Z.initialY+",   ",e+="Z.initialZ="+Z.initialZ+",   ",e+="Z.minZ="+Z.minZ+",   ",e+="Z.maxZ="+Z.maxZ+",   ",e+="Z.fitZ="+Z.fitZ+",   ",e+="Z.zoomSpeed="+Z.zoomSpeed+",   ",e+="Z.panSpeed="+Z.panSpeed+",   ",e+="Z.fadeInSpeed="+Z.fadeInSpeed+",   ",e+="Z.toolbarVisible="+Z.toolbarVisible+",   ",e+="Z.toolbarW="+Z.toolbarW+",   ",e+="Z.toolbarCurrentW="+Z.toolbarCurrentW+",   ",e+="Z.toolbarH="+Z.toolbarH+",   ",e+="Z.toolbarPosition="+Z.toolbarPosition+",   ",e+="Z.tooltipsVisible="+Z.tooltipsVisible+",   ",e+="Z.navigatorVisible="+Z.navigatorVisible+",   ",e+="Z.navigatorW="+Z.navigatorW+",   ",e+="Z.navigatorH="+Z.navigatorH+",   ",e+="Z.navigatorL="+Z.navigatorL+",   ",e+="Z.navigatorT="+Z.navigatorT+",   ",e+="Z.navigatorFit="+Z.navigatorFit+",   ",e+="Z.clickZoom="+Z.clickZoom+",   ",e+="Z.clickPan="+Z.clickPan+",   ",e+="Z.mousePan="+Z.mousePan+",   ",e+="Z.keys="+Z.keys+",   ",e+="Z.constrainPan="+Z.constrainPan+",   ",e+="Watermark alpha = "+Z.Utils.getResource("DEFAULT_WATERMARKALPHA")+",   ",e+="Z.watermarkPath="+Z.watermarkPath+",   ",e+="Z.copyrightPath="+Z.copyrightPath+",   ",e+="Z.hotspotPath="+Z.hotspotPath+",   ",e+="Z.annotationPath="+Z.annotationPath+",   ",e+="Z.saveHandlerPath="+Z.saveHandlerPath+",   ",e+="Z.sliderVisible="+Z.sliderVisible+",   ",e+="Z.fullPageVisible="+Z.fullPageVisible+",   ",e+="Z.fullPageInitial="+Z.fullPageInitial+",   ",e+="Z.progressVisible="+Z.progressVisible+",   ",e+="Z.logoVisible="+Z.logoVisible+",   ",e+="Z.logoCustomPath="+Z.logoCustomPath+",   ",e+="Z.canvas="+Z.canvas+",   ",e+="Z.debug="+Z.debug+",   ",e+="Z.imageProperties="+Z.imageProperties+",   ",e+="Z.serverIP="+Z.serverIP+",   ",e+="Z.serverPort="+Z.serverPort+",   ",e+="Z.tileHandlerPath="+Z.tileHandlerPath+",   ",e+="Z.tileHandlerPathFull="+Z.tileHandlerPathFull+",   ",e+="Z.tileSource="+Z.tileSource+",   ",e+="Z.zEditMode="+Z.zEditMode+"\n",e+="\n",e+="INTERNAL VALUES:    ",e+="\n",e+="displayW="+Z.Viewport.getW()+",   ",e+="displayH="+Z.Viewport.getH()+",   ",e+="tierCurrent="+Z.Viewport.getTierCurrent()+",   ",e+="tierScale="+Z.Viewport.getTierScale()+",   ",e+="TIERS_MAX_SCALE_UP="+Z.Viewport.getTiersMaxScaleUp()+",   ",e+="TIERS_MAX_SCALE_DOWN="+Z.Viewport.getTiersMaxScaleDown()+",   ",e+="TILES_MAX_CACHE="+Z.Viewport.getTilesMaxCache()+",   ",e+="Z.useCanvas="+Z.useCanvas+"\n",e+="\n",e+="INTERNAL LISTS:    ",e+="tierWs="+Z.Viewport.getTierWs()+",   ",e+="tierHs="+Z.Viewport.getTierHs()+",   ",e+="tierTileCounts="+Z.Viewport.getTierTileCounts()+",   ",e+="tilesLoadingNames="+Z.Viewport.getTilesLoadingNames()+"\n",e+="\n",alert(e)},showMessage:function(e){Z.MessageDisplay?(Z.messages&&(Z.messages.value=e),Z.MessageDisplay.style.display="inline-block",typeof Z.MessageDisplay.messageTimer!="undefined"&&Z.MessageDisplay.messageTimer!==null&&window.clearTimeout(Z.MessageDisplay.messageTimer)):Z.Utils.configureMessageDisplay(e),Z.MessageDisplay.messageTimer=window.setTimeout(Z.Utils.hideMessageTimerHandler,2e3)},hideMessage:function(){Z.MessageDisplay.style.display="none"},hideMessageTimerHandler:function(){Z.MessageDisplay.messageTimer&&(window.clearTimeout(Z.MessageDisplay.messageTimer),Z.MessageDisplay.messageTimer=null),Z.Utils.hideMessage()},configureMessageDisplay:function(e){var t=430,n=100,r=Z.viewerW-t-80,i=Z.viewerH-n-80,s=this.getResource("DEFAULT_MESSAGESCREENCOLOR"),o=this.getResource("DEFAULT_MESSAGEBUTTONCOLOR");Z.MessageDisplay=this.createContainerElement("div","MessageDisplay","inline-block","absolute","hidden",t+"px",n+"px",r+"px",i+"px","solid","1px",s,"0px","0px","normal"),Z.ViewerDisplay.appendChild(Z.MessageDisplay);var u=Z.Utils.createTextElement("messageBox",e,t-18+"px",n-40+"px","4px","4px","4px","solid","1px","auto",!0,"verdana","12px","none");Z.MessageDisplay.appendChild(u),Z.messages=document.getElementById("messageBox");var a=56,f=18,l=10,c=5,h=t,p=n-f-c,d;h-=a+l,d=this.getResource("DEFAULT_MESSAGEOKBUTTONTEXT");var v=new Z.Utils.Button("buttonOk",d,null,null,null,null,a+"px",f+"px",h+"px",p+"px","mousedown",this.messageOkButtonHandler,"TIP_MESSAGEOK","solid","1px",o,"0px","0px");Z.MessageDisplay.appendChild(v.elmt)},messageOkButtonHandler:function(e){return Z.Utils.hideMessage(),!0},messageCancelButtonHandler:function(e){return Z.Utils.hideMessage(),!1},showTraces:function(){Z.TraceDisplay?Z.TraceDisplay.style.display="inline-block":Z.Utils.configureTraceDisplay()},hideTraces:function(){Z.TraceDisplay.style.display="none"},configureTraceDisplay:function(){var e=Z.viewerW/3,t=Z.viewerH/3+45,n=10,r=Z.viewerH/3,i=this.getResource("DEFAULT_TRACEDISPLAYSCREENCOLOR");Z.TraceDisplay=this.createContainerElement("div","TraceDisplay","inline-block","absolute","hidden",e+"px",t+"px",n+"px",r+"px","solid","1px",i,"0px","10px","normal"),Z.ViewerDisplay.appendChild(Z.TraceDisplay);var s="Trace Values\n",o=Z.Utils.createTextElement("debugTraces",s,e-15+"px",t-60+"px","10px","10px","5px","solid","1px","auto",!0,"verdana","10px","none");Z.TraceDisplay.appendChild(o),Z.traces=document.getElementById("debugTraces");var u=58,a=42,f=20,l=t-a/2-10,c=10,h=this.getResource("DEFAULT_TRACEDISPLAYBUTTONCOLOR"),p=this.getResource("DEFAULT_TRACEDISPLAYSHOWGLOBALSBUTTONTEXT"),d=new this.Button("buttonShowGlobals",p,null,null,null,null,u+"px",a+"px",f+"px",l+"px","mousedown",this.showGlobals,"TIP_SHOWGLOBALS","solid","1px",h,"0px","0px");Z.TraceDisplay.appendChild(d.elmt),f+=u+c;var p=this.getResource("DEFAULT_TRACEDISPLAYTOGGLEDISPLAYBUTTONTEXT"),v=new this.Button("buttonToggleDisplay",p,null,null,null,null,u+"px",a+"px",f+"px",l+"px","mousedown",Z.Viewport.toggleDisplay,"TIP_TOGGLEDISPLAY","solid","1px",h,"0px","0px");Z.TraceDisplay.appendChild(v.elmt),f+=u+c;var p=this.getResource("DEFAULT_TRACEDISPLAYTOGGLEBACKFILLBUTTONTEXT"),m=new this.Button("buttonToggleBackfill",p,null,null,null,null,u+"px",a+"px",f+"px",l+"px","mousedown",Z.Viewport.toggleBackfill,"TIP_TOGGLEBACKFILL","solid","1px",h,"0px","0px");Z.TraceDisplay.appendChild(m.elmt),f+=u+c,u+=12;var p=this.getResource("DEFAULT_TRACEDISPLAYTOGGLECONSTRAINPANBUTTONTEXT"),g=new this.Button("buttonToggleConstrainPan",p,null,null,null,null,u+"px",a+"px",f+"px",l+"px","mousedown",Z.Viewport.toggleConstrainPan,"TIP_TOGGLECONSTRAINPAN","solid","1px",h,"0px","0px");Z.TraceDisplay.appendChild(g.elmt)},trace:function(e){Z.TraceDisplay||Z.Utils.configureTraceDisplay(),Z.traces&&(Z.traces.value+="\n"+e+"\n")},drawCenterLines:function(e,t,n){var r=Z.Utils.createContainerElement("div","viewportCenterLineVertical","inline-block","absolute","visible","1px",n+"px",t/2+"px","0px","solid","1px","transparent none","0px","0px","normal"),i=Z.Utils.createContainerElement("div","viewportCenterLineHorizontal","inline-block","absolute","visible",t+"px","1px","0px",n/2+"px","solid","1px","transparent none","0px","0px","normal");e.appendChild(i),e.appendChild(r)}}
